<!DOCTYPE html>

<html>
<head>
  <title>can/util/fixture.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="can-util-fixture-js">can/util/fixture.js</h1>
<p>Intercepts AJAX requests and simulates them with either a function or a
file. This is used to develop independently from backend services.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>steal(<span class="hljs-string">'can/util'</span>, <span class="hljs-string">'can/util/string'</span>, <span class="hljs-string">'can/util/object'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(can)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>can.fixture relies on can.Object in order to work and needs to be
included before can.fixture in order to use it, otherwise it’ll error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> (!can.Object) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'can.fixture depends on can.Object. Please include it before can.fixture.'</span>);
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Get the URL from old Steal root, new Steal config or can.fixture.rootUrl</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> getUrl = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(url)</span> </span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> steal !== <span class="hljs-string">'undefined'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>New steal
TODO The correct way to make this work with new Steal is to change getUrl
to return a deferred and have the other code accept a deferred.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span>(steal.joinURIs) {
				<span class="hljs-keyword">var</span> base = steal.config(<span class="hljs-string">"baseUrl"</span>);
				<span class="hljs-keyword">var</span> joined = steal.joinURIs(base, url);
				<span class="hljs-keyword">return</span> joined;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Legacy steal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (can.isFunction(steal.config)) {
				<span class="hljs-keyword">if</span> (steal.System) {
					<span class="hljs-keyword">return</span> steal.joinURIs(steal.config(<span class="hljs-string">'baseURL'</span>), url);
				}
				<span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">return</span> steal.config()
						.root.mapJoin(url)
						.toString();
				}
			}
			<span class="hljs-keyword">return</span> steal.root.join(url)
				.toString();
		}
		<span class="hljs-keyword">return</span> (can.fixture.rootUrl || <span class="hljs-string">''</span>) + url;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Manipulates the AJAX prefilter to identify whether or not we should
manipulate the AJAX call to change the URL to a static file or call
a function for a dynamic fixture.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> updateSettings = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings, originalOptions)</span> </span>{
		<span class="hljs-keyword">if</span> (!can.fixture.on) {
			<span class="hljs-keyword">return</span>;
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>A simple wrapper for logging fixture.js.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> log = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>!steal-remove-start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			can.dev.log(<span class="hljs-string">'can/fixture/fixture.js: '</span> + <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>)
				.join(<span class="hljs-string">' '</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>!steal-remove-end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>We always need the type which can also be called method, default to GET</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		settings.type = settings.type || settings.method || <span class="hljs-string">'GET'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>add the fixture option if programmed in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> data = overwrite(settings);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>If there is not a fixture for this AJAX request, do nothing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (!settings.fixture) {
			<span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.location.protocol === <span class="hljs-string">"file:"</span>) {
				log(<span class="hljs-string">"ajax request to "</span> + settings.url + <span class="hljs-string">", no fixture found"</span>);
			}
			<span class="hljs-keyword">return</span>;
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If the fixture already exists on can.fixture, update the fixture option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> settings.fixture === <span class="hljs-string">"string"</span> &amp;&amp; can.fixture[settings.fixture]) {
			settings.fixture = can.fixture[settings.fixture];
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>If the fixture setting is a string, we just change the URL of the
AJAX call to the fixture URL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> settings.fixture === <span class="hljs-string">"string"</span>) {
			<span class="hljs-keyword">var</span> url = settings.fixture;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>If the URL starts with //, we need to update the URL to become
the full path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^\/\//</span>.test(url)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>this lets us use rootUrl w/o having steal…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				url = getUrl(settings.fixture.substr(<span class="hljs-number">2</span>));
			}

			<span class="hljs-keyword">if</span> (data) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Template static fixture URLs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				url = can.sub(url, data);
			}

			<span class="hljs-keyword">delete</span> settings.fixture;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>!steal-remove-start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			log(<span class="hljs-string">"looking for fixture in "</span> + url);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>!steal-remove-end</p>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Override the AJAX settings, changing the URL to the fixture file,
removing the data, and changing the type to GET.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			settings.url = url;
			settings.data = <span class="hljs-literal">null</span>;
			settings.type = <span class="hljs-string">"GET"</span>;
			<span class="hljs-keyword">if</span> (!settings.error) {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>If no error handling is provided, we provide one and throw an
error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				settings.error = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(xhr, error, message)</span> </span>{
					<span class="hljs-keyword">throw</span> <span class="hljs-string">"fixtures.js Error "</span> + error + <span class="hljs-string">" "</span> + message;
				};
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Otherwise, it is a function and we add the fixture data type so the
fixture transport will handle it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>!steal-remove-start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			log(<span class="hljs-string">"using a dynamic fixture for "</span> + settings.type + <span class="hljs-string">" "</span> + settings.url);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>!steal-remove-end</p>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>TODO: make everything go here for timing and other fun stuff
add to settings data from fixture …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (settings.dataTypes) {
				settings.dataTypes.splice(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"fixture"</span>);
			}

			<span class="hljs-keyword">if</span> (data &amp;&amp; originalOptions) {
				originalOptions.data = originalOptions.data || {};
				can.extend(originalOptions.data, data);
			}
		}
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>A helper function that takes what’s called with response
and moves some common args around to make it easier to call</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		extractResponse = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(status, statusText, responses, headers)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>if we get response(RESPONSES, HEADERS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> status !== <span class="hljs-string">"number"</span>) {
				headers = statusText;
				responses = status;
				statusText = <span class="hljs-string">"success"</span>;
				status = <span class="hljs-number">200</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>if we get response(200, RESPONSES, HEADERS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> statusText !== <span class="hljs-string">"string"</span>) {
				headers = responses;
				responses = statusText;
				statusText = <span class="hljs-string">"success"</span>;
			}
			<span class="hljs-keyword">if</span> (status &gt;= <span class="hljs-number">400</span> &amp;&amp; status &lt;= <span class="hljs-number">599</span>) {
				<span class="hljs-keyword">this</span>.dataType = <span class="hljs-string">"text"</span>;
			}
			<span class="hljs-keyword">return</span> [status, statusText, extractResponses(<span class="hljs-keyword">this</span>, responses), headers];
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If we get data instead of responses, make sure we provide a response
type that matches the first datatype (typically JSON)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		extractResponses = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings, responses)</span> </span>{
			<span class="hljs-keyword">var</span> next = settings.dataTypes ? settings.dataTypes[<span class="hljs-number">0</span>] : (settings.dataType || <span class="hljs-string">'json'</span>);
			<span class="hljs-keyword">if</span> (!responses || !responses[next]) {
				<span class="hljs-keyword">var</span> tmp = {};
				tmp[next] = responses;
				responses = tmp;
			}
			<span class="hljs-keyword">return</span> responses;
		};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Set up prefiltering and transmission handling in order to actually power
can.fixture. This is handled two different ways, depending on whether or
not CanJS is using jQuery or not.</p>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>If we are using jQuery, we have access to ajaxPrefilter and ajaxTransport</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> (can.ajaxPrefilter &amp;&amp; can.ajaxTransport) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>the pre-filter needs to re-route the url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		can.ajaxPrefilter(updateSettings);

		can.ajaxTransport(<span class="hljs-string">"fixture"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(s, original)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>remove the fixture from the datatype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			s.dataTypes.shift();</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>we’ll return the result of the next data type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> timeout, stopped = <span class="hljs-literal">false</span>;

			<span class="hljs-keyword">return</span> {
				send: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(headers, callback)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>we’ll immediately wait the delay time for all fixtures</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					timeout = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>if the user wants to call success on their own, we allow it …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> success = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
							<span class="hljs-keyword">if</span> (stopped === <span class="hljs-literal">false</span>) {
								callback.apply(<span class="hljs-literal">null</span>, extractResponse.apply(s, <span class="hljs-built_in">arguments</span>));
							}
						},</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>get the result form the fixture</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							result = s.fixture(original, success, headers, s);
						<span class="hljs-keyword">if</span> (result !== <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Run the callback as a 200 success and with the results with the correct dataType</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							callback(<span class="hljs-number">200</span>, <span class="hljs-string">"success"</span>, extractResponses(s, result), {});
						}
					}, can.fixture.delay);
				},
				abort: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
					stopped = <span class="hljs-literal">true</span>;
					clearTimeout(timeout);
				}
			};
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>If we are not using jQuery, we don’t have access to those nice ajaxPrefilter
and ajaxTransport functions, so we need to monkey patch can.ajax.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">var</span> AJAX = can.ajax;
		can.ajax = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{
			updateSettings(settings, settings);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>If the call is a fixture call, we run the same type of code as we would
with jQuery’s ajaxTransport.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (settings.fixture) {
				<span class="hljs-keyword">var</span> timeout, deferred = <span class="hljs-keyword">new</span> can.Deferred(),
					stopped = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>TODO this should work with response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				deferred.getResponseHeader = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Call success or fail after deferred resolves</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				deferred.then(settings.success, settings.fail);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Abort should stop the timeout and calling the success callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				deferred.abort = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
					clearTimeout(timeout);
					stopped = <span class="hljs-literal">true</span>;
					deferred.reject(deferred);
				};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>set a timeout that simulates making a request ….</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				timeout = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>if the user wants to call success on their own, we allow it …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> success = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
						<span class="hljs-keyword">var</span> response = extractResponse.apply(settings, <span class="hljs-built_in">arguments</span>),
							status = response[<span class="hljs-number">0</span>];

						<span class="hljs-keyword">if</span> ((status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span> || status === <span class="hljs-number">304</span>) &amp;&amp; stopped === <span class="hljs-literal">false</span>) {
							deferred.resolve(response[<span class="hljs-number">2</span>][settings.dataType]);
						} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>TODO probably resolve better</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							deferred.reject(deferred, <span class="hljs-string">'error'</span>, response[<span class="hljs-number">1</span>]);
						}
					},</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Get the results from the fixture.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						result = settings.fixture(settings, success, settings.headers, settings);
					<span class="hljs-keyword">if</span> (result !== <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Resolve with fixture results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						deferred.resolve(result);
					}
				}, can.fixture.delay);

				<span class="hljs-keyword">return</span> deferred;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Otherwise just run a normal can.ajax call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">return</span> AJAX(settings);
			}
		};
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>A list of ‘overwrite’ settings objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> overwrites = [],</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Finds and returns the index of an overwrite function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		find = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings, exact)</span> </span>{
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; overwrites.length; i++) {
				<span class="hljs-keyword">if</span> ($fixture._similar(settings, overwrites[i], exact)) {
					<span class="hljs-keyword">return</span> i;
				}
			}
			<span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Overwrites the settings fixture if an overwrite matches</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		overwrite = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{
			<span class="hljs-keyword">var</span> index = find(settings);
			<span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
				settings.fixture = overwrites[index].fixture;
				<span class="hljs-keyword">return</span> $fixture._getData(overwrites[index].url, settings.url);
			}

		},</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Attemps to guess where the id is in an AJAX call’s URL and returns it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		getId = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{
			<span class="hljs-keyword">var</span> id = settings.data.id;

			<span class="hljs-keyword">if</span> (id === <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">typeof</span> settings.data === <span class="hljs-string">"number"</span>) {
				id = settings.data;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Parses the URL looking for all digits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (id === <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Set id equal to the value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				settings.url.replace(<span class="hljs-regexp">/\/(\d+)(\/|$|\.)/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(all, num)</span> </span>{
					id = num;
				});
			}

			<span class="hljs-keyword">if</span> (id === <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>If that doesn’t work Parses the URL looking for all words</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				id = settings.url.replace(<span class="hljs-regexp">/\/(\w+)(\/|$|\.)/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(all, num)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>As long as num isn’t the word “update”, set id equal to the value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (num !== <span class="hljs-string">'update'</span>) {
						id = num;
					}
				});
			}

			<span class="hljs-keyword">if</span> (id === <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>If id is still not set, a random number is guessed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				id = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">1000</span>);
			}

			<span class="hljs-keyword">return</span> id;
		};</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <h2 id="can-fixture">can.fixture</h2>
<p>Simulates AJAX requests.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> $fixture = can.fixture = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings, fixture)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>If fixture is provided, set up a new fixture.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (fixture !== <span class="hljs-literal">undefined</span>) {
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> settings === <span class="hljs-string">'string'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Match URL if it has GET, POST, PUT, or DELETE.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> matches = settings.match(<span class="hljs-regexp">/(GET|POST|PUT|DELETE) (.+)/i</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>If not, we don’t set the type, which eventually defaults to GET</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (!matches) {
					settings = {
						url: settings
					};</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>If it does match, we split the URL in half and create an object with
each half as the url and type properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				} <span class="hljs-keyword">else</span> {
					settings = {
						url: matches[<span class="hljs-number">2</span>],
						type: matches[<span class="hljs-number">1</span>]
					};
				}
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Check if the same fixture was previously added, if so, we remove it
from our array of fixture overwrites.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> index = find(settings, !! fixture);
			<span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
				overwrites.splice(index, <span class="hljs-number">1</span>);
			}
			<span class="hljs-keyword">if</span> (fixture == <span class="hljs-literal">null</span>) {
				<span class="hljs-keyword">return</span>;
			}
			settings.fixture = fixture;
			overwrites.push(settings);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>If a fixture isn’t provided, we assume that settings is
an array of fixtures, and we should iterate over it, and set up
the new fixtures.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		} <span class="hljs-keyword">else</span> {
			can.each(settings, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fixture, url)</span> </span>{
				$fixture(url, fixture);
			});
		}
	};
	<span class="hljs-keyword">var</span> replacer = can.replacer;

	can.extend(can.fixture, {</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Find an overwrite, given some ajax settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_similar: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings, overwrite, exact)</span> </span>{
			<span class="hljs-keyword">if</span> (exact) {
				<span class="hljs-keyword">return</span> can.Object.same(settings, overwrite, {
					fixture: <span class="hljs-literal">null</span>
				});
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">return</span> can.Object.subset(settings, overwrite, can.fixture._compare);
			}
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Comparator object used to find a similar overwrite.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_compare: {
			url: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> </span>{
				<span class="hljs-keyword">return</span> !!$fixture._getData(b, a);
			},
			fixture: <span class="hljs-literal">null</span>,
			type: <span class="hljs-string">"i"</span>
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Returns data from a url, given a fixtue URL. For example, given
“todo/{id}” and “todo/5”, it will return an object with an id property
equal to 5.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_getData: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fixtureUrl, url)</span> </span>{
			<span class="hljs-keyword">var</span> order = [],</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Sanitizes fixture URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				fixtureUrlAdjusted = fixtureUrl.replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">'\\.'</span>)
					.replace(<span class="hljs-string">'?'</span>, <span class="hljs-string">'\\?'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Creates a regular expression out of the adjusted fixture URL and
runs it on the URL we passed in.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				res = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(fixtureUrlAdjusted.replace(replacer, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(whole, part)</span> </span>{
					order.push(part);
					<span class="hljs-keyword">return</span> <span class="hljs-string">"([^\/]+)"</span>;
				}) + <span class="hljs-string">"$"</span>)
					.exec(url),
				data = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>If there were no matches, return null;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (!res) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Shift off the URL and just keep the data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			res.shift();
			can.each(order, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Add data from regular expression onto data object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				data[name] = res.shift();
			});
			<span class="hljs-keyword">return</span> data;
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <h2 id="can-fixture-store">can.fixture.store</h2>
<p>Make a store of objects to use when making requests against fixtures.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		store: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(count, make, filter)</span> </span>{
			<span class="hljs-comment">/*jshint eqeqeq:false */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>the currentId to use when a new instance is created.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span>	currentId = <span class="hljs-number">0</span>,
				findOne = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id)</span> </span>{
					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; items.length; i++) {
						<span class="hljs-keyword">if</span> (id == items[i].id) {
							<span class="hljs-keyword">return</span> items[i];
						}
					}
				},
				methods = {},
				types,
				items,
				reset;
				
			<span class="hljs-keyword">if</span>(can.isArray(count) &amp;&amp; <span class="hljs-keyword">typeof</span> count[<span class="hljs-number">0</span>] === <span class="hljs-string">"string"</span> ){
				types = count;
				count = make;
				make= filter;
				filter = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">3</span>];
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> count === <span class="hljs-string">"string"</span>) {
				types = [count + <span class="hljs-string">"s"</span>, count];
				count = make;
				make= filter;
				filter = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">3</span>];
			}
			
			
			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> count === <span class="hljs-string">"number"</span>) {
				items = [];
				reset = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
					items = [];
					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; (count); i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>call back provided make</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> item = make(i, items);
	
						<span class="hljs-keyword">if</span> (!item.id) {
							item.id = i;
						}
						currentId = <span class="hljs-built_in">Math</span>.max(item.id + <span class="hljs-number">1</span>, currentId + <span class="hljs-number">1</span>) || items.length;
						items.push(item);
					}
					<span class="hljs-keyword">if</span> (can.isArray(types)) {
						can.fixture[<span class="hljs-string">"~"</span> + types[<span class="hljs-number">0</span>]] = items;
						can.fixture[<span class="hljs-string">"-"</span> + types[<span class="hljs-number">0</span>]] = methods.findAll;
						can.fixture[<span class="hljs-string">"-"</span> + types[<span class="hljs-number">1</span>]] = methods.findOne;
						can.fixture[<span class="hljs-string">"-"</span> + types[<span class="hljs-number">1</span>] + <span class="hljs-string">"Update"</span>] = methods.update;
						can.fixture[<span class="hljs-string">"-"</span> + types[<span class="hljs-number">1</span>] + <span class="hljs-string">"Destroy"</span>] = methods.destroy;
						can.fixture[<span class="hljs-string">"-"</span> + types[<span class="hljs-number">1</span>] + <span class="hljs-string">"Create"</span>] = methods.create;
					}
				};
			} <span class="hljs-keyword">else</span> {
				filter = make;
				<span class="hljs-keyword">var</span> initialItems = count;
				reset = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
					items = initialItems.slice(<span class="hljs-number">0</span>);
				};
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>make all items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			can.extend(methods, {
				findAll: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request)</span> </span>{
					request = request || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>copy array of items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> retArr = items.slice(<span class="hljs-number">0</span>);
					request.data = request.data || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>sort using order
order looks like [“age ASC”,”gender DESC”]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					can.each((request.data.order || [])
						.slice(<span class="hljs-number">0</span>)
						.reverse(), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{
							<span class="hljs-keyword">var</span> split = name.split(<span class="hljs-string">" "</span>);
							retArr = retArr.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> </span>{
								<span class="hljs-keyword">if</span> (split[<span class="hljs-number">1</span>].toUpperCase() !== <span class="hljs-string">"ASC"</span>) {
									<span class="hljs-keyword">if</span> (a[split[<span class="hljs-number">0</span>]] &lt; b[split[<span class="hljs-number">0</span>]]) {
										<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
									} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a[split[<span class="hljs-number">0</span>]] === b[split[<span class="hljs-number">0</span>]]) {
										<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
									} <span class="hljs-keyword">else</span> {
										<span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
									}
								} <span class="hljs-keyword">else</span> {
									<span class="hljs-keyword">if</span> (a[split[<span class="hljs-number">0</span>]] &lt; b[split[<span class="hljs-number">0</span>]]) {
										<span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
									} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a[split[<span class="hljs-number">0</span>]] === b[split[<span class="hljs-number">0</span>]]) {
										<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
									} <span class="hljs-keyword">else</span> {
										<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
									}
								}
							});
						});</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>group is just like a sort</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					can.each((request.data.group || [])
						.slice(<span class="hljs-number">0</span>)
						.reverse(), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{
							<span class="hljs-keyword">var</span> split = name.split(<span class="hljs-string">" "</span>);
							retArr = retArr.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> </span>{
								<span class="hljs-keyword">return</span> a[split[<span class="hljs-number">0</span>]] &gt; b[split[<span class="hljs-number">0</span>]];
							});
						});

					<span class="hljs-keyword">var</span> offset = <span class="hljs-built_in">parseInt</span>(request.data.offset, <span class="hljs-number">10</span>) || <span class="hljs-number">0</span>,
						limit = <span class="hljs-built_in">parseInt</span>(request.data.limit, <span class="hljs-number">10</span>) || (items.length - offset),
						i = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>filter results if someone added an attr like parentId</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> param <span class="hljs-keyword">in</span> request.data) {
						i = <span class="hljs-number">0</span>;
						<span class="hljs-keyword">if</span> (request.data[param] !== <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-comment">// don't do this if the value of the param is null (ignore it)</span>
							(param.indexOf(<span class="hljs-string">"Id"</span>) !== -<span class="hljs-number">1</span> || param.indexOf(<span class="hljs-string">"_id"</span>) !== -<span class="hljs-number">1</span>)) {
							<span class="hljs-keyword">while</span> (i &lt; retArr.length) {
								<span class="hljs-keyword">if</span> (request.data[param] != retArr[i][param]) { <span class="hljs-comment">// jshint eqeqeq: false</span>
									retArr.splice(i, <span class="hljs-number">1</span>);
								} <span class="hljs-keyword">else</span> {
									i++;
								}
							}
						}
					}

					<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> filter === <span class="hljs-string">"function"</span> ) {
						i = <span class="hljs-number">0</span>;
						<span class="hljs-keyword">while</span> (i &lt; retArr.length) {
							<span class="hljs-keyword">if</span> (!filter(retArr[i], request)) {
								retArr.splice(i, <span class="hljs-number">1</span>);
							} <span class="hljs-keyword">else</span> {
								i++;
							}
						}
					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( <span class="hljs-keyword">typeof</span> filter === <span class="hljs-string">"object"</span> ) {
						i = <span class="hljs-number">0</span>;
						<span class="hljs-keyword">while</span> (i &lt; retArr.length) {
							<span class="hljs-keyword">if</span> ( !can.Object.subset(retArr[i], request.data, filter) ) {
								retArr.splice(i, <span class="hljs-number">1</span>);
							} <span class="hljs-keyword">else</span> {
								i++;
							}
						}
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Return the data spliced with limit and offset, along with related values
(e.g. count, limit, offset)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">return</span> {
						<span class="hljs-string">"count"</span>: retArr.length,
						<span class="hljs-string">"limit"</span>: request.data.limit,
						<span class="hljs-string">"offset"</span>: request.data.offset,
						<span class="hljs-string">"data"</span>: retArr.slice(offset, offset + limit)
					};
				},

				<span class="hljs-comment">/**
				 * @description Simulate a findOne request on a fixture.
				 * @function can.fixture.types.Store.findOne
				 * @parent can.fixture.types.Store
				 * @signature `store.findOne(request, response)`
				 * @param {Object} request Parameters for the request.
				 * @param {Function} response A function to call with the retrieved item.
				 *
				 * @body
				 * `store.findOne(request, response(item))` simulates a request to
				 * get a single item from the server by id.
				 *
				 *     todosStore.findOne({
				 *       url: "/todos/5"
				 *     }, function(todo){
				 *
				 *     });
				 *
				 */</span>
				findOne: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request, response)</span> </span>{
					<span class="hljs-keyword">var</span> item = findOne(getId(request));
					
					<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"undefined"</span>) {
						<span class="hljs-keyword">return</span> response(<span class="hljs-number">404</span>, <span class="hljs-string">'Requested resource not found'</span>);
					}

					response(item);
				},</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <h2 id="fixturestore-update">fixtureStore.update</h2>
<p>Simulates a can.Model.update to a fixture</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request, response)</span> </span>{
					<span class="hljs-keyword">var</span> id = getId(request),
						item = findOne(id);

					<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"undefined"</span>) {
						<span class="hljs-keyword">return</span> response(<span class="hljs-number">404</span>, <span class="hljs-string">'Requested resource not found'</span>);
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>TODO: make it work with non-linear ids ..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					can.extend(item, request.data);
					response({
						id: id
					}, {
						location: request.url || <span class="hljs-string">"/"</span> + getId(request)
					});
				},

				<span class="hljs-comment">/**
				 * @description Simulate destroying a Model on a fixture.
				 * @function can.fixture.types.Store.destroy
				 * @parent can.fixture.types.Store
				 * @signature `store.destroy(request, callback)`
				 * @param {Object} request Parameters for the request.
				 * @param {Function} callback A function to call after destruction.
				 *
				 * @body
				 * `store.destroy(request, response())` simulates
				 * a request to destroy an item from the server.
				 *
				 * @codestart
				 * todosStore.destroy({
				 *   url: "/todos/5"
				 * }, function(){});
				 * @codeend
				 */</span>
				destroy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request, response)</span> </span>{
					<span class="hljs-keyword">var</span> id = getId(request),
						item = findOne(id);
						
					<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"undefined"</span>) {
						<span class="hljs-keyword">return</span> response(<span class="hljs-number">404</span>, <span class="hljs-string">'Requested resource not found'</span>);
					}

					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; items.length; i++) {
						<span class="hljs-keyword">if</span> (items[i].id == id) {  <span class="hljs-comment">// jshint eqeqeq: false</span>
							items.splice(i, <span class="hljs-number">1</span>);
							<span class="hljs-keyword">break</span>;
						}
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>TODO: make it work with non-linear ids ..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">return</span> {};
				},</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <h2 id="fixturestore-create">fixtureStore.create</h2>
<p>Simulates a can.Model.create to a fixture</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				create: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings, response)</span> </span>{
					<span class="hljs-keyword">var</span> item = make(items.length, items);

					can.extend(item, settings.data);</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>If an ID wasn’t passed into the request, we give the item
a unique ID.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (!item.id) {
						item.id = currentId++;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Push the new item into the store.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					items.push(item);
					response({
						id: item.id
					}, {
						location: settings.url + <span class="hljs-string">"/"</span> + item.id
					});
				}
			});
			reset();</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>if we have types given add them to can.fixture</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
			<span class="hljs-keyword">return</span> can.extend({
				getId: getId,
				find: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{
					<span class="hljs-keyword">return</span> findOne(getId(settings));
				},
				reset: reset
			}, methods);
		},
		rand: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randomize</span><span class="hljs-params">(arr, min, max)</span> </span>{
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> arr === <span class="hljs-string">'number'</span>) {
				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> min === <span class="hljs-string">'number'</span>) {
					<span class="hljs-keyword">return</span> arr + <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (min - arr));
				} <span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * arr);
				}

			}
			<span class="hljs-keyword">var</span> rand = randomize;</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>get a random set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (min === <span class="hljs-literal">undefined</span>) {
				<span class="hljs-keyword">return</span> rand(arr, rand(arr.length + <span class="hljs-number">1</span>));
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>get a random selection of arr</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> res = [];
			arr = arr.slice(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>set max</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (!max) {
				max = min;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>random max</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			max = min + <span class="hljs-built_in">Math</span>.round(rand(max - min));
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; max; i++) {
				res.push(arr.splice(rand(arr.length), <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]);
			}
			<span class="hljs-keyword">return</span> res;
		},
		xhr: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(xhr)</span> </span>{
			<span class="hljs-keyword">return</span> can.extend({}, {
				abort: can.noop,
				getAllResponseHeaders: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
					<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
				},
				getResponseHeader: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
					<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
				},
				open: can.noop,
				overrideMimeType: can.noop,
				readyState: <span class="hljs-number">4</span>,
				responseText: <span class="hljs-string">""</span>,
				responseXML: <span class="hljs-literal">null</span>,
				send: can.noop,
				setRequestHeader: can.noop,
				status: <span class="hljs-number">200</span>,
				statusText: <span class="hljs-string">"OK"</span>
			}, xhr);
		},
		on: <span class="hljs-literal">true</span>
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <h2 id="can-fixture-delay">can.fixture.delay</h2>
<p>The delay, in milliseconds, between an AJAX request being made and when
the success callback gets called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.fixture.delay = <span class="hljs-number">200</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <h2 id="can-fixture-rooturl">can.fixture.rootUrl</h2>
<p>The root URL which fixtures will use.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.fixture.rootUrl = getUrl(<span class="hljs-string">''</span>);

	can.fixture[<span class="hljs-string">"-handleFunction"</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> settings.fixture === <span class="hljs-string">"string"</span> &amp;&amp; can.fixture[settings.fixture]) {
			settings.fixture = can.fixture[settings.fixture];
		}
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> settings.fixture === <span class="hljs-string">"function"</span>) {
			setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
				<span class="hljs-keyword">if</span> (settings.success) {
					settings.success.apply(<span class="hljs-literal">null</span>, settings.fixture(settings, <span class="hljs-string">"success"</span>));
				}
				<span class="hljs-keyword">if</span> (settings.complete) {
					settings.complete.apply(<span class="hljs-literal">null</span>, settings.fixture(settings, <span class="hljs-string">"complete"</span>));
				}
			}, can.fixture.delay);
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
		}
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Expose this for fixture debugging</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.fixture.overwrites = overwrites;
	can.fixture.make = can.fixture.store;
	<span class="hljs-keyword">return</span> can.fixture;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
