<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>CanJS - map </title>
	<meta name="description" content="">
	<meta name="author" content="">

	
	<link rel="stylesheet" type="text/css" href="./static/bundles/static.css">
	
	<!--[if lt IE 9]>
   <script type="text/javascript" src="static/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="docs ">
	<header>
		<nav class="container">

			<div class="logo-menu">
				<a class="brand" href="../index.html">CanJS</a>
				<ul class="dropdown-menu">
		          <li><a href="http://javascriptmvc.com">JavaScriptMVC</a></li>
		          <li><a href="http://canjs.com" class="active">CanJS</a></li>
		          <li><a href="http://jquerypp.com">jQuery++</a></li>
		          <li><a href="http://stealjs.com">StealJS</a></li>
		          <li><a href="http://funcunit.com">FuncUnit</a></li>
		          <li><a href="http://documentjs.com">DocumentJS</a></li>
		        </ul>
			</div>
			
			<ul class="nav">
		        <li >
	              <a href="../index.html">Home</a>
                </li>
		       <li><a href='../guides/index.html'>guides</a></li>
		       <li class='active'><a href='index.html'>api</a></li>
		        <li class=" community-menu">
		          <a href="../community.html#!forums">Community</a>
		          <ul class="dropdown-menu">
		            <li><a href="https://forum.javascriptmvc.com/canjs">Forums</a></li>
		            <li><a href="http://webchat.freenode.net/?channels=canjs">IRC</a></li>
		            <li><a href="http://bithub.com/canjs/app/">Apps</a></li>
		            <li><a href="http://bithub.com/canjs/plugin/">Plugins</a></li>
		            <li><a href="http://bithub.com/canjs/article/">Articles</a></li>
		            <li><a href="http://github.com/bitovi/canjs">Github</a></li>
		            <li><a href="http://twitter.com/canjs">Twitter</a></li>
		            <li><a href="http://bitovi.github.io/canjsmeetup/">Meetups</a></li>
		          </ul>
		        </li>
		        <li >
	              <a href="../blog/index.html">Blog</a>
                </li>
		        <li >
	              <a href="../download.html">Download</a>
                </li>
	      	</ul>
			
			<div class="pull-right">
				<div class="bitovi-menu">
					<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
					<ul class="dropdown-menu">
						<li><a href="http://bitovi.com">Bitovi.com</a></li>
						<li><a href="http://bitovi.com/blog/">Blog</a></li>
						<li><a href="http://bitovi.com/consulting/">Consulting</a></li>
						<li><a href="http://bitovi.com/training/">Training</a></li>
						<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
						<li><a href="http://bitovi.com/people/">People</a></li>
						<li><a href="http://bitovi.com/contact/">Contact Us</a></li>
					</ul>
				</div>
			</div>
			
		</nav>
	</header>

	
<div class="container api">

	
	<nav class="sidebar">
		
		<h2 id="version">
	<select id='versions'></select>
</h2>
<ul class="api">
	<!-- First Level -->
	
	   <li class="search-container">
	   		<a href="can.Component.html" data-search="can.Component">
				can.Component
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.Construct.html" data-search="can.Construct">
				can.Construct
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.Control.html" data-search="can.Control">
				can.Control
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.List.html" data-search="can.List">
				can.List
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.Map.html" data-search="can.Map">
				can.Map
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.Model.html" data-search="can.Model">
				can.Model
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.Model.List.html" data-search="can.Model.List">
				can.Model.List
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.compute.html" data-search="can.compute">
				can.compute
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.ejs.html" data-search="can.ejs">
				can.ejs
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.event.html" data-search="can.event">
				can.event
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.fixture.html" data-search="can.fixture">
				can.fixture
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.mustache.html" data-search="can.mustache">
				can.mustache
			</a>
			
	   </li>
	
	   <li class="search-container active">
	   		<a href="can.route.html" data-search="can.route">
				can.route
			</a>
			
				
	<ul class="primary-grouping">
		
			
				
					
					<li class="heading search-container">
						<span>plugins</span>
						
	<ul >
		
			
				
				
					<li class="search-container parent ">
						<a 	class="property" 
							href="can.route.pushstate.html" 
							data-search="can.route.pushstate">
							pushstate
						</a>
						
					</li>
				
			
			
		
	</ul>

					</li>
					
				
				
			
			
		
			
				
					
					<li class="heading search-container">
						<span>static</span>
						
	<ul >
		
			
				
				
					<li class="search-container  ">
						<a 	class="function" 
							href="can.route.current.html" 
							data-search="current">
							current
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="function" 
							href="can.route.deparam.html" 
							data-search="deparam">
							deparam
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="function" 
							href="can.route.link.html" 
							data-search="link">
							link
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container active  expanded">
						<a 	class="function" 
							href="can.route.map.html" 
							data-search="map">
							map
						</a>
						
							
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="function" 
							href="can.route.param.html" 
							data-search="param">
							param
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="function" 
							href="can.route.ready.html" 
							data-search="ready">
							ready
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="function" 
							href="can.route.url.html" 
							data-search="url">
							url
						</a>
						
					</li>
				
			
			
		
	</ul>

					</li>
					
				
				
			
			
		
	</ul>

			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.stache.html" data-search="can.stache">
				can.stache
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.util.html" data-search="can.util">
				can.util
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.view.html" data-search="can.view">
				can.view
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="can.view.bindings.html" data-search="can.view.bindings">
				can.view.bindings
			</a>
			
	   </li>
	
</ul>
	</nav>
	
	
	
	<article class="content docs">
	
	
		
		<section class="title">
			<div class="heading">
<h1>map</h1>
	<ul class="tags">
		<li>function</li>
	</ul>
	
	
</div>

<div class="sub-heading">
	
	
		<span class="module">can.route.map</span>
	
	
	
	<span class="inherits">&nbsp;</span>
</div>

<ul class="links">
    
	
		<li><a href="">source</a></li>
	
	
	
</ul>
<br />
		</section>
		
		
		
		<section class="contents">
		</section>
		
		
		

		
		<section class="description">
			<p>Assign a can.Map instance that acts as can.route's internal can.Map.  The purpose for this is to cross-bind a top level state object (Application State) to the can.route.</p>

		</section>
		

		
			
				<section class="signature">
					<h2 id="sig_can_route_map_mapConstructor_">can.route.map(mapConstructor)
</h2>
<div class="signature-wrapper">


	<h3>Parameters</h3>

	<ol class="parameters">
		
		<li class="parameter">
			<h4>mapConstructor
				<code>{<a href="can.Map.html" >can.Map</a>}</code></h4>
			<div class="description">
				<p>A can.Map constructor function.  A new can.Map instance will be created and used as the can.Map internal to can.route.</p>

			</div>
			
			
			
		</li>
		
	</ol>






</div>

				</section>
			
				<section class="signature">
					<h2 id="sig_can_route_map_mapInstance_">can.route.map(mapInstance)
</h2>
<div class="signature-wrapper">


	<h3>Parameters</h3>

	<ol class="parameters">
		
		<li class="parameter">
			<h4>mapInstance
				<code>{<a href="can.Map.html" >can.Map</a>}</code></h4>
			<div class="description">
				<p>A can.Map instance, used as the can.Map internal to can.route.</p>

			</div>
			
			
			
		</li>
		
	</ol>






</div>

				</section>
			
		
		
		
		

		
		<section class="comment">
			<h2>Use</h2>
<p>One of the biggest challenges in a complex application is getting all the different parts of the app to talk to each other simply, cleanly, and reliably.</p>
<p>An elegant way to solve this problem is using the <a href="http://en.wikipedia.org/wiki/Observer_pattern">Observer Pattern</a>. A single object, which can be called Application State, holds the high level state of the application.</p>
<p>Here is a <a href="https://www.youtube.com/watch?v=LrzK4exG5Ss">video</a> explaining how this pattern can be used in an application.</p>
<p>CanJS recommends using an Application State object in your application. There are benefits to making this state object mirror the routing in your application. <code>can.route</code> already contains an internal can.Map instance, which is serialized into the hash (or pushstate URLs).</p>
<p><code>can.route.map</code> provides an easy to way make your Application State object cross-bound to <code>can.route</code>.</p>
<pre><code>var appState = new can.Map({
    petType: &quot;dog&quot;,
    storeId: 2
});

can.route.map(appState);
</code></pre>
<p>The Application State object, which is cross-bound to the can.route via <code>can.route.map</code> and represents the overall state of the application, has several obvious uses:</p>
<ul>
<li>It is passed into the various components and used to communicate their own internal state.</li>
<li>It provides deep linking and back button support. As the URL changes, Application State changes cause changes in application components.</li>
<li>It provides the ability to &quot;save&quot; the current state of the page, by serializing the Application State object and saving it on the backend, then restoring with that object to load this saved state.</li>
</ul>
<h2>When to call it</h2>
<p>Its important to call <code>can.route.map</code> at the very start of your application's lifecycle, before any calls to <code>can.route.bind</code>. This is because <code>can.route.map</code> creates a new internal <code>can.Map</code>, replacing the default one, so this order is important to ensure you're binding to the correct Map.</p>
<h2>Basic Example</h2>
<p>A basic example of an Application State for a reporting application, is shown below:</p>
<pre><code>var appState = new can.Map({
    graphType: &quot;line&quot;,
    currencyType: &quot;USD&quot;
});

can.route.map(appState);
</code></pre>
<p>This object would then be passed into the can.Controls or can.Components that make up the building blocks of this application. Via can.route, the URL in the page would mirror the current state of the app.</p>
<h2>Demo</h2>
<p>The following shows creating an appState that loads data at page load, has a virtual property 'locationIds' which serializes an array, and synchronizes the appState to can.route:</p>
<div class='demo_wrapper' data-demo-src='can/route/docs/map.html'></div>
## Using arrays and can.Lists
<p>If the Application State contains a property which is any non-primitive type, its useful to use the [can.Map.define] plugin to define how that property will serialize. <code>can.route</code> calls <a href="can.Map.prototype.serialize.html">serialize</a> internally to turn the Application State object into URL params.</p>
<p>The following example shows a flags property, which is an array of string-based flags:</p>
<pre><code>var AppState = can.Map.extend({
  define: {
    flags: {
      // return a string friendly format
      serialize: function(){
        return this.attr('flags').join(',');
      },
      // convert a stringified object into an array
      set: function(val){
        if(val === &quot;&quot;){
            return [];
        }
        var arr = val;
        if(typeof val === &quot;string&quot;){
            arr = val.split(',')
        }
        return arr;
    }
  }
});

var appState = new AppState({
  flags: []
});

can.route.map(appState);
</code></pre>
<h2>Loading data on application start</h2>
<p>Applications commonly require loading some metadata on page load, which must be loaded as part of the Application State before the components can be initialized.</p>
<p>To implement this functionality:</p>
<ol>
<li>Define a <code>can.Map</code> constructor</li>
<li>Instantiate it</li>
<li>Call <code>can.route.map</code> with this object</li>
<li>Load the data</li>
<li>When the data is ready, add it to the appState object</li>
<li>Call <code>can.route.ready</code>, to initialize can.route and begin firing event handlers bound to can.route</li>
</ol>
<p>The following example shows a locations property, which contains a list of location <code>can.Map</code>'s loaded at page load. As users select a location, its selected property is toggled.</p>
<p>A locationIds property is defined, which is the serialized version of location. A setter is defined on locationIds, which will translate changes in locationIds back to the true source of the data in locations.</p>
<pre><code>var AppState = can.Map.extend({
    define: {
        locations: {
            // don't serialize this property at all in the route
            serialize: false
        },
        // virtual property that contains a comma separated list of ids based on locations that are selected
        locationIds: {

            // comma separated list of ids
            serialize: function(){
                var selected = this.attr('locations').filter(function(location){
                    return location.attr('selected');
                });
                var ids = [];
                selected.each(function(item){
                    ids.push(item.attr('id'));
                })
                return selected.join(',');
            },
            
            // toggle selected from a comma separated list of ids
            set: function(val){
                var arr = val;
                if(typeof val === &quot;string&quot;){
                    arr = val.split(',')
                }
                // for each id, toggle any matched location
                this.attr('locations').each(function(location){
                    if(arr.indexOf(location.attr('id')) !== -1){
                        location.attr('selected', true);
                    } else {
                        location.attr('selected', false)
                    }
                })
            }
        }
    }
});

// initialize and call map first, so anything binding to can.route will work correctly
var appState = new AppState();
can.route.map(appState);

// GET /locations
var locations = new Location.List({});

// when the data is ready, set the locations property
locations.done(function(){
    var appState.attr('locations', locations)

    // call ready after the appState is fully initialized
    can.route.ready();
})
</code></pre>

		</section>
		
		

		
	
	
	</article>
	
	

</div>





	
	
	<footer>
		<nav class="container">
			<a class="brand" href="index.html"></a>
			<ul class='nav'>
				<li >
	              <a href="../index.html">Home</a>
	            </li>
		        <li><a href='../guides/index.html'>guides</a></li>
		        <li class='active'><a href='index.html'>api</a></li>
		        <li class="">
		          <a href="../community.html#!forums">Community</a>
		        </li>
		        <li >
	              <a href="../blog/index.html">Blog</a>
	            </li>
		        <li >
	              <a href="../download.html">Download</a>
	            </li>
            </ul>
		</nav>
	</footer>
	

    
    <!--<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-2302003-11']);
	  _gaq.push(['_setDomainName', 'canjs.com']);
	  _gaq.push(['_setAllowLinker', true]);
	  _gaq.push(['_trackPageview']);
	
	  (function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	
	</script>-->
	
	<script type="text/javascript">
		var docObject = {"parent":"can.route.static","templates":"/Users/justin/dev/canjs.com/theme/templates","static":"/Users/justin/dev/canjs.com/theme/static","versionsSelectText":"CanJS v<%= version %>","glob":{"ignore":["guides/*.md","{node_modules,bower_components}/**/*"],"pattern":"**/*.{md,js}","cwd":"/Users/justin/dev/canjs.com/can"},"forceBuild":true,"dest":"/Users/justin/dev/canjs.com/docs","generators":["html"],"urls":{"builderData":"http://bitbuilder.herokuapp.com/canjs","builder":"http://bitbuilder.herokuapp.com/can.custom.js","bithub":"http://api.bithub.com/api/v1/events/","cdn":"//canjs.com/release/","github":"https://github.com/bitovi/canjs.com"},"versions":[{"branch":"master","number":"2.1"},{"number":"2.0"},{"number":"1.1"}],"defaultDownloadVersion":"2.1.3","docConfigDest":"../documentjs.json","project":{"version":"2.1","name":"canjs"},"type":"function","name":"can.route.map","description":"<p>Assign a can.Map instance that acts as can.route's internal can.Map.  The purpose for this is to cross-bind a top level state object (Application State) to the can.route.</p>\n","title":"map","signatures":[{"code":"can.route.map(mapConstructor)","description":"","params":[{"types":[{"type":"can.Map"}],"name":"mapConstructor","description":"<p>A can.Map constructor function.  A new can.Map instance will be created and used as the can.Map internal to can.route.</p>\n"}]},{"code":"can.route.map(mapInstance)","description":"","params":[{"types":[{"type":"can.Map"}],"name":"mapInstance","description":"<p>A can.Map instance, used as the can.Map internal to can.route.</p>\n"}]}],"comment":" ","src":"route/docs/map.md"};
	</script>
	
	
		<script type='text/javascript' 
				data-main="static"
				src="./static/steal.production.js"
		    		bundles-path="bundles"></script>
	
	
</body>

</html>