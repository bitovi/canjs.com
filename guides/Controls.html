<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Controls - CanJS Guides</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <link rel="stylesheet" type="text/css" 
    
      href='./static/production.css'
     />
  <!--[if lt IE 9]>
   <script type="text/javascript" src="../scripts/static/lib/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="guides">
  <header>
    <nav class="container">

      <div class="logo-menu">
        <a class="brand canjs" href="../index.html">CanJS</a>
        <ul class="dropdown-menu">
          <li><a href="http://javascriptmvc.com">JavaScriptMVC</a></li>
          <li class="active"><a href="../index.html">CanJS</a></li>
          <li><a href="http://jquerypp.com">jQuery++</a></li>
          <li><a href="http://javascriptmvc.com/docs.html#!stealjs">StealJS</a></li>
          <li><a href="http://javascriptmvc.com/docs.html#!FuncUnit">FuncUnit</a></li>
          <li><a href="http://javascriptmvc.com/docs.html#!DocumentJS">DocumentJS</a></li>
        </ul>
      </div>
      <ul class="nav">
        <li class=""><a href="../index.html">Home</a></li>
        <li class="active"><a href="../guides/index.html">Guides</a></li>
        <li class=""><a href="../docs/index.html">Api</a></li>
        <li class=" community-menu">
          <a href="../community.html#!forums">Community</a>
          <ul class="dropdown-menu">
            <li><a href="https://forum.javascriptmvc.com/canjs">Forums</a></li>
            <li><a href="http://webchat.freenode.net/?channels=canjs">IRC</a></li>
            <li><a href="http://bithub.com/canjs/app/">Apps</a></li>
            <li><a href="http://bithub.com/canjs/plugin/">Plugins</a></li>
            <li><a href="http://bithub.com/canjs/article/">Articles</a></li>
            <li><a href="http://github.com/bitovi/canjs">Github</a></li>
            <li><a href="http://twitter.com/canjs">Twitter</a></li>
          </ul>
        </li>
        <li class=""><a href="../download.html">Download</a></li>
      </ul>
      <div class="pull-right">
        <div class="bitovi-menu">
          <a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
          <ul class="dropdown-menu">
            <li><a href="http://bitovi.com">Bitovi.com</a></li>
            <li><a href="http://bitovi.com/blog/">Blog</a></li>
            <li><a href="http://bitovi.com/consulting/">Consulting</a></li>
            <li><a href="http://bitovi.com/training/">Training</a></li>
            <li><a href="http://bitovi.com/open-source/">Open Source</a></li>
            <li><a href="http://bitovi.com/people/">People</a></li>
            <li><a href="http://bitovi.com/contact/">Contact Us</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <div class="container api">
	<nav class="sidebar">
		
		<div class="search-wrapper">
			<div class="search">
				<input type="text"/>
			</div>
		</div>
		
		<ul class="api">
	<!-- First Level -->
	
	   <li class="search-container active">
	   		<a href="Tutorial.html" data-search="Getting Started">
				Getting Started
			</a>
			
				
	<ul class="primary-grouping">
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Constructs.html" 
							data-search="Constructor Classes">
							Constructor Classes
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Observes.html" 
							data-search="Observable Objects">
							Observable Objects
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Models.html" 
							data-search="Models &amp; Retrieving Data">
							Models &amp; Retrieving Data
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Templates.html" 
							data-search="Templates">
							Templates
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="EJS.html" 
							data-search="EJS">
							EJS
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Mustache.html" 
							data-search="Mustache">
							Mustache
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container active  expanded">
						<a 	class="page" 
							href="Controls.html" 
							data-search="Controls">
							Controls
						</a>
						
							
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Deferreds.html" 
							data-search="Deferreds">
							Deferreds
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Routing.html" 
							data-search="Routing">
							Routing
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Utilities.html" 
							data-search="Utility Functions">
							Utility Functions
						</a>
						
					</li>
				
			
			
		
	</ul>

			
	   </li>
	
	   <li class="search-container">
	   		<a href="Using.html" data-search="Using CanJS">
				Using CanJS
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Why.html" data-search="Why CanJS?">
				Why CanJS?
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Recipes.html" data-search="Recipes">
				Recipes
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="contributing.html" data-search="How to Contribute">
				How to Contribute
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="changelog.html" data-search="Changelog">
				Changelog
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="license.html" data-search="License">
				License
			</a>
			
	   </li>
	
</ul>
	</nav>
	<article class="content docs">
		<section class="title">
			<div class="pull-right">
	<ul class="tags">
		<li>page</li>
	</ul>
	<ul class="links">
		
			<li><a href="https://github.com/bitovi/canjs/wiki/guides_source/controls">source</a></li>
		
		
			
		
		
	</ul>
</div>

<h1>
Controls

	
		<span class="module">Controls</span>
	


</h1>

<span class="inherits">&nbsp;</span>

		</section>

		<section class="contents">
		</section>

		<section class="description">
			
		</section>

		

		
		
		
		

		
		<section class="comment">
			<p>Controls are organized, memory-leak free, performant, stateful UI
controls. can.Control lets you create controls like tabs, grids, context
menus, and forms, and helps you organize them into higher-order business
units, tying them all together with <a href="../docs/can.route.html">can.route</a>.
Controls fill the traditional MVC controller role, managing data through
Models made with can.Model and directing it to be displayed through views made
with can.view.</p>

<p>Because Controls are a subclass of Constructs, you can create control constructors and
instances just like with can.Construct. Here's what the constructor for a Control
that manages a Todo list might look like:</p>

<pre><code class="lang-javascript">var Todos = can.Control({
    init: function(el, options) {
        var self = this;
        Todo.findAll({}, function(todos) {
            self.element.html(can.view('todoList', todos));
        });
    }
});</code></pre>

<p>To instantiate a control, pass it a selector, element, or library-wrapped
NodeList that corresponds to the DOM element you want the Control to use as
the containing element (which will be set to <code>this.element</code> for that Control).
Also pass the control an object with any options for that particular instance.
These options will be extended off of the Control's constructor's static
defaults and set as <code>this.options</code> for that Control.</p>

<p>Here we'll initiate a Todos controller to hang off of the element with ID <em>todos</em>
and with no options supplied:</p>

<pre><code class="lang-javascript">var todosList = new Todos('#todos', {});</code></pre>

<p>If you specify a method called <code>init</code> when creating your Control's constructor,
that method will be called when a new instance of that Control is created. The
<code>init</code> method gets passed a library-wrapped NodeList containing <code>this.element</code>
as the first parameter and <code>this.options</code> as the second parameter. Any other
parameters you passed to the constructor during instantiation will also be passed
to <code>init</code>.</p>

<p>To demonstrate this, here is another version of the Todo list Control constructor
that can have its view overridden, and the instantiation of that Control:</p>

<pre><code class="lang-javascript">var Todos = can.Control({
    defaults: {
        view: 'todos.ejs'
    }
},{
    init: function(el, options) {
        var self = this;
        Todo.findAll({}, function(todos) {
            self.element.html(can.view(this.options.view, todos));
        });
    }
});

// this Control will use todos.ejs
new Todos(document.body.firstChild);

// this Control will use todos2.ejs
new Todos('#todoList', {view: 'todos2.ejs'});</code></pre>

<h2>Listening to events</h2>

<p>Controls will automatically bind instance methods that look like event handlers.
On this Control, <em>click</em> events on elements inside <code>this.element</code> will
trigger the console log to be written to:</p>

<pre><code class="lang-javascript">var Todos = can.Control({
    init: function(el, options) {
        var self = this;
        Todo.findAll({}, function(todos) {
            self.element.html(can.view('todoList', todos));
        });
    },
    'li click': function(el, ev) {
        console.log('You clicked ' + el.text());
    }
});</code></pre>

<p>The event handlers are passed a library-wrapped NodeList containing the element
that was clicked, and the event. can.Control uses event delegation, so you don't
need to rebind handlers when you add or remove elements.</p>

<p>One of the things that we want to do with our to-do list is delete Todos. This
is made easy with event handling in can.Control. Let's say that our view
template looks like this:</p>

<pre><code class="lang-javascript">&lt;script type="text/ejs" id="todoList">
<% this.each(function(todo) { %>
&lt;li <%= (el) -> el.data('todo', todo) %>>
    <%= todo.attr('description'); %>
    &lt;a class="destroy">X&lt;/a>
&lt;/li>
<% }) %>
&lt;/script></code></pre>

<p>We should put an event listener on our Todos Control to remove a Todo when its
destruction link is clicked:</p>

<pre><code class="lang-javascript">var Todos = can.Control({
    init: function(el, options) {
        var self = this;
        Todo.findAll({}, function(todos) {
            self.element.html(can.view('todoList', todos));
        });
    },
    'li click': function(el, ev) {
        console.log('You clicked ' + el.text());
    },
    'li .destroy click': function(el, ev) {
        var li = el.closest('li'),
            todo = li.data('todo');

        todo.destroy();
    }
});</code></pre>

<p>Destroying the Todo will take it out of the list of Todos being rendered
(because the list of Todos passed into the template is a Model List), which will
cause the template to re-render itself. This means that live binding will
remove the appropriate &lt;li> automatically.</p>

<h2>Templating event handlers</h2>

<p>If a variable is placed in braces in the event handler key, can.Control will
look up that key in the Control's <code>options</code>, and then on <code>window</code>. You can use
this to customize the events that cause handlers to fire:</p>

<pre><code class="lang-javascript">var Todos = can.Control({
    defaults: {
        destroyEvent: 'click'
    }
},{
    init: function(el, options) {
        var self = this;
        Todo.findAll({}, function(todos) {
            self.element.html(can.view(this.options.view, todos));
        });
    },
    'li .destroy {destroyEvent}': function(el, ev) {
        var li = el.closest('li'),
            todo = li.data('todo');

        todo.destroy();
    }
});

new Todos('#todos', {destroyEvent; 'mouseenter'});</code></pre>

<p>You can also use this to bind events to objects other that <code>this.element</code>
within Controls. This is critical for avoiding memory leaks that are
commonplace with other MVC applications and frameworks because it ensures that
these handlers get unbound when the control is destroyed:</p>

<pre><code class="lang-javascript">var Tooltip = can.Control({
    '{window} click': function(el, ev) {
        // hide only if we clicked outside the tooltip
        if(! this.element.has(ev.target).length) {
            this.element.remove();
        }
    }
});</code></pre>

<p>This is useful for listening to changes on models. Say that our live-binding did
not take care of removing &lt;li>s after the corresponding Model was destroyed.
In that case, we could implement that functionality by listening to when Todos
are destroyed:</p>

<pre><code class="lang-javascript">var Todos = can.Control({
    defaults: {
        destroyEvent: 'click'
    }
},{
    init: function(el, options) {
        var self = this;
        self.todosList = todos;
        Todo.findAll({}, function(todos) {
            self.element.html(can.view(this.options.view, todos));
        });
    },
    'li .destroy {destroyEvent}': function(el, ev) {
        var li = el.closest('li'),
            todo = li.data('todo');

        todo.destroy();
    },
    '{Todo} destroyed': function(Todo, ev, destroyed) {
        // find where the element is in the list
        var index = this.todosList.indexOf(destroyed);
        this.element.children(':nth-child(' + (index + 1) + ')').remove();
        this.todosList.splice(index, 1);
    }
});</code></pre>

<h2>Rebinding events</h2>

<p>You can unbind and rebind all a Control's event handlers by calling <code>on</code> on it.
This is useful when a Control starts listening to a specific Model, and you want
to change which model it is listening to.</p>

<p>In the example below, an Editor Control keeps a reference to the specific Todo
it is editing. Its <code>todo</code> method calls <code>on</code> when the Todo being edited switches,
because it needs to rebind <code>{todo} updated</code>.</p>

<pre><code class="lang-javascript">var Editor = can.Control({
    setDesc: function() {
        this.element.val(this.options.todo.description);
    },
    // change what Todo this Control points at
    todo: function(todo) {
        this.options.todo = todo;
        this.on();
        this.setDesc();
    },
    // listen for changes in the Todo
    '{todo} updated': function() {
        this.setDesc();
    },
    // when the input changes, update the Todo
    ' change': function(el, ev) {
        this.options.todo.attr('description', el.val());
        this.options.todo.save();
    }
});

var todo1 = new Todo({id: 7, description: 'Take out the trash.'}),
    todo2 = new Todo({id: 8, description: 'Wash the dishes.'}),
    editor = new Editor('#editor');

// start editing the first Todo
editor.todo(todo1);

// switch to editing the second Todo
editor.todo(todo2);</code></pre>

<h2>Destroying Controls</h2>

<p>Calling <code>destroy</code> on a Control unbinds the Control's event handlers and removes
its association with its element, but it does not remove the element from the
page.</p>

<pre><code class="lang-javascript">var list = new Todos('#todos');
$('#todos').length; // 1
list.destroy();
$('#todos').length; // 1</code></pre>

<p>However, when a Control's element is removed from the page, <code>destroy</code> is called
on the Control.</p>

<p>Taken together, templated event binding and Control's automatic cleanup make it
nearly impossible to write applications with memory leaks. An application that
uses only templated event handlers on the controls within the body could free
up all the data it uses by calling <code>$(document.body).empty()</code>.</p>
		</section>
		

		
	</article>
</div>



  <footer>
    <nav class="container">
      <a class="brand javascriptmvc" href="index.html"></a>
      <ul class="nav">
        <li class=""><a href="../index.html">Home</a></li>
        <li class="active"><a href="../guides/index.html">Guides</a></li>
        <li class=""><a href="../docs/index.html">Api</a></li>
        <li class=""><a href="../community.html#!forums">Community</a></li>
        <li class=""><a href="../download.html">Download</a></li>
      </ul>
    </nav>
  </footer>
  <script type="text/javascript">
    window.Bitovi = {
      URL: {
        BUILDER: 'http://bitbuilder.herokuapp.com/can.custom.js',
        BUILDER_DATA: 'http://bitbuilder.herokuapp.com/canjs',
        BITHUB: 'http://api.bithub.com/api/events/',
        CDN: '//canjs.com/release/'
      }
    }
    steal = {
      productionId: "production.js",
      executed: ["documentjs/site/static/build/production.css"]
    }
  </script>
  <script 
  
    src="./static/steal.production.js"
  
    ></script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2302003-11']);
  _gaq.push(['_setDomainName', 'canjs.us']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
</body>

</html>
