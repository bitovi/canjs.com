<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>CanJS - Sending Data to a Service </title>
	<meta name="description" content="">
	<meta name="author" content="">

	
	<link rel="stylesheet" type="text/css" href="./static/bundles/static.css">
	
	<!--[if lt IE 9]>
   <script type="text/javascript" src="static/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="docs ">
	<header>
		<nav class="container">

			<div class="logo-menu">
				<a class="brand" href="../index.html">CanJS</a>
				<ul class="dropdown-menu">
		          <li><a href="http://javascriptmvc.com">JavaScriptMVC</a></li>
		          <li><a href="http://canjs.com" class="active">CanJS</a></li>
		          <li><a href="http://jquerypp.com">jQuery++</a></li>
		          <li><a href="http://stealjs.com">StealJS</a></li>
		          <li><a href="http://funcunit.com">FuncUnit</a></li>
		          <li><a href="http://documentjs.com">DocumentJS</a></li>
		        </ul>
			</div>
			
			<ul class="nav">
		        <li >
	              <a href="../index.html">Home</a>
                </li>
		       <li class='active'><a href='index.html'>guides</a></li>
		       <li><a href='../docs/index.html'>api</a></li>
		        <li class=" community-menu">
		          <a href="../community.html#!forums">Community</a>
		          <ul class="dropdown-menu">
		            <li><a href="https://forum.javascriptmvc.com/canjs">Forums</a></li>
		            <li><a href="http://webchat.freenode.net/?channels=canjs">IRC</a></li>
		            <li><a href="http://bitovi.bithub.com/canjs/app/">Apps</a></li>
		            <li><a href="http://bitovi.bithub.com/canjs/plugin/">Plugins</a></li>
		            <li><a href="http://bitovi.bithub.com/canjs/article/">Articles</a></li>
		            <li><a href="http://github.com/bitovi/canjs">Github</a></li>
		            <li><a href="http://twitter.com/canjs">Twitter</a></li>
		            <li><a href="http://bitovi.github.io/canjsmeetup/">Meetups</a></li>
		          </ul>
		        </li>
		        <li >
	              <a href="../blog/index.html">Blog</a>
                </li>
		        <li >
	              <a href="../download.html">Download</a>
                </li>
	      	</ul>
			
			<div class="pull-right">
				<div class="bitovi-menu">
					<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
					<ul class="dropdown-menu">
						<li><a href="http://bitovi.com">Bitovi.com</a></li>
						<li><a href="http://bitovi.com/blog/">Blog</a></li>
						<li><a href="http://bitovi.com/design/">Design</a></li>
						<li><a href="http://bitovi.com/development/">Development</a></li>
						<li><a href="http://bitovi.com/training/">Training</a></li>
						<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
						<li><a href="http://bitovi.com/people/">People</a></li>
						<li><a href="http://bitovi.com/contact/">Contact Us</a></li>
					</ul>
				</div>
			</div>
			
		</nav>
	</header>

	
<div class="container api">

	
	<nav class="sidebar">
		
		<h2 id="version">
	<select id='versions'></select>
</h2>
<ul class="api">
	<!-- First Level -->
	
	   <li class="search-container">
	   		<a href="Why.html" data-search="Why CanJS?">
				Why CanJS?
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Using.html" data-search="Setting up CanJS">
				Setting up CanJS
			</a>
			
	   </li>
	
	   <li class="search-container active">
	   		<a href="Tutorial.html" data-search="Getting Started">
				Getting Started
			</a>
			
				
	<ul class="primary-grouping">
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Setup.html" 
							data-search="Setup">
							Setup
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Foundations.html" 
							data-search="Application Foundations">
							Application Foundations
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Components.html" 
							data-search="Getting to Know Components">
							Getting to Know Components
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Components2.html" 
							data-search="More on Components">
							More on Components
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Models.html" 
							data-search="Models (&amp; Fixtures)">
							Models (&amp; Fixtures)
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container active  expanded">
						<a 	class="page" 
							href="Models2.html" 
							data-search="Sending Data to a Service">
							Sending Data to a Service
						</a>
						
							
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Review.html" 
							data-search="Creating the Menu Component">
							Creating the Menu Component
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="State.html" 
							data-search="App State &amp; Basic Routing">
							App State &amp; Basic Routing
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Define.html" 
							data-search="The Define Plugin">
							The Define Plugin
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Routes.html" 
							data-search="Route Formatting &amp; Serialization">
							Route Formatting &amp; Serialization
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Recap.html" 
							data-search="Recap">
							Recap
						</a>
						
					</li>
				
			
			
		
	</ul>

			
	   </li>
	
	   <li class="search-container">
	   		<a href="Recipes.html" data-search="Recipes">
				Recipes
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="contributing.html" data-search="How to Contribute">
				How to Contribute
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="changelog.html" data-search="Changelog">
				Changelog
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="license.html" data-search="License">
				License
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="migrating.html" data-search="Migrating to 2.0">
				Migrating to 2.0
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="roadmap.html" data-search="Roadmap">
				Roadmap
			</a>
			
	   </li>
	
</ul>
	</nav>
	
	
	
	<article class="content docs">
	
	
		
		<section class="title">
			<div class="heading">
<h1>Sending Data to a Service</h1>
	<ul class="tags">
		<li>page</li>
	</ul>
	
	
</div>

<div class="sub-heading">
	
	
		<span class="module">Models2</span>
	
	
	
	<span class="inherits">&nbsp;</span>
</div>

<ul class="links">
	
	
		<li><a href="https://github.com/bitovi/canjs/tree/master/guides/models-2.md">source</a></li>
	
	
	
</ul>
<br />
		</section>
		
		
		
		<section class="contents">
		</section>
		
		
		

		

		
			
		
		
		
		

		
		<section class="comment">
			<hr />
<p><strong>In this Chapter</strong></p>
<ul>
<li>Saving and Updating a can.Model</li>
<li>Moving Closer to MVVM</li>
<li>Working with Non-standard Data Formats</li>
</ul>
<blockquote>
<p>Get the code for: <a href="https://github.com/bitovi/canjs/blob/guides-overhaul/guides/examples/PlaceMyOrder/ch-5_canjs-getting-started.zip?raw=true">chapter 5</a></p>
</blockquote>
<hr />
<p>To illustrate sending data to a service, let's create an order menu from which
people can select items.</p>
<p>Create a sub folder under components called <em>order_form</em>, and add the following files:</p>
<pre>
| components
    |--order_form
        |--order_form.stache
        |--order_form_component.js
</pre>
<p>Add the following to order_form.stache:</p>
<pre><code>&lt;h1&gt;{{restaurantName}}&lt;/h1&gt;

{{# each menus}}

    &lt;h3&gt;{{menuName}}&lt;/h3&gt;

    {{# each items}}
        &lt;label&gt;
            &lt;input type=&quot;checkbox&quot; can-value=&quot;selected&quot;&gt; {{name}}, ${{price}}
        &lt;/label&gt;
    {{/each}}

{{/each}}

{{#delivery}}

    &lt;div id=&quot;CustomerDetails&quot;&gt;
        &lt;label&gt;Name:
            &lt;input type=&quot;text&quot; can-value=&quot;name&quot; id=&quot;name&quot;/&gt;

            &lt;div class=&quot;warning&quot;&gt;{{issues.name}}&lt;/div&gt;
        &lt;/label&gt;

        &lt;label&gt;Address:
            &lt;input type=&quot;text&quot; can-value=&quot;address&quot; id=&quot;address&quot;/&gt;

            &lt;div class=&quot;warning&quot;&gt;{{issues.address}}&lt;/div&gt;
        &lt;/label&gt;

        &lt;label&gt;Telephone:
            &lt;input type=&quot;tel&quot; can-value=&quot;telephone&quot; id=&quot;telephone&quot;/&gt;
        &lt;/label&gt;&lt;/div&gt;

{{/delivery}}

&lt;button can-click=&quot;placeOrder&quot;&gt;Place My Order!&lt;/button&gt;
</code></pre>
<p>In the template above, we're binding the values:</p>
<ul>
<li>name</li>
<li>address</li>
<li>telephone</li>
</ul>
<p>to the &quot;delivery&quot; object of the View Model. We do that using both the delivery
section, defined by {{# each delivery}} ... {{/each}}, and the <code>can-value</code>
attribute. <code>can-value</code> is a can.view attribute that establishes two-way
binding between an element in a template and its associated View Model.</p>
<p>Add the following to order_form_component.js:</p>
<pre><code>var OrderFormViewModel = can.Map.extend({
    init: function () {
        this.attr('delivery', {});
        this.attr('order', {});
        this.attr('issues', {});
        this.attr('restaurantName', 'Spago');
        this.attr('menus', new RestaurantMenusModel.List({id: 1}));
    },
    createOrder: function (menuItems) {
        this.attr('menus').each(function (itemSet) {
            itemSet.attr('items').each(function (item) {
                if (item.attr('selected')) {
                    menuItems.push(item);
                }
            });
        });

        return new MenuOrderModel({
            delivery: this.attr('details'),
            menuItems: menuItems
        });
    },
    placeOrder: function () {

        var menuItems = [];
        var order, errorCheck, errors = {};

        order = this.createOrder.call(this, menuItems);

        if (errorCheck) {
            this.attr('issues', errors);
            return;
        }
        var that = this;

        order.save(
            function success() {
                that.attr('confirmation', 'Your Order has been Placed');
            }, function error(xhr) {
                alert(xhr.message);
            });

        this.attr('order', order);
    }
});

can.Component.extend({
    tag: &quot;order-form&quot;,
    template: can.view('components/order_form/order_form.stache'),
    scope: OrderFormViewModel
});
</code></pre>
<h2>Saving and updating a model</h2>
<p>Let's look at a few items in the code above.
Notice that we're creating a new instance of a model (MenuOrderModel) in the
createOrder function. Unlike data access methods, which are called statically
off of the prototype, the save, update, and delete methods are called off of a
specific instance of a model. So, if we want to create a new order, we will
need to work with an instance of the MenuOrderModel.</p>
<p>We assign the value of this.attr('details') to the MenuOrderModel's delivery
property. If you recall, we bound the values of the name, address, and
telephone number fields to the &quot;delivery&quot; object in the order_form.stache view
template. Now, all we need to do to get the values of those fields is
reference them off of the View Model's delivery property.</p>
<h3>Moving from DOM to the model</h3>
<p>When we created the RestaurantListComponent,
we used the {{data '...'}} Stache key, and jQuery to obtain a reference to the
restaurant object associated with the choice the user selected in the
restaurants dropdown. We almost never want to be interacting with the DOM
directly in our application. We want CanJS to take care of that for us, so we can focus
on the application itself. In the createOrder function, instead of getting our
data from the DOM, we get it from our scope.</p>
<h3>Save fixture</h3>
<p>Open up fixtures.js (in the models folder), and add the following fixture:</p>
<pre><code>/**
 * Order Fixture
 */
can.fixture('POST /order', function requestHandler(){
    return true;
});
</code></pre>
<h2>Non-standard Data Sources</h2>
<p>Staying in fixtures.js, append the following to the bottom of the file:</p>
<pre><code>/**
 * Restaurant Menus Fixture
 */
can.fixture(&quot;GET /menus/{id}&quot;, function requestHandler(request) {

    var id = parseInt(request.data.id, 10) - 1;

    var menuList = [
        {
            //Spago
            &quot;menus&quot;: [
                {
                    &quot;menuName&quot;: &quot;Lunch&quot;,
                    &quot;items&quot;: [
                        {name: &quot;Spinach Fennel Watercress Ravioli&quot;, price: 35.99, id: 32},
                        {name: &quot;Herring in Lavender Dill Reduction&quot;, price: 45.99, id: 33},
                        {name: &quot;Garlic Fries&quot;, price: 15.99, id: 34}
                    ]
                },
                {
                    &quot;menuName&quot;: &quot;Dinner&quot;,
                    &quot;items&quot;: [
                        {name: &quot;Crab Pancakes with Sorrel Syrup&quot;, price: 35.99, id: 22},
                        {name: &quot;Chicken with Tomato Carrot Chutney Sauce&quot;, price: 45.99, id: 23},
                        {name: &quot;Onion Fries&quot;, price: 15.99, id: 24}
                    ]
                }
            ]

        },
        {
            //El Bulli
            &quot;menus&quot;: [
                {
                    &quot;menuName&quot;: &quot;Lunch&quot;,
                    &quot;items&quot;: [
                        {name: &quot;Spherified Calf Brains and Lemon Rind Risotto&quot;, price: 35.99, id: 32},
                        {name: &quot;Sweet Bread Bon Bons&quot;, price: 45.99, id: 33},
                        {name: &quot;JoJos&quot;, price: 15.99, id: 34}
                    ]
                },
                {
                    &quot;menuName&quot;: &quot;Dinner&quot;,
                    &quot;items&quot;: [
                        {name: &quot;Goose Liver Arugula Foam with Kale Crackers&quot;, price: 35.99, id: 22},
                        {name: &quot;Monkey Toenails&quot;, price: 45.99, id: 23},
                        {name: &quot;Tater Tots&quot;, price: 15.99, id: 24}
                    ]
                }
            ]

        },
        {
            //The French Kitchen
            &quot;menus&quot;: [
                {
                    &quot;menuName&quot;: &quot;Lunch&quot;,
                    &quot;items&quot;: [
                        {name: &quot;Croque Monsieur&quot;, price: 35.99, id: 32},
                        {name: &quot;Pain Au Chocolat&quot;, price: 45.99, id: 33},
                        {name: &quot;Potato Latkes&quot;, price: 15.99, id: 34}
                    ]
                },
                {
                    &quot;menuName&quot;: &quot;Dinner&quot;,
                    &quot;items&quot;: [
                        {name: &quot;Chateau Briande&quot;, price: 35.99, id: 22},
                        {name: &quot;Veal Almandine&quot;, price: 45.99, id: 23},
                        {name: &quot;Hashbrowns&quot;, price: 15.99, id: 24}
                    ]
                }
            ]

        }
    ];

    return menuList[id];
});
</code></pre>
<p>In site_models.js, add the following two models:</p>
<pre><code>/**
 * RestaurantMenusModel
 * @type {void|*}
 */
var RestaurantMenusModel = can.Model.extend({
    findAll: &quot;GET /menus/{id}&quot;,
    parseModels: &quot;menus&quot;
},
{});

/**
 * Menu Order Model
 * @type {void|*}
 */
var MenuOrderModel = can.Model.extend({
    create: 'POST /order'
},
{});
</code></pre>
<p>There's a few things to notice in the code above. First, the fixture that we
defined returned a non-standard data formatâ€”non standard for CanJS. The
can.Model.findAll method expects an array from the service it calls. Our
fixture, however, is returning an object that contains an array. Normally, if
the findAll method received this data, it would throw an error. In this case,
it does not. This is because we included the <code>parseModels</code> attribute on the
MenuOrderModel.</p>
<p><code>parseModels</code> is used to convert the raw response of a findAll request into an
object or Array that the model you're defining can use. As you can see, this
method can be particularly useful if you're consuming data from a service that
doesn't fit the format expected by <code>findAll</code>.</p>
<h2>Wiring it all up</h2>
<p>We can wire all this up easily in a few steps. Edit base_template.stache, and add in the custom HTML tag for the
order_form component:</p>
<pre><code>&lt;restaurant-list&gt;&lt;/restaurant-list&gt;
&lt;!--Begin add--&gt;
&lt;order-form&gt;&lt;/order-form&gt;
&lt;!--End add--&gt;
</code></pre>
<p>Now, edit your index.html file to load the order_form_component.js file:</p>
<pre><code>&lt;script src=&quot;models/site_models.js&quot;&gt;&lt;/script&gt;
&lt;!--Begin add--&gt;
&lt;script src=&quot;components/order_form/order_form_component.js&quot;&gt;&lt;/script&gt;
&lt;!--End add--&gt;
&lt;script src=&quot;components/restaurant_list/restaurant_list_component.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>Go out to your app in the browser, and reload your page. You should see the following:</p>
<p><img src="../can/guides/images/5_model_validation/OrderMenuComponentFirstLoad.png" alt="" /></p>
<p>One thing you might immediately notice is that both the Restaurant List
component, and the Order Component are both showing on the page. Don't worry
about that for the moment. We'll deal with controlling which Components
display when we set up our Application State and Routing.</p>
<p>In the next chapter, we'll talk about connecting all of our components
together using the Application State, Routing, and can.Map's define plugin.</p>
<hr />
<p><span class="pull-left"><a href="Models.html">&lt; Models (&amp; Fixtures)</a></span></p>
<p><span class="pull-right"><a href="Review.html">Creating the Menu Component &gt;</a></span></p>

		</section>
		
		

		
	
	
	</article>
	
	

</div>





	
	
	<footer>
		<nav class="container">
			<a class="brand" href="index.html"></a>
			<ul class='nav'>
				<li >
	              <a href="../index.html">Home</a>
	            </li>
		        <li class='active'><a href='index.html'>guides</a></li>
		        <li><a href='../docs/index.html'>api</a></li>
		        <li class="">
		          <a href="../community.html#!forums">Community</a>
		        </li>
		        <li >
	              <a href="../blog/index.html">Blog</a>
	            </li>
		        <li >
	              <a href="../download.html">Download</a>
	            </li>
            </ul>
		</nav>
	</footer>
	

    
    <script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-2302003-11']);
	  _gaq.push(['_setDomainName', 'canjs.com']);
	  _gaq.push(['_setAllowLinker', true]);
	  _gaq.push(['_trackPageview']);
	
	  (function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	
	</script>
	
	<script type="text/javascript">
		var docObject = {"type":"page","name":"Models2","src":"guides/models-2.md","description":"","title":"Sending Data to a Service","parent":"Tutorial","order":6,"comment":" ","ignoreTemplateRender":true,"templates":"/Users/justin/dev/canjs.com/theme/templates","static":"/Users/justin/dev/canjs.com/theme/static","versionsSelectText":"CanJS v<%= version %>","glob":{"pattern":"{guides/*.md,*.md}","ignore":"{node_modules,bower_components}/**/*","cwd":"/Users/justin/dev/canjs.com/can"},"debug":true,"dest":"/Users/justin/dev/canjs.com/guides","generators":["html"],"urls":{"builderData":"http://bitbuilder.herokuapp.com/canjs","builder":"http://bitbuilder.herokuapp.com/can.custom.js","bithub":"http://api.bithub.com/api/v1/events/","cdn":"//canjs.com/release/","github":"https://github.com/bitovi/canjs.com"},"versions":[{"branch":"master","number":"2.1"},{"number":"2.0"},{"number":"1.1"}],"defaultDownloadVersion":"2.2.1","docConfigDest":"../documentjs.json","project":{"version":"2.2","name":"canjs","source":"git://github.com/bitovi/canjs#master"}};
	</script>
	
	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript' 
				data-main="static"
				data-config="./static/config.js"
				src="./static/steal.production.js"
		    		bundles-path="bundles"></script>
	
	
</body>

</html>