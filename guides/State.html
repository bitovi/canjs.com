<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>CanJS - App State &amp; Basic Routing </title>
	<meta name="description" content="">
	<meta name="author" content="">

	
	<link rel="stylesheet" type="text/css" href="./static/bundles/static.css">
	
	<!--[if lt IE 9]>
   <script type="text/javascript" src="static/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="docs ">
	<header>
		<nav class="container">

			<div class="logo-menu">
				<a class="brand" href="../index.html">CanJS</a>
				<ul class="dropdown-menu">
		          <li><a href="http://javascriptmvc.com">JavaScriptMVC</a></li>
		          <li><a href="http://canjs.com" class="active">CanJS</a></li>
		          <li><a href="http://jquerypp.com">jQuery++</a></li>
		          <li><a href="http://stealjs.com">StealJS</a></li>
		          <li><a href="http://funcunit.com">FuncUnit</a></li>
		          <li><a href="http://documentjs.com">DocumentJS</a></li>
		        </ul>
			</div>
			
			<ul class="nav">
		        <li >
	              <a href="../index.html">Home</a>
                </li>
		       <li class='active'><a href='index.html'>guides</a></li>
		       <li><a href='../docs/index.html'>api</a></li>
		        <li class=" community-menu">
		          <a href="../community.html#!forums">Community</a>
		          <ul class="dropdown-menu">
		            <li><a href="https://forum.javascriptmvc.com/canjs">Forums</a></li>
		            <li><a href="http://webchat.freenode.net/?channels=canjs">IRC</a></li>
		            <li><a href="http://bitovi.bithub.com/canjs/app/">Apps</a></li>
		            <li><a href="http://bitovi.bithub.com/canjs/plugin/">Plugins</a></li>
		            <li><a href="http://bitovi.bithub.com/canjs/article/">Articles</a></li>
		            <li><a href="http://github.com/bitovi/canjs">Github</a></li>
		            <li><a href="http://twitter.com/canjs">Twitter</a></li>
		            <li><a href="http://bitovi.github.io/canjsmeetup/">Meetups</a></li>
		          </ul>
		        </li>
		        <li >
	              <a href="../blog/index.html">Blog</a>
                </li>
		        <li >
	              <a href="../download.html">Download</a>
                </li>
	      	</ul>
			
			<div class="pull-right">
				<div class="bitovi-menu">
					<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
					<ul class="dropdown-menu">
						<li><a href="http://bitovi.com">Bitovi.com</a></li>
						<li><a href="http://bitovi.com/blog/">Blog</a></li>
						<li><a href="http://bitovi.com/design/">Design</a></li>
						<li><a href="http://bitovi.com/development/">Development</a></li>
						<li><a href="http://bitovi.com/training/">Training</a></li>
						<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
						<li><a href="http://bitovi.com/people/">People</a></li>
						<li><a href="http://bitovi.com/contact/">Contact Us</a></li>
					</ul>
				</div>
			</div>
			
		</nav>
	</header>

	
<div class="container api">

	
	<nav class="sidebar">
		
		<h2 id="version">
	<select id='versions'></select>
</h2>
<ul class="api">
	<!-- First Level -->
	
	   <li class="search-container">
	   		<a href="Why.html" data-search="Why CanJS?">
				Why CanJS?
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Using.html" data-search="Setting up CanJS">
				Setting up CanJS
			</a>
			
	   </li>
	
	   <li class="search-container active">
	   		<a href="Tutorial.html" data-search="Getting Started">
				Getting Started
			</a>
			
				
	<ul class="primary-grouping">
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Setup.html" 
							data-search="Setup">
							Setup
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Foundations.html" 
							data-search="Application Foundations">
							Application Foundations
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Components.html" 
							data-search="Getting to Know Components">
							Getting to Know Components
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Components2.html" 
							data-search="More on Components">
							More on Components
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Models.html" 
							data-search="Models (&amp; Fixtures)">
							Models (&amp; Fixtures)
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Models2.html" 
							data-search="Sending Data to a Service">
							Sending Data to a Service
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Review.html" 
							data-search="Creating the Menu Component">
							Creating the Menu Component
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container active  expanded">
						<a 	class="page" 
							href="State.html" 
							data-search="App State &amp; Basic Routing">
							App State &amp; Basic Routing
						</a>
						
							
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Define.html" 
							data-search="The Define Plugin">
							The Define Plugin
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Routes.html" 
							data-search="Route Formatting &amp; Serialization">
							Route Formatting &amp; Serialization
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Recap.html" 
							data-search="Recap">
							Recap
						</a>
						
					</li>
				
			
			
		
	</ul>

			
	   </li>
	
	   <li class="search-container">
	   		<a href="Recipes.html" data-search="Recipes">
				Recipes
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="contributing.html" data-search="How to Contribute">
				How to Contribute
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="changelog.html" data-search="Changelog">
				Changelog
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="license.html" data-search="License">
				License
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="migrating.html" data-search="Migrating to 2.0">
				Migrating to 2.0
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="roadmap.html" data-search="Roadmap">
				Roadmap
			</a>
			
	   </li>
	
</ul>
	</nav>
	
	
	
	<article class="content docs">
	
	
		
		<section class="title">
			<div class="heading">
<h1>App State &amp; Basic Routing</h1>
	<ul class="tags">
		<li>page</li>
	</ul>
	
	
</div>

<div class="sub-heading">
	
	
		<span class="module">State</span>
	
	
	
	<span class="inherits">&nbsp;</span>
</div>

<ul class="links">
	
	
		<li><a href="https://github.com/bitovi/canjs/tree/master/guides/state.md">source</a></li>
	
	
	
</ul>
<br />
		</section>
		
		
		
		<section class="contents">
		</section>
		
		
		

		

		
			
		
		
		
		

		
		<section class="comment">
			<hr />
<p><strong>In this Chapter</strong></p>
<ul>
<li>Application State</li>
<li>Basic Routing</li>
<li>Binding the Application State Object to the Application and Routes</li>
</ul>
<blockquote>
<p>Get the code for: <a href="https://github.com/bitovi/canjs/blob/guides-overhaul/guides/examples/PlaceMyOrder/ch-7_canjs-getting-started.zip?raw=true">chapter 7</a></p>
</blockquote>
<hr />
<p>As mentioned in the <a href="Tutorial.html">introduction</a>, CanJS uses an Application
State object to manage the state of your application. The application state
object is bound to two things:</p>
<ol>
<li>The application's base template</li>
<li>The application's routing</li>
</ol>
<p>Since you already know about creating can.Maps, creating an ApplicationState, which is a can.Map, will be easy. Let's see how this works. Open up your
app.js, and update it, as below. Note that the Application State object is a
can.Map—i.e., it is observable. You should also notice that we're creating
our can.Map in a new way—using the define plugin, which we'll discuss more
below:</p>
<pre><code>$(function () {

   var ApplicationState = can.Map.extend({
        define: {
            restaurant: {
                value: {}
            },
            menus: {
                value: null
            },
            confirmation: {
                value: {}
            }
        }
    });

    var appState = new ApplicationState();

    //Bind the application state to the root of the application
    $('#can-app').html(can.view('base_template.stache', appState));

    can.route.map(appState);

    can.route.ready();

});
</code></pre>
<h2>Routing</h2>
<p>Before we dive into the details of the Application State object,
let's quickly discuss routing. According to the docs, routing in CanJS allows
us to &quot;manage browser history and client state by synchronizing the
window.location.hash with a can.Map.&quot; In other words, we can use routing to
reflect the state of our application, or set the state of our application. One
of the things that makes routing powerful is that it records the state of the
application in the browser's history. We'll see some specific examples of this
as we proceed.</p>
<p>In our application, we setup routing by:</p>
<ul>
<li>defining the properties of our Application State object,</li>
<li>binding that object to the route with a call to can.route.map, and</li>
<li>calling can.route.ready(), which sets up two-way binding between the
browser's window.location.hash and the can.route's internal can.Map.</li>
</ul>
<p>Unless we specify otherwise, which we'll see how to do below, <em>each property
we define on our Application State will map to a potential route</em>. In the
Application State we've defined, we will, by default, have the following
<em>potential</em> routes:</p>
<ul>
<li>restaurant</li>
<li>menus, and</li>
<li>confirmation</li>
</ul>
<p>Let's take a moment, now, to see how that works.</p>
<p>Add the following line of code to app.js:</p>
<pre><code>can.route.ready();

//--&gt;Add this line, below the line above:
appState.attr('restaurant', 'Spago');
</code></pre>
<p>Now, refresh your app in the browser. The URL bar should look something like
this:</p>
<p><img src="../can/guides/images/7_application_state_routing/DefaultRouteExample_1.png" alt="" /></p>
<p>Note that, after we initialized our routes, updating the value of our
Application State's restaurant property caused the route to update, as well.
The value of the restaurant and menus properties were serialized, and appended
to the window.location.hash.</p>
<p>Let's see what happens if we adjust the value of the hash. To monitor this
change, we'll need to make a slight adjustment to our Application State
object. Modify the restaurant property as follows:</p>
<pre><code>restaurant: {
    value: {},
    set: function(newValue){
       if(typeof newValue === 'string'){
           alert(newValue);
       }
       return newValue;
    }
},
</code></pre>
<p>Refresh your app in the browser. The first thing you should notice is that you
get an alert box (or two) with the word &quot;Spago&quot; in it. By adding the set
function above, we're controlling what happens when the Application State's
restaurant property is set. More on that later. Click OK on the alert, go to
the browser's URL bar, change the URL as follows:</p>
<p><img src="../can/guides/images/7_application_state_routing/DefaultRouteExample_2.png" alt="" /></p>
<p>Once you submit that URL, you should see an alert box that reads:</p>
<p><img src="../can/guides/images/7_application_state_routing/DefaultRouteChangeAlert.png" alt="" /></p>
<h2>Application Binding</h2>
<p>It was mentioned earlier that we bound our Application State to the
application's base_template.stache. This is the key to connecting the
Application State to our components. We do that by passing Application State
attributes to the components through their custom HTML tags in
base_template.stache.</p>
<p>Open up base_template.stache, and add the following attributes to the menu tag:</p>
<pre><code>&lt;menu id=&quot;sidebar&quot; class=&quot;column col-sm-2 col-xs-1 sidebar-offcanvas&quot; menus=&quot;{menus}&quot; restaurant=&quot;{restaurant}&quot;&gt;&lt;/menu&gt;
</code></pre>
<p>In the code above, we passed the &quot;menus&quot; and &quot;restaurant&quot; attributes to our
Site Menu component, &quot;menus&quot; and &quot;confirmation&quot; to the Order Form components,
and the &quot;restaurant&quot; attribute to the Restaurant List component. <em>These
attributes will automatically be included in the scope of the components</em>.</p>
<p>Below is a diagram detailing how the connections work for connecting the
restaurant property of the Application State to the Restaurant List component:</p>
<p><img src="../can/guides/images/7_application_state_routing/AppStateBindingMap.png" alt="" /></p>
<p>Let's update our components to communicate with our Application State.</p>
<p>Open up the restaurant_list_component.js file, and edit it as follows;</p>
<pre><code>var RestaurantListViewModel = can.Map.extend({
    define: {
        currentRestaurant: {
            value: {}
        },
        currentRestaurantIndex: {
            value: {},
            type: 'number',
            set: function(newValue){
                if(!isNaN(newValue)){
                    this.attr('currentRestaurant', this.attr('restaurants')[newValue]);
                }
                return newValue;
            }
        }
    },
    init: function () {
        this.attr('restaurants', new RestaurantModel.List({}));
        this.attr('visible', true);
        this.attr('selected', {});
    },
    showMenu: function () {
        //Sets the restaurant value on the parent scope (AppState)
        this.attr('restaurant', this.attr('currentRestaurant'));
        alert(this.attr('currentRestaurant.name'));
    }

});

can.Component.extend({

    tag: 'restaurant-list',
    template: can.view('components/restaurant_list/restaurant_list.stache'),
    scope: RestaurantListViewModel

});
</code></pre>
<p>Note the showMenu function. From this function we update the &quot;restaurant&quot;
value that was passed in to the can.Component's custom HTML tag. Additionally,
we've added a <code>define</code> attribute. The define attribute is used to control the
behavior of attributes on a can.Component. We'll go into detail on <code>define</code> in
the <a href="Define.html">next chapter</a>.</p>
<p>Next, open up restaurant_list.stache, and link the PlaceOrder button with the
showMenu function we've defined, as follows:</p>
<pre><code>&lt;button id=&quot;place-order&quot; can-click=&quot;showMenu&quot;&gt;Place My Order!&lt;/button&gt;
</code></pre>
<p>We've removed the DOM code from our View Model, and are now working directly
with the application. In addition, we added code that would show and hide the content
of the can.Component to our ViewModel. We need to update our view template to reflect these
changes. In the same file (<em>restaurant_list.stache</em>), update the select dropdown
in the template as follows:</p>
<pre><code>{{#visible}}
    &lt;label for=&quot;RestaurantList&quot;&gt;Select a Restaurant:&lt;/label&gt;
    &lt;select id=&quot;RestaurantList&quot; can-value=&quot;currentRestaurantIndex&quot;&gt;
        &lt;option value=&quot;-1&quot;&gt;&lt;/option&gt;
        {{#each restaurants}}
            &lt;option value=&quot;{{@index}}&quot;&gt;{{name}}&lt;/option&gt;
        {{/each}}
    &lt;/select&gt;

    {{#if currentRestaurant}}
        {{#currentRestaurant}}
    
            &lt;!-- Code removed for brevity --&gt;
     
        {{/currentRestaurant}}
    {{/if}}

{{/visible}}
</code></pre>
<p>What we've done above is to make a connection between the index of the select
dropdown, and the index of the restaurants list in the can.Component's scope.
Whenever the currentRestaurantIndex is updated, its <code>set</code> function is called.
In its <code>set</code> function, it updates the currentRestaurant property.</p>
<p><img src="../can/guides/images/7_application_state_routing/SelectMapping.png" alt="" /></p>
<p>Now, refresh your application, select a restaurant from the list, and click
the place order button. You should see something like the following:</p>
<p><img src="../can/guides/images/7_application_state_routing/FirstComponentToAppStateCommunication.png" alt="" /></p>
<p>Next, let's remove the code in the app.js that set the restaurant to &quot;Spago&quot; by default:</p>
<pre><code>//--&gt;Remove this line:
appState.attr('restaurant', 'Spago');
</code></pre>
<p>Now that we can see the connection between the component, and the Application
State, let's make the code a little more useful. Update your Application State
object, as follows:</p>
<pre><code>define: {
    restaurant: {
        value: {},
        set: function (restaurant) {
            if (restaurant.restaurantId) {
                this.attr('menus', new RestaurantMenusModel.List({id: restaurant.restaurantId}));
                this.attr('restaurantName', restaurant.name);
            }
            return restaurant;
        }
    },
}
</code></pre>
<p>This will be a very common pattern in your applications. This setter is our
event handler. Any time a restaurant is selected (i.e., the Application
State's restaurant property is updated), we obtain its menus from our service,
and then update the Application State's menus attribute.</p>
<p>To make the OrderForm component show, and the RestaurantList component hide,
we use conditional stache tags in base_template.stache, as below:</p>
<pre><code>&lt;menu id=&quot;sidebar&quot; class=&quot;column col-sm-2 col-xs-1 sidebar-offcanvas&quot; menus=&quot;{menus}&quot; restaurant=&quot;{restaurant}&quot;&gt;&lt;/menu&gt;
{{#if menus}}
    &lt;order-form menus=&quot;{menus}&quot; restaurantName=&quot;{restaurantName}&quot; confirmation=&quot;{confirmation}&quot;&gt;&lt;/order-form&gt;
{{else}}
    &lt;restaurant-list restaurant=&quot;{restaurant}&quot;&gt;&lt;/restaurant-list&gt;
{{/if}}
</code></pre>
<p>Finally, open order_form_component.js and remove the code that set the restaurant to &quot;Spago&quot;</p>
<pre><code>var OrderFormViewModel = can.Map.extend({
    init: function () {
        this.attr('delivery', {});
        this.attr('order', {});
        this.attr('issues', {});
        //--&gt; Remove the hard-coded reference to &quot;Spago&quot; which is now passed in from the Application State
        //this.attr('restaurantName', 'Spago');
        this.attr('menus', new RestaurantMenusModel.List({id: 1}));
    },
    ...
</code></pre>
<p>When the Application State's menus attribute has a value, the order form is
displayed. Otherwise, the restaurant list is displayed. To see this in action,
select a restaurant from the list, and click the “Place My Order!”
button. You should see something like this:</p>
<p><img src="../can/guides/images/7_application_state_routing/OrderFormDisplayed.png" alt="" /></p>
<hr />
<p><span class="pull-left"><a href="Review.html">&lt; Creating the Menu Component</a></span></p>
<p><span class="pull-right"><a href="Define.html">The Define Plugin &gt;</a></span></p>

		</section>
		
		

		
	
	
	</article>
	
	

</div>





	
	
	<footer>
		<nav class="container">
			<a class="brand" href="index.html"></a>
			<ul class='nav'>
				<li >
	              <a href="../index.html">Home</a>
	            </li>
		        <li class='active'><a href='index.html'>guides</a></li>
		        <li><a href='../docs/index.html'>api</a></li>
		        <li class="">
		          <a href="../community.html#!forums">Community</a>
		        </li>
		        <li >
	              <a href="../blog/index.html">Blog</a>
	            </li>
		        <li >
	              <a href="../download.html">Download</a>
	            </li>
            </ul>
		</nav>
	</footer>
	

    
    <script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-2302003-11']);
	  _gaq.push(['_setDomainName', 'canjs.com']);
	  _gaq.push(['_setAllowLinker', true]);
	  _gaq.push(['_trackPageview']);
	
	  (function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	
	</script>
	
	<script type="text/javascript">
		var docObject = {"type":"page","name":"State","src":"guides/state.md","description":"","title":"App State & Basic Routing","parent":"Tutorial","order":8,"comment":" ","ignoreTemplateRender":true,"templates":"/Users/bitovi/Desktop/Bitovi/github/canjs.com/theme/templates","static":"/Users/bitovi/Desktop/Bitovi/github/canjs.com/theme/static","versionsSelectText":"CanJS v<%= version %>","glob":{"pattern":"{guides/*.md,*.md}","ignore":"{node_modules,bower_components}/**/*","cwd":"/Users/bitovi/Desktop/Bitovi/github/canjs.com/can"},"dest":"/Users/bitovi/Desktop/Bitovi/github/canjs.com/guides","generators":["html"],"urls":{"builderData":"https://bitbuilder.herokuapp.com/canjs","builder":"https://bitbuilder.herokuapp.com/can.custom.js","bithub":"http://bitovi.bithub.com/api/v1/events/","cdn":"//canjs.com/release/","github":"https://github.com/bitovi/canjs.com"},"versions":[{"branch":"master","number":"2.1"},{"number":"2.0"},{"number":"1.1"}],"defaultDownloadVersion":"2.2.0","docConfigDest":"../documentjs.json","project":{"version":"2.2","name":"canjs","source":"git://github.com/bitovi/canjs#master"}};
	</script>
	
	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript' 
				data-main="static"
				data-config="./static/config.js"
				src="./static/steal.production.js"
		    		bundles-path="bundles"></script>
	
	
</body>

</html>