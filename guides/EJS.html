<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>CanJS - EJS </title>
	<meta name="description" content="">
	<meta name="author" content="">

	
	<link rel="stylesheet" type="text/css" href="./static/bundles/static.css">
	
	<!--[if lt IE 9]>
   <script type="text/javascript" src="static/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="docs ">
	<header>
		<nav class="container">

			<div class="logo-menu">
				<a class="brand" href="../index.html">CanJS</a>
				<ul class="dropdown-menu">
				  <li><a href="http://donejs.com">DoneJS</a></li>
		          <li><a href="http://canjs.com" class="active">CanJS</a></li>
		          <li><a href="http://jquerypp.com">jQuery++</a></li>
		          <li><a href="http://stealjs.com">StealJS</a></li>
		          <li><a href="http://funcunit.com">FuncUnit</a></li>
		          <li><a href="http://documentjs.com">DocumentJS</a></li>
		        </ul>
			</div>

			<ul class="nav">
		        <li >
	              <a href="../index.html">Home</a>
                </li>
		       <li class='active'><a href='index.html'>guides</a></li>
		       <li><a href='../docs/index.html'>api</a></li>
		        <li class=" community-menu">
		          <a href="javascript://">Community</a>
		          <ul class="dropdown-menu">
		            <li><a href="http://forums.donejs.com/c/canjs">Forums</a></li>
		            <li><a href="https://www.npmjs.com/search?q=canjs">Plugins</a></li>
		            <li><a href="http://github.com/canjs/canjs">Github</a></li>
		            <li><a href="http://twitter.com/canjs">Twitter</a></li>
		            <li><a href="http://donejs.com/community.html">Meetups</a></li>
		          </ul>
		        </li>
		        <li>
	              <a href="http://blog.bitovi.com/category/open-source/">Blog</a>
                </li>
		        <li >
	              <a href="../download.html">Download</a>
                </li>
	      	</ul>

			<div class="pull-right">
				<div class="bitovi-menu">
					<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
					<ul class="dropdown-menu">
						<li><a href="http://bitovi.com">Bitovi.com</a></li>
						<li><a href="http://bitovi.com/blog/">Blog</a></li>
						<li><a href="http://bitovi.com/design/">Design</a></li>
						<li><a href="http://bitovi.com/development/">Development</a></li>
						<li><a href="http://bitovi.com/training/">Training</a></li>
						<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
						<li><a href="http://bitovi.com/people/">People</a></li>
						<li><a href="http://bitovi.com/contact/">Contact Us</a></li>
					</ul>
				</div>
			</div>

		</nav>
	</header>

	
<div class="container api">

	
	<nav class="sidebar">
		
		<h2 id="version">
	<select id='versions'></select>
</h2>
<ul class="api">
	<!-- First Level -->
	
	   <li class="search-container">
	   		<a href="Why.html" data-search="Why CanJS?">
				Why CanJS?
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Using.html" data-search="Setting up CanJS">
				Setting up CanJS
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Tutorial.html" data-search="Getting Started Tutorial">
				Getting Started Tutorial
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Recipes.html" data-search="Recipes">
				Recipes
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="contributing.html" data-search="How to Contribute">
				How to Contribute
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="changelog.html" data-search="Changelog">
				Changelog
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="license.html" data-search="License">
				License
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="migrating.html" data-search="Migrating to 2.0">
				Migrating to 2.0
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="roadmap.html" data-search="Roadmap">
				Roadmap
			</a>
			
	   </li>
	
</ul>
	</nav>
	
	
	
	<article class="content docs">
	
	
		
		<section class="title">
			<div class="heading">
<h1>EJS</h1>
	<ul class="tags">
		<li>page</li>
	</ul>
	
	
</div>

<div class="sub-heading">
	
	
		<span class="module">EJS</span>
	
	
	
	<span class="inherits">&nbsp;</span>
</div>

<ul class="links">
	
	
		<li><a href="https://github.com/canjs/canjs/tree/2.3-legacy/guides/ejs.md">source</a></li>
	
	
	
</ul>
<br />
		</section>
		
		
		
		<section class="contents">
		</section>
		
		
		

		

		
			
		
		
		
		

		
		<section class="comment">
			<p><a href="../docs/can.ejs.html">EJS</a> is CanJS's default template language, which provides live
binding when used with Observes. EJS is very easy to use; you write the HTML you
want to be in the template, along with a few magic tags where you want dynamic
behavior.</p>
<p>Here's an example of a template that might render a list of Todos:</p>
<pre><code>&lt;script type=&quot;text/ejs&quot; id=&quot;todoList&quot;&gt;
&lt;% for(var i = 0; i &lt; todos.length; ++i) { %&gt;
    &lt;li&gt;&lt;%= this[i].attr('description') &lt;/li&gt;
&lt;% } %&gt;
&lt;/script&gt;
</code></pre>
<p>And you can use <code>can.view</code> to render the template:</p>
<pre><code>Todo.findAll({}, function(todos) {
    document.getElementById('list')
        .appendChild(can.view('todoList', todos));
});
</code></pre>
<p>As you can see from the template and the call to <code>can.view</code>, the <code>todos</code>
object becomes <code>this</code> inside the template. EJS can also access the properties
of the <code>this</code> object without having to prefix it with <code>this.</code>:</p>
<pre><code>&lt;script type=&quot;text/ejs&quot; id=&quot;todosAndUser&quot;&gt;
&lt;h2&gt; &lt;%= user.attr('name') %&gt;&lt;/h2&gt;
&lt;% for(var i = 0; i &lt; todos.length; ++i) { %&gt;
    &lt;li&gt;&lt;%= this[i].attr('description') &lt;/li&gt;
&lt;% } %&gt;
&lt;/script&gt;
</code></pre>
<p>Which can be inserted in the document with:</p>
<pre><code>can.view('todosAndUser', {
    todos: Todo.findAll(),
    user: User.findOne({id: 5})
}).then(function(frag) {
    document.getElementById('todos').appendChild(fragment);
});
</code></pre>
<h2>Magic tags</h2>
<p>There are five kinds of magic tags used in EJS:</p>
<p><code>&lt;% %&gt;</code> will run any JavaScript code inside of it. This tag doesn't modify or
populate the template, but allows you to use for loops, if/else statements,
switch statements, and variable declarations inside the EJS template. Because
almost any JavaScript code is valid in <code>&lt;% %&gt;</code>, EJS is incredibly powerful.</p>
<p>Due to constraints necessary for live binding to function, it is heavily
encouraged to only have one line of JS code per pair of EJS tags in order to
ensure that the correct scope is maintained.</p>
<pre><code>&lt;% if(todos.attr('length') &gt; 0) { %&gt;
    &lt;div&gt;You have no to-dos.&lt;/div&gt;
&lt;% } else { %&gt;
    &lt;ul&gt;
        &lt;% todos.each(function(todo) { %&gt;
        &lt;li&gt;&lt;%= todo.attr('description') %&gt;&lt;/li&gt;
        &lt;% }); %&gt;
    &lt;/ul&gt;
&lt;% } %&gt;
</code></pre>
<p><code>&lt;%= %&gt;</code> will evaluate a JavaScript statement and write the HTML-escaped result
into the populated template. For example, an EJS template like this:</p>
<pre><code>&lt;div&gt;My favorite element is &lt;%= '&lt;b&gt;blink&lt;/b&gt;' %&gt;.&lt;/div&gt;
</code></pre>
<p>will result in HTML like this:</p>
<pre><code>&lt;div&gt;My favorite element is &amp;lt;b&amp;gt;blink&amp;lt;/b&amp;gt;.&lt;/div&gt;
</code></pre>
<p>This is almost always the tag you want to use when writing values to your
template, because it protects you against <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting attacks</a>.</p>
<p><code>&lt;%== %&gt;</code> will evaluate a JavaScript statement and write the raw result into the
populated template. This is like <code>&lt;%= %&gt;</code> but without escaping the result first.
For example, an EJS template like this:</p>
<pre><code>&lt;div&gt;My favorite element is &lt;%== '&lt;b&gt;blink&lt;/b&gt;' %&gt;.&lt;/div&gt;
</code></pre>
<p>will result in HTML like this:</p>
<pre><code>&lt;div&gt;My favorite element is &lt;b&gt;blink&lt;/b&gt;.&lt;/div&gt;
</code></pre>
<p>The most common use of <code>&lt;%== %&gt;</code> is to include templates in other templates:</p>
<pre><code>&lt;% todos.each(function(todo) { %&gt;
    &lt;li&gt;&lt;%== can.view.render('todoEJS', todo); %&gt;&lt;/li&gt;
&lt;% }); %&gt;
</code></pre>
<p>The other two magic tags are less commonly used and can be found in the
<a href="../docs/can.ejs.html">documentation for EJS</a>.</p>
<h2>Live binding</h2>
<p>Live binding will automatically update your EJS templates in the DOM whenever
the data they are populated with changes. To do this, populate your templates
with Observes and use <code>attr</code> to read properties. In this template, using
<code>attr</code> sets up live binding on the <code>description</code> property of <code>todo</code>:</p>
<pre><code>&lt;li&gt;&lt;%= todo.attr('description') %&gt;&lt;/li&gt;
</code></pre>
<p>If you change the Todo's description, the templateâ€™s output will automatically
update:</p>
<pre><code>todo.attr('description', 'Clean up the bathroom.');
</code></pre>
<p>Live binding works by wrapping the code inside the magic tags with a function
to call when the attributes inside the magic tags change. This means that a
template like this will not work:</p>
<pre><code>&lt;% for(var i = 0; i &lt; todos.length; ++i) { %&gt;
    &lt;li&gt;&lt;%= todos[i].attr('name') %&gt;&lt;/li&gt;
&lt;% } %&gt;
</code></pre>
<p>This will not work because when the function wrapping <code>todos[i].attr('name')</code> is
called, <code>i</code> will still be <em>3</em> (as that is what <code>i</code> is set to after the loop is
run). You can fix this by using a closure and the <code>each</code> method of Observes:</p>
<pre><code>&lt;% todos.each(function() { %&gt;
    &lt;li&gt;&lt;%= todo.attr('name') %&gt;&lt;/li&gt;
&lt;% }); %&gt;
</code></pre>
<p><code>each</code> will also watch the length of the list it is passed, so elements are
added or removed from it, it will update the output of the template.</p>
<h2>Element callbacks</h2>
<p>If the code inside <code>&lt;%= %&gt;</code> or <code>&lt;%== %&gt;</code> evaluates to a function, the function
will be called back with the element itâ€™s inside as its first argument. This is
useful to initialize functionality on an element within the template, like
starting an element hidden:</p>
<pre><code>&lt;img src=&quot;surprise.gif&quot; &lt;%= function(element) { element.style.display = 'none'; } %&gt;/&gt;
</code></pre>
<p>This is so common that EJS also supports <a href="http://wiki.ecmascript.org/doku.php?id=strawman:arrow_function_syntax">ECMAScript 5 arrow functions</a>
that get passed a library-wrapped NodeList containing the element. Because we
are using jQuery, the example above can be more simply written like this:</p>
<pre><code>&lt;img src=&quot;surprise.gif&quot; &lt;%= (el) -&gt; el.hide() %&gt;/&gt;
</code></pre>
<p>You can use this functionality to easily attach data to an element. A common
reason to do this is to attach a Model to the element that represents it:</p>
<pre><code>&lt;% todos.each(function(todo) { %&gt;
&lt;li &lt;%= (el) -&gt; can.data(el, 'todo', todo) %&gt;&gt;
    &lt;%= todo.attr('description') %&gt;
&lt;/li&gt;
&lt;% }) %&gt;
</code></pre>

		</section>
		
		

		

		
	
	
	</article>
	
	

</div>






	
	<footer>
		<nav class="container">
			<a class="brand" href="index.html"></a>
			<ul class='nav'>
				<li >
	              <a href="../index.html">Home</a>
	            </li>
		        <li class='active'><a href='index.html'>guides</a></li>
		        <li><a href='../docs/index.html'>api</a></li>
		        <li>
	              <a href="http://blog.bitovi.com/category/open-source/">Blog</a>
	            </li>
		        <li >
	              <a href="../download.html">Download</a>
	            </li>
            </ul>
		</nav>
	</footer>
	


    <script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-2302003-11']);
	  _gaq.push(['_setDomainName', 'canjs.com']);
	  _gaq.push(['_setAllowLinker', true]);
	  _gaq.push(['_trackPageview']);

	  (function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>

	<script type="text/javascript">
		var docObject = {"type":"page","name":"EJS","src":"guides/ejs.md","description":"","title":"EJS","comment":" ","ignoreTemplateRender":true,"templates":"/Users/daffl/Jupiter/sites/legacy-canjs.com/theme/templates","static":"/Users/daffl/Jupiter/sites/legacy-canjs.com/theme/static","versionsSelectText":"CanJS v<%= version %>","glob":{"pattern":"{guides/*.md,guides/**/*.md,*.md}","ignore":"{node_modules,bower_components}/**/*","cwd":"/Users/daffl/Jupiter/sites/legacy-canjs.com/can"},"forceBuild":true,"dest":"/Users/daffl/Jupiter/sites/legacy-canjs.com/guides","generators":["html"],"urls":{"builderData":"https://bitbuilder.herokuapp.com/canjs","builder":"https://bitbuilder.herokuapp.com/can.custom.js","bithub":"http://bitovi.bithub.com/api/v1/events/","cdn":"//canjs.com/release/","github":"https://github.com/bitovi/canjs.com"},"versions":[{"branch":"major","number":"3.0-pre"},{"branch":"master","number":"2.3"},{"number":"2.2"},{"number":"2.1"},{"number":"1.1"}],"defaultDownloadVersion":"2.3.27","docConfigDest":"../documentjs.json","project":{"version":"2.3","name":"canjs","source":"git://github.com/canjs/canjs#2.3-legacy"}};
	</script>

	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript'
				data-main="static"
				data-config="./static/config.js"
				src="./static/steal.production.js"
		    		bundles-path="bundles"></script>
	

</body>

</html>
