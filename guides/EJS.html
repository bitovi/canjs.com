<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>EJS - CanJS Guides</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <link rel="stylesheet" type="text/css" 
    
      href='./static/production.css'
     />
  <!--[if lt IE 9]>
   <script type="text/javascript" src="../scripts/static/lib/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="guides">
  <header>
    <nav class="container">

      <div class="logo-menu">
        <a class="brand canjs" href="../index.html">CanJS</a>
        <ul class="dropdown-menu">
          <li><a href="http://javascriptmvc.com">JavaScriptMVC</a></li>
          <li class="active"><a href="../index.html">CanJS</a></li>
          <li><a href="http://jquerypp.com">jQuery++</a></li>
          <li><a href="http://javascriptmvc.com/docs.html#!stealjs">StealJS</a></li>
          <li><a href="http://javascriptmvc.com/docs.html#!FuncUnit">FuncUnit</a></li>
          <li><a href="http://javascriptmvc.com/docs.html#!DocumentJS">DocumentJS</a></li>
        </ul>
      </div>
      <ul class="nav">
        <li class=""><a href="../index.html">Home</a></li>
        <li class="active"><a href="../guides/index.html">Guides</a></li>
        <li class=""><a href="../docs/index.html">Api</a></li>
        <li class=" community-menu">
          <a href="../community.html#!forums">Community</a>
          <ul class="dropdown-menu">
            <li><a href="https://forum.javascriptmvc.com/canjs">Forums</a></li>
            <li><a href="http://webchat.freenode.net/?channels=canjs">IRC</a></li>
            <li><a href="http://bithub.com/canjs/app/">Apps</a></li>
            <li><a href="http://bithub.com/canjs/plugin/">Plugins</a></li>
            <li><a href="http://bithub.com/canjs/article/">Articles</a></li>
            <li><a href="http://github.com/bitovi/canjs">Github</a></li>
            <li><a href="http://twitter.com/canjs">Twitter</a></li>
          </ul>
        </li>
        <li class=""><a href="../download.html">Download</a></li>
      </ul>
      <div class="pull-right">
        <div class="bitovi-menu">
          <a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
          <ul class="dropdown-menu">
            <li><a href="http://bitovi.com">Bitovi.com</a></li>
            <li><a href="http://bitovi.com/blog/">Blog</a></li>
            <li><a href="http://bitovi.com/consulting/">Consulting</a></li>
            <li><a href="http://bitovi.com/training/">Training</a></li>
            <li><a href="http://bitovi.com/open-source/">Open Source</a></li>
            <li><a href="http://bitovi.com/people/">People</a></li>
            <li><a href="http://bitovi.com/contact/">Contact Us</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <div class="container api">
	<nav class="sidebar">
		
		<div class="search-wrapper">
			<div class="search">
				<input type="text"/>
			</div>
		</div>
		
		<ul class="api">
	<!-- First Level -->
	
	   <li class="search-container active">
	   		<a href="Tutorial.html" data-search="Getting Started">
				Getting Started
			</a>
			
				
	<ul class="primary-grouping">
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Constructs.html" 
							data-search="Constructor Classes">
							Constructor Classes
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Observes.html" 
							data-search="Observable Objects">
							Observable Objects
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Models.html" 
							data-search="Models &amp; Retrieving Data">
							Models &amp; Retrieving Data
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Templates.html" 
							data-search="Templates">
							Templates
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container active  expanded">
						<a 	class="page" 
							href="EJS.html" 
							data-search="EJS">
							EJS
						</a>
						
							
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Mustache.html" 
							data-search="Mustache">
							Mustache
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Controls.html" 
							data-search="Controls">
							Controls
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Deferreds.html" 
							data-search="Deferreds">
							Deferreds
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Routing.html" 
							data-search="Routing">
							Routing
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Utilities.html" 
							data-search="Utility Functions">
							Utility Functions
						</a>
						
					</li>
				
			
			
		
	</ul>

			
	   </li>
	
	   <li class="search-container">
	   		<a href="Using.html" data-search="Using CanJS">
				Using CanJS
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Why.html" data-search="Why CanJS?">
				Why CanJS?
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Recipes.html" data-search="Recipes">
				Recipes
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="contributing.html" data-search="How to Contribute">
				How to Contribute
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="changelog.html" data-search="Changelog">
				Changelog
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="license.html" data-search="License">
				License
			</a>
			
	   </li>
	
</ul>
	</nav>
	<article class="content docs">
		<section class="title">
			<div class="pull-right">
	<ul class="tags">
		<li>page</li>
	</ul>
	<ul class="links">
		
			<li><a href="https://github.com/bitovi/canjs/wiki/ejs">source</a></li>
		
		
			
		
		
	</ul>
</div>

<h1>
EJS

	
		<span class="module">EJS</span>
	


</h1>

<span class="inherits">&nbsp;</span>

		</section>

		<section class="contents">
		</section>

		<section class="description">
			
		</section>

		

		
		
		
		

		
		<section class="comment">
			<p><a href="../docs/can.EJS.html">EJS</a> is CanJS's default template language, which provides live
binding when used with Observes. EJS is very easy to use; you write the HTML you
want to be in the template, along with a few magic tags where you want dynamic
behavior.</p>

<p>Here's an example of a template that might render a list of Todos:</p>

<pre><code class="lang-javascript">&lt;script type="text/ejs" id="todoList">
<% for(var i = 0; i < todos.length; ++i) { %>
    &lt;li><%= todos[i].attr('description') &lt;/li>
<% } %>
&lt;/script></code></pre>

<p>And you can use <code>can.view</code> to render the template:</p>

<pre><code class="lang-javascript">Todo.findAll({}, function(todos) {
    document.getElementById('list').appendChild(can.view('todoList', todos));
});</code></pre>

<p>As you can see from the template and the call to <code>can.view</code>, the <code>todos</code>
object becomes <code>this</code> inside the template. EJS can also access the properties
of the <code>this</code> object without having to prefix it with <code>this.</code>:</p>

<pre><code class="lang-javascript">&lt;script type="text/ejs" id="todosAndUser">
&lt;h2> <%= user.attr('name') %>&lt;/h2>
<% for(var i = 0; i < todos.length; ++i) { %>
    &lt;li><%= todos[i].attr('description') &lt;/li>
<% } %>
&lt;/script></code></pre>

<p>Which can be inserted in the document with:</p>

<pre><code class="lang-javascript">can.view('todosAndUser', {
    todos: Todo.findAll(),
    user: User.findOne({id: 5})
}).then(function(frag) {
    document.getElementById('todos').appendChild(fragment);
});</code></pre>

<h2>Magic tags</h2>

<p>There are five kinds of magic tags used in EJS:</p>

<p><code>&lt;% %&gt;</code> will run any JavaScript code inside of it. This tag doesn't modify or
populate the template, but allows you to use for loops, if/else statements, 
switch statements, and variable declarations inside the EJS template. Because
almost any JavaScript code is valid in <code>&lt;% %&gt;</code>, EJS is incredibly powerful.</p>

<p>Due to constraints necessary for live binding to function, it is heavily
encouraged to only have one line of JS code per pair of EJS tags in order to
ensure that the correct scope is maintained.</p>

<pre><code class="lang-javascript"><% if(todos.attr('length') > 0) { %>
    &lt;div>You have no to-dos.&lt;/div>
<% } else { %>
    &lt;ul>
        <% todos.each(function(todo) { %>
        &lt;li><%= todo.attr('description') %>&lt;/li>
        <% }); %>
    &lt;/ul>
<% } %></code></pre>

<p><code>&lt;%= %&gt;</code> will evaluate a JavaScript statement and write the HTML-escaped result
into the populated template. For example, an EJS template like this:</p>

<pre><code class="lang-javascript">&lt;div>My favorite element is <%= '&lt;b>blink&lt;/b>' %>.&lt;/div></code></pre>

<p>will result in HTML like this:</p>

<pre><code class="lang-javascript">&lt;div>My favorite element is &amp;lt;b&amp;gt;blink&amp;lt;/b&amp;gt;.&lt;/div></code></pre>

<p>This is almost always the tag you want to use when writing values to your
template, because it protects you against <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting attacks</a>.</p>

<p><code>&lt;%== %&gt;</code> will evaluate a JavaScript statement and write the raw result into the
populated template. This is like <code>&lt;%= %&gt;</code> but without escaping the result first.
For example, an EJS template like this:</p>

<pre><code class="lang-javascript">&lt;div>My favorite element is <%== '&lt;b>blink&lt;/b>' %>.&lt;/div></code></pre>

<p>will result in HTML like this:</p>

<pre><code class="lang-javascript">&lt;div>My favorite element is &lt;b>blink&lt;/b>.&lt;/div></code></pre>

<p>The most common use of <code>&lt;%== %&gt;</code> is to include templates in other templates:</p>

<pre><code class="lang-javascript"><% todos.each(function(todo) { %>
    &lt;li><%== can.view.render('todoEJS', todo); %>&lt;/li>
<% }); %></code></pre>

<p>The other two magic tags are less commonly used and can be found in the
<a href="../docs/can.EJS.html">documentation for EJS</a>.</p>

<h2>Live binding</h2>

<p>Live binding will automatically update your EJS templates in the DOM whenever
the data they are populated with changes. To do this, populate your templates
with Observes and use <code>attr</code> to read properties. In this template, using
<code>attr</code> sets up live binding on the <code>description</code> property of <code>todo</code>:</p>

<pre><code class="lang-javascript">&lt;li><%= todo.attr('description') %>&lt;/li></code></pre>

<p>If you change the Todo's description, the template's output will automatically
update:</p>

<pre><code class="lang-javascript">todo.attr('description', 'Clean up the bathroom.');</code></pre>

<p>Live binding works by wrapping the code inside the magic tags with a function
to call when the attributes inside the magic tags change. This means that a
template like this will not work:</p>

<pre><code class="lang-javascript"><% for(var i = 0; i < todos.length; ++i) { %>
    &lt;li><%= todos[i].attr('name') %>&lt;/li>
<% } %></code></pre>

<p>This will not work because when the function wrapping <code>todos[i].attr('name')</code> is
called, <code>i</code> will still be <em>3</em> (as that is what <code>i</code> is set to after the loop is
run). You can fix this by using a closure and the <code>each</code> method of Observes:</p>

<pre><code class="lang-javascript"><% todos.each(function() { %>
    &lt;li><%= todo.attr('name') %>&lt;/li>
<% }); %></code></pre>

<p><code>each</code> will also watch the length of the list it is passed, so elements are
added or removed from it, it will update the output of the template.</p>

<h2>Element callbacks</h2>

<p>If the code inside <code>&lt;%= %&gt;</code> or <code>&lt;%== %&gt;</code> evaluates to a function, the function
will be called back with the element it's inside as its first argument. This is
useful to initialize functionality on an element within the template, like
starting an element hidden:</p>

<pre><code class="lang-javascript">&lt;img src="surprise.gif" <%= function(element) { element.style.display = 'none'; } %>/></code></pre>

<p>This is so common that EJS also supports <a href="http://wiki.ecmascript.org/doku.php?id=strawman:arrow_function_syntax">ECMAScript 5 arrow functions</a>
that get passed a library-wrapped NodeList containing the element. Because we
are using jQuery, the example above can be more simply written like this:</p>

<pre><code class="lang-javascript">&lt;img src="surprise.gif" <%= (el) -> el.hide() %>/></code></pre>

<p>You can use this functionality to easily attach data to an element. A common
reason to do this is to attach a Model to the element that represents it:</p>

<pre><code class="lang-javascript"><% todos.each(function(todo) { %>
&lt;li <%= (el) -> can.data(el, 'todo', todo) %>>
    <%= todo.attr('description') %>
&lt;/li>
<% }) %></code></pre>
		</section>
		

		
	</article>
</div>



  <footer>
    <nav class="container">
      <a class="brand javascriptmvc" href="index.html"></a>
      <ul class="nav">
        <li class=""><a href="../index.html">Home</a></li>
        <li class="active"><a href="../guides/index.html">Guides</a></li>
        <li class=""><a href="../docs/index.html">Api</a></li>
        <li class=""><a href="../community.html#!forums">Community</a></li>
        <li class=""><a href="../download.html">Download</a></li>
      </ul>
    </nav>
  </footer>
  <script type="text/javascript">
    window.Bitovi = {
      URL: {
        BUILDER: 'http://bitbuilder.herokuapp.com/can.custom.js',
        BUILDER_DATA: 'http://bitbuilder.herokuapp.com/canjs',
        BITHUB: 'http://api.bithub.com/api/events/',
        CDN: '//canjs.com/release/'
      }
    }
    steal = {
      productionId: "production.js",
      executed: ["documentjs/site/static/build/production.css"]
    }
  </script>
  <script 
  
    src="./static/steal.production.js"
  
    ></script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2302003-11']);
  _gaq.push(['_setDomainName', 'canjs.us']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script> 
</body>

</html>
