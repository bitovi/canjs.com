<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>CanJS - App State and Routing </title>
	<meta name="description" content="">
	<meta name="author" content="">

	
	<link rel="stylesheet" type="text/css" href="./static/bundles/static.css">
	
	<!--[if lt IE 9]>
   <script type="text/javascript" src="static/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="docs ">
	<header>
		<nav class="container">

			<div class="logo-menu">
				<a class="brand" href="../index.html">CanJS</a>
				<ul class="dropdown-menu">
				  <li><a href="http://donejs.com">DoneJS</a></li>
		          <li><a href="http://canjs.com" class="active">CanJS</a></li>
		          <li><a href="http://jquerypp.com">jQuery++</a></li>
		          <li><a href="http://stealjs.com">StealJS</a></li>
		          <li><a href="http://funcunit.com">FuncUnit</a></li>
		          <li><a href="http://documentjs.com">DocumentJS</a></li>
		        </ul>
			</div>

			<ul class="nav">
		        <li >
	              <a href="../index.html">Home</a>
                </li>
		       <li class='active'><a href='index.html'>guides</a></li>
		       <li><a href='../docs/index.html'>api</a></li>
		        <li class=" community-menu">
		          <a href="javascript://">Community</a>
		          <ul class="dropdown-menu">
		            <li><a href="http://forums.donejs.com/c/canjs">Forums</a></li>
		            <li><a href="https://www.npmjs.com/search?q=canjs">Plugins</a></li>
		            <li><a href="http://github.com/canjs/canjs">Github</a></li>
		            <li><a href="http://twitter.com/canjs">Twitter</a></li>
		            <li><a href="http://donejs.com/community.html">Meetups</a></li>
		          </ul>
		        </li>
		        <li>
	              <a href="http://blog.bitovi.com/category/open-source/">Blog</a>
                </li>
		        <li >
	              <a href="../download.html">Download</a>
                </li>
	      	</ul>

			<div class="pull-right">
				<div class="bitovi-menu">
					<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
					<ul class="dropdown-menu">
						<li><a href="http://bitovi.com">Bitovi.com</a></li>
						<li><a href="http://bitovi.com/blog/">Blog</a></li>
						<li><a href="http://bitovi.com/design/">Design</a></li>
						<li><a href="http://bitovi.com/development/">Development</a></li>
						<li><a href="http://bitovi.com/training/">Training</a></li>
						<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
						<li><a href="http://bitovi.com/people/">People</a></li>
						<li><a href="http://bitovi.com/contact/">Contact Us</a></li>
					</ul>
				</div>
			</div>

		</nav>
	</header>

	
<div class="container api">

	
	<nav class="sidebar">
		
		<h2 id="version">
	<select id='versions'></select>
</h2>
<ul class="api">
	<!-- First Level -->
	
	   <li class="search-container">
	   		<a href="Why.html" data-search="Why CanJS?">
				Why CanJS?
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="Using.html" data-search="Setting up CanJS">
				Setting up CanJS
			</a>
			
	   </li>
	
	   <li class="search-container active">
	   		<a href="Tutorial.html" data-search="Getting Started Tutorial">
				Getting Started Tutorial
			</a>
			
				
	<ul class="primary-grouping">
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Setup.html" 
							data-search="Setup">
							Setup
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="ApplicationDesign.html" 
							data-search="Application Design">
							Application Design
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Constructors.html" 
							data-search="Constructors">
							Constructors
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Observables.html" 
							data-search="Observables">
							Observables
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="TheDefinePlugin.html" 
							data-search="The Define Plugin">
							The Define Plugin
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="StacheTemplates.html" 
							data-search="Stache Templates">
							Stache Templates
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container active  expanded">
						<a 	class="page" 
							href="AppStateAndRouting.html" 
							data-search="App State and Routing">
							App State and Routing
						</a>
						
							
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Components.html" 
							data-search="Components">
							Components
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="ViewModels.html" 
							data-search="View Models">
							View Models
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="DataModelsAndFixtures.html" 
							data-search="Data Models and Fixtures">
							Data Models and Fixtures
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Routing.html" 
							data-search="Routing">
							Routing
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="LoadingStates.html" 
							data-search="Loading States">
							Loading States
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="EventHandling.html" 
							data-search="Event Handling">
							Event Handling
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="WebServiceCommunication.html" 
							data-search="Web Service Communication">
							Web Service Communication
						</a>
						
					</li>
				
			
			
		
			
				
				
					<li class="search-container  ">
						<a 	class="page" 
							href="Recap.html" 
							data-search="Recap">
							Recap
						</a>
						
					</li>
				
			
			
		
	</ul>

			
	   </li>
	
	   <li class="search-container">
	   		<a href="Recipes.html" data-search="Recipes">
				Recipes
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="contributing.html" data-search="How to Contribute">
				How to Contribute
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="changelog.html" data-search="Changelog">
				Changelog
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="license.html" data-search="License">
				License
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="migrating.html" data-search="Migrating to 2.0">
				Migrating to 2.0
			</a>
			
	   </li>
	
	   <li class="search-container">
	   		<a href="roadmap.html" data-search="Roadmap">
				Roadmap
			</a>
			
	   </li>
	
</ul>
	</nav>
	
	
	
	<article class="content docs">
	
	
		
		<section class="title">
			<div class="heading">
<h1>App State and Routing</h1>
	<ul class="tags">
		<li>page</li>
	</ul>
	
	
</div>

<div class="sub-heading">
	
	
		<span class="module">AppStateAndRouting</span>
	
	
	
	<span class="inherits">&nbsp;</span>
</div>

<ul class="links">
	
	
		<li><a href="https://github.com/canjs/canjs/tree/2.3-legacy/guides/getting-started-tutorial/app-state-and-routing.md">source</a></li>
	
	
	
</ul>
<br />
		</section>
		
		
		
		<section class="contents">
		</section>
		
		
		

		

		
			
		
		
		
		

		
		<section class="comment">
			<div class="getting-started">
<hr />
<p><strong>In this Chapter</strong></p>
<ul>
<li>AppState</li>
<li>Basic Routing</li>
<li>Binding the AppState Object to the Application and Routes</li>
</ul>
<p>Get the code for: <a href="/guides/examples/PlaceMyOrder/ch-3_canjs-getting-started.zip">chapter: app state and routing</a></p>
<hr />
<p>As mentioned in the <a href="Tutorial.html">introduction</a>, CanJS suggests using a global
<code>appState</code> object to manage the state of your application. The <code>appState</code> object
is bound to two things:</p>
<ol>
<li>The application’s base template</li>
<li>The application’s routing</li>
</ol>
<p>Since you already know about creating instances of <code>can.Map</code>, creating an
<code>appState</code> object, which is a <code>can.Map</code>, will be easy. Let’s see how this works.
Open up your <code>app.js</code> file and update it as shown below.</p>
<pre><code>$(function () {
    var AppState = can.Map.extend({});

    var appState = new AppState();

    // Bind the application state to the root of the application
    $('#can-main').html(can.view('main.stache', appState));

    // Set up the routes
    can.route(':page', { page: 'home' });
    can.route(':page/:slug', { slug: null });
    can.route(':page/:slug/:action', { slug: null, action: null });

    $('body').on('click', 'a[href=&quot;javascript://&quot;]', function(ev) {
        ev.preventDefault();
    });

    // Bind the application state to the can.route
    can.route.map(appState);

    can.route.ready();

    //appState.attr('page', 'restaurants');

    appState.bind('change', function(ev, prop, change, newVal, oldVal) {
        alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');
    });
});
</code></pre>
<h2>Routing</h2>
<p>Before we dive into the details of the <code>appState</code> object, let’s quickly discuss
routing. Routing in CanJS allows us to manage browser history and client state by
synchronizing the <code>window.location.hash</code> with a <code>can.Map</code>. In other words, we can
use routing to reflect the state of our application or set the state of our application.
One of the things that makes routing powerful is that it records the state of the
application in the browser’s history. We’ll see some specific examples of this
as we proceed.</p>
<p>In our application, we setup routing by:</p>
<ul>
<li>defining the possible routes by calling <code>can.route</code>,</li>
<li>binding our <code>appState</code> object to the route with a call to <code>can.route.map</code>, and</li>
<li>calling <code>can.route.ready()</code>, which sets up two-way binding between the
browser’s <code>window.location.hash</code> and the <code>can.route</code>’s internal <code>can.Map</code>.</li>
</ul>
<p>On lines 10–12, we define all the potential routes in our application and the
properties on the <code>appState</code> object. Let’s look at each line individually.</p>
<pre><code>can.route(':page', { page: 'home' });
</code></pre>
<p>This line does two things:</p>
<ol>
<li>Creates a base route that is bound to one property: <code>page</code>.</li>
<li>Sets the default value of the <code>page</code> property to <code>'home'</code>.</li>
</ol>
<p>In our app, this will allow the following URLs:</p>
<ul>
<li><code>#!</code> (which will set <code>page</code> to <code>'home'</code> because that’s the default)</li>
<li><code>#!orders/</code> (which will set <code>page</code> to <code>'orders'</code>)</li>
<li><code>#!restaurants/</code> (which will set <code>page</code> to <code>'restaurants'</code>)</li>
</ul>
<pre><code>can.route(':page/:slug', { slug: null });
</code></pre>
<p>This line does two things:</p>
<ol>
<li>Binds a new <code>slug</code> property to our <code>appState</code> object.</li>
<li>Sets the default value of the <code>slug</code> property to <code>null</code>.</li>
</ol>
<p>This makes the following URLs possible:</p>
<ul>
<li><code>#!restaurants/spago/</code> (<code>page</code> will be <code>'restaurants'</code> and <code>slug</code> will be <code>'spago'</code>)</li>
</ul>
<p>Anything in the second part of the URL will be the <code>slug</code> property on our
<code>appState</code> object.</p>
<pre><code>can.route(':page/:slug/:action', { slug: null, action: null });
</code></pre>
<p>This line does two things:</p>
<ol>
<li>Binds a new <code>action</code> property to our <code>appState</code> object.</li>
<li>Sets the default value of the <code>action</code> property to <code>null</code>.</li>
</ol>
<p>This makes the following URLs possible:</p>
<ul>
<li><code>#!restaurants/spago/order/</code> for order confirmation; again, <code>action</code> will be <code>'order'</code></li>
</ul>
<p>Let’s take a moment to see how these routes are bound to our <code>appState</code> object.
Notice the <code>//appState.attr('page', 'restaurants');</code> line at the end of our
<code>app.js</code> file; let’s uncomment that line so it looks like
<code>appState.attr('page', 'restaurants');</code></p>
<p>Now, refresh the app in your browser. The path will now be <code>#!restaurants</code>,
and you’ll notice that the Restaurants link in the navigation is highlighted.</p>
<p><img src="../can/guides/images/app-state-routing/app_state_route_rest.png" alt="place-my-order.com home page" /></p>
<p>Note that, after we initialized our routes, updating the value of our
<code>appState</code>’s <code>page</code> property caused the route to update as well.
The value of the <code>page</code> property was serialized and appended
to the <code>window.location.hash</code>.</p>
<p>Let’s see what happens if we adjust the value of the hash. To monitor this
change, we’ve included the following lines:</p>
<pre><code>appState.bind('change', function(ev, prop, change, newVal, oldVal) {
    alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');
});
</code></pre>
<p>These lines use <a href="../docs/can.Map.prototype.bind.html"><code>can.Map.bind</code></a> to
watch for changes to the <code>appState</code> object. Go ahead and change the URL from
<code>#!restaurants</code> to <code>#!orders</code>. You should see an alert with this message:</p>
<p><img src="../can/guides/images/app-state-routing/change_state_alert.png" alt="place-my-order.com home page" /></p>
<p>It was mentioned earlier that we bound our AppState to the application’s <code>main.stache</code>.
This is the key to connecting the AppState to our <a href="Components.html">components</a>.
Because the <code>appState</code> object is bound to our main template, which includes the rest of
the components in the app, <em>these attributes will automatically be included in the scope of
the components</em>.</p>
<p>Before moving on, let’s remove the following lines from our application:</p>
<pre><code>appState.attr('page', 'restaurants');

appState.bind('change', function(ev, prop, change, newVal, oldVal) {
    alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');
});
</code></pre>
<hr />
<p><span class="pull-left"><a href="StacheTemplates.html">&lsaquo; Stache Templates</a></span>
<span class="pull-right"><a href="Components.html">Components &rsaquo;</a></span></p>
</div>

		</section>
		
		

		

		
	
	
	</article>
	
	

</div>






	
	<footer>
		<nav class="container">
			<a class="brand" href="index.html"></a>
			<ul class='nav'>
				<li >
	              <a href="../index.html">Home</a>
	            </li>
		        <li class='active'><a href='index.html'>guides</a></li>
		        <li><a href='../docs/index.html'>api</a></li>
		        <li>
	              <a href="http://blog.bitovi.com/category/open-source/">Blog</a>
	            </li>
		        <li >
	              <a href="../download.html">Download</a>
	            </li>
            </ul>
		</nav>
	</footer>
	


    <script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-2302003-11']);
	  _gaq.push(['_setDomainName', 'canjs.com']);
	  _gaq.push(['_setAllowLinker', true]);
	  _gaq.push(['_trackPageview']);

	  (function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>

	<script type="text/javascript">
		var docObject = {"type":"page","name":"AppStateAndRouting","src":"guides/getting-started-tutorial/app-state-and-routing.md","description":"","title":"App State and Routing","parent":"Tutorial","order":6,"disabletableofcontents":true,"comment":" ","ignoreTemplateRender":true,"templates":"/Users/kevin/dev/canjs.com/theme/templates","static":"/Users/kevin/dev/canjs.com/theme/static","versionsSelectText":"CanJS v<%= version %>","glob":{"pattern":"{guides/*.md,guides/**/*.md,*.md}","ignore":"{node_modules,bower_components}/**/*","cwd":"/Users/kevin/dev/canjs.com/can"},"dest":"/Users/kevin/dev/canjs.com/guides","generators":["html"],"urls":{"builderData":"https://bitbuilder.herokuapp.com/canjs","builder":"https://bitbuilder.herokuapp.com/can.custom.js","bithub":"http://bitovi.bithub.com/api/v1/events/","cdn":"//canjs.com/release/","github":"https://github.com/bitovi/canjs.com"},"versions":[{"branch":"major","number":"3.0-pre"},{"branch":"master","number":"2.3"},{"number":"2.2"},{"number":"2.1"},{"number":"1.1"}],"defaultDownloadVersion":"2.3.28","docConfigDest":"../documentjs.json","project":{"version":"2.3","name":"canjs","source":"git://github.com/canjs/canjs#2.3-legacy"}};
	</script>

	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript'
				data-main="static"
				data-config="./static/config.js"
				src="./static/steal.production.js"
		    		bundles-path="bundles"></script>
	

</body>

</html>
