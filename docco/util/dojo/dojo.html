<!DOCTYPE html>

<html>
<head>
  <title>dojo.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>dojo.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-string">"format steal"</span>;
steal(<span class="hljs-string">'can/util/can.js'</span>, <span class="hljs-string">'can/util/attr'</span>, <span class="hljs-string">'dojo'</span>, <span class="hljs-string">'can/event'</span>, <span class="hljs-string">'can/util/fragment.js'</span>,
	<span class="hljs-string">'can/util/array/each.js'</span>,
	<span class="hljs-string">'can/util/object/isplain'</span>,
	<span class="hljs-string">'can/util/deferred.js'</span>,
	<span class="hljs-string">'can/util/hashchange.js'</span>,
	<span class="hljs-string">'can/util/inserted'</span>,
	<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">can, attr, djo</span>) </span>{

	<span class="hljs-keyword">var</span> dojo = djo || <span class="hljs-built_in">window</span>.dojo;
	define(<span class="hljs-string">'plugd/trigger'</span>, [<span class="hljs-string">'dojo/main'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> d = dojo;
		<span class="hljs-keyword">var</span> isfn = d.isFunction;
		<span class="hljs-keyword">var</span> leaveRe = <span class="hljs-regexp">/mouse(enter|leave)/</span>;
		<span class="hljs-keyword">var</span> _fix = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_, p</span>) </span>{
			<span class="hljs-keyword">return</span> <span class="hljs-string">'mouse'</span> + (p === <span class="hljs-string">'enter'</span> ? <span class="hljs-string">'over'</span> : <span class="hljs-string">'out'</span>);
		};
		<span class="hljs-keyword">var</span> mix = d._mixin;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>the guts of the node triggering logic:
the function accepts node (not string|node), “on”-less event name,
and an object of args to mix into the event. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> realTrigger;

		<span class="hljs-keyword">if</span> (d.doc.createEvent) {
			realTrigger = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n, e, a</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>the sane branch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> ev = d.doc.createEvent(<span class="hljs-string">'HTMLEvents'</span>);
				e = e.replace(leaveRe, _fix);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>removed / inserted events should not bubble</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				ev.initEvent(e, e === <span class="hljs-string">'removed'</span> || e === <span class="hljs-string">'inserted'</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
				<span class="hljs-keyword">if</span> (a) {
					mix(ev, a);
				}
				n.dispatchEvent(ev);
			};
		} <span class="hljs-keyword">else</span> {
			realTrigger = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n, e, a</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>the janktastic branch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> ev = <span class="hljs-string">'on'</span> + e,
					stop = <span class="hljs-literal">false</span>;
				<span class="hljs-keyword">try</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>FIXME: is this worth it? for mixed-case native event support:? Opera ends up in the
createEvent path above, and also fails on <em>some</em> native-named events.
                if(lc !== e &amp;&amp; d.indexOf(d.NodeList.events, lc) &gt;= 0){
                    // if the event is one of those listed in our NodeList list
                    // in lowercase form but is mixed case, throw to avoid
                    // fireEvent. /me sighs. <a href="http://gist.github.com/315318">http://gist.github.com/315318</a>
                    throw(“janktastic”);
                }</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> evObj = <span class="hljs-built_in">document</span>.createEventObject();
					<span class="hljs-keyword">if</span> (e === <span class="hljs-string">"inserted"</span> || e === <span class="hljs-string">"removed"</span>) {
						evObj.cancelBubble = <span class="hljs-literal">true</span>;
					}
					mix(evObj, a);
					n.fireEvent(ev, evObj);
				} <span class="hljs-keyword">catch</span> (er) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>a lame duck to work with. we’re probably a ‘custom event’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> evdata = mix({
						<span class="hljs-attr">type</span>: e,
						<span class="hljs-attr">target</span>: n,
						<span class="hljs-attr">faux</span>: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>HACK: [needs] added support for customStopper to _base/event.js
some tests will fail until del._stopPropagation has support.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						_stopper: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
							stop = <span class="hljs-keyword">this</span>.cancelBubble;
						}
					}, a);
					<span class="hljs-keyword">if</span> (isfn(n[ev])) {
						n[ev](evdata);
					}
					<span class="hljs-keyword">if</span> (e === <span class="hljs-string">"inserted"</span> || e === <span class="hljs-string">"removed"</span>) {
						<span class="hljs-keyword">return</span>;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>handle bubbling of custom events, unless the event was stopped.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">while</span> (!stop &amp;&amp; n !== d.doc &amp;&amp; n.parentNode) {
						n = n.parentNode;
						<span class="hljs-keyword">if</span> (isfn(n[ev])) {
							n[ev](evdata);
						}
					}
				}
			};
		}
		d._trigger = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node, event, extraArgs</span>) </span>{
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> event !== <span class="hljs-string">'string'</span>) {
				extraArgs = event;
				event = extraArgs.type;
				<span class="hljs-keyword">delete</span> extraArgs.type;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>summary:
    Helper for <code>dojo.trigger</code>, which handles the DOM cases. We should never
    be here without a domNode reference and a string eventname.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> n = d.byId(node),
				ev = event &amp;&amp; event.slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>) === <span class="hljs-string">'on'</span> ? event.slice(<span class="hljs-number">2</span>) : event;
			realTrigger(n, ev, extraArgs);
		};
		d.trigger = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj, event, extraArgs</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>summary: 
    Trigger some event. It can be either a Dom Event, Custom Event, 
    or direct function call. </p>
<p>description:
    Trigger some event. It can be either a Dom Event, Custom Event, 
    or direct function call. NOTE: This function does not trigger
    default behavior, only triggers bound event listeneres. eg:
    one cannot trigger(“anchorNode”, “onclick”) and expect the browser
    to follow the href=”” attribute naturally.</p>
<p>obj: String|DomNode|Object|Function
    An ID, or DomNode reference, from which to trigger the event.
    If an Object, fire the <code>event</code> in the scope of this object,
    similar to calling dojo.hitch(obj, event)(). The return value
    in this case is returned from <code>dojo.trigger</code></p>
<p>event: String|Function
    The name of the event to trigger. can be any DOM level 2 event
    and can be in either form: “onclick” or “click” for instance.
    In the object-firing case, this method can be a function or
    a string version of a member function, just like <code>dojo.hitch</code>.</p>
<p>extraArgs: Object?
    An object to mix into the <code>event</code> object passed to any bound 
    listeners. Be careful not to override important members, like
    <code>type</code>, or <code>preventDefault</code>. It will likely error.</p>
<pre><code>Additionally, extraArgs is moot <span class="hljs-keyword">in</span> the object-triggering <span class="hljs-keyword">case</span>,
<span class="hljs-keyword">as</span> all <span class="hljs-built_in">arguments</span> beyond the <span class="hljs-string">`event`</span> are curried onto the triggered
<span class="hljs-function"><span class="hljs-keyword">function</span>.</span>
</code></pre><p>example: 
|    dojo.connect(node, “onclick”, function(e){ /<em> stuff </em>/ });
|    // later:
|    dojo.trigger(node, “onclick”);</p>
<p>example:
|    // or from within dojo.query: (requires dojo.NodeList)
|    dojo.query(“a”).onclick(function(){}).trigger(“onclick”);</p>
<p>example:
|    // fire obj.method() in scope of obj
|    dojo.trigger(obj, “method”);</p>
<p>example:
|    // fire an anonymous function:
|    dojo.trigger(d.global, function(){ /<em> stuff </em>/ });</p>
<p>example: 
|    // fire and anonymous function in the scope of obj
|    dojo.trigger(obj, function(){ this == obj; });</p>
<p>example:
|    // with a connected function like:
|    dojo.connect(dojo.doc, “onclick”, function(e){
|        if(e &amp;&amp; e.manuallydone){
|            console.log(“this was a triggered onclick, not natural”);
|        }
|    });
|    // fire onclick, passing in a custom bit of info
|    dojo.trigger(“someId”, “onclick”, { manuallydone:true });</p>
<p>returns: Anything
    Will not return anything in the Dom event case, but will return whatever
    return value is received from the triggered event. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">return</span> isfn(obj) || isfn(event) || isfn(obj[event]) ? d.hitch.apply(d, <span class="hljs-built_in">arguments</span>)() : d._trigger.apply(d, <span class="hljs-built_in">arguments</span>);
		};
		d.NodeList.prototype.trigger = d.NodeList._adaptAsForEach(d._trigger);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if the node.js module is available, extend trigger into that.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (d._Node &amp;&amp; !d._Node.prototype.trigger) {
			d.extend(d._Node, {
				<span class="hljs-attr">trigger</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev, data</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>summary:
    Fire some some event originating from this node.
    Only available if both the <code>dojo.trigger</code> and <code>dojo.node</code> plugin 
    are enabled. Allows chaining as all <code>dojo._Node</code> methods do.</p>
<p>ev: String
    Some string event name to fire. eg: “onclick”, “submit”</p>
<p>data: Object
    Just like <code>extraArgs</code> for <code>dojo.trigger</code>, additional data
    to mix into the event object.</p>
<p>example:
|    // fire onlick orginiating from a node with id=”someAnchorId”
|    dojo.node(“someAnchorId”).trigger(“click”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					d._trigger(<span class="hljs-keyword">this</span>, ev, data);
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>; <span class="hljs-comment">// dojo._Node</span>
				}
			});
		}
		<span class="hljs-keyword">return</span> d.trigger;
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2 id="dojo-js">dojo.js</h2>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><em>dojo node list.</em></p>
<p>These are pre-loaded by <code>steal</code> -&gt; no callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-built_in">require</span>([
		<span class="hljs-string">'dojo/main'</span>,
		<span class="hljs-string">'dojo/query'</span>,
		<span class="hljs-string">'plugd/trigger'</span>,
		<span class="hljs-string">'dojo/NodeList-dom'</span>
	]);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Map string helpers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.trim = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) </span>{
		<span class="hljs-keyword">return</span> s &amp;&amp; dojo.trim(s);
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Map array helpers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.makeArray = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arr</span>) </span>{
		<span class="hljs-keyword">var</span> array = [];
		dojo.forEach(arr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{
			array.push(item);
		});
		<span class="hljs-keyword">return</span> array;
	};
	can.isArray = dojo.isArray;
	can.inArray = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, arr, from</span>) </span>{
		<span class="hljs-keyword">return</span> dojo.indexOf(arr, item, <span class="hljs-keyword">from</span>);
	};
	can.map = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arr, fn</span>) </span>{
		<span class="hljs-keyword">return</span> dojo.map(can.makeArray(arr || []), fn);
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Map object helpers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.extend = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">first</span>) </span>{
		<span class="hljs-keyword">if</span> (first === <span class="hljs-literal">true</span>) {
			<span class="hljs-keyword">var</span> args = can.makeArray(<span class="hljs-built_in">arguments</span>);
			args.shift();
			<span class="hljs-keyword">return</span> dojo.mixin.apply(dojo, args);
		}
		<span class="hljs-keyword">return</span> dojo.mixin.apply(dojo, <span class="hljs-built_in">arguments</span>);
	};
	can.isEmptyObject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">object</span>) </span>{
		<span class="hljs-keyword">var</span> prop;
		<span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> object) {
			<span class="hljs-keyword">break</span>;
		}
		<span class="hljs-keyword">return</span> prop === <span class="hljs-literal">undefined</span>;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Use a version of param similar to jQuery’s param that
handles nested data instead of dojo.objectToQuery which doesn’t</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.param = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">object</span>) </span>{
		<span class="hljs-keyword">var</span> pairs = [],
			add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, value</span>) </span>{
				pairs.push(<span class="hljs-built_in">encodeURIComponent</span>(key) + <span class="hljs-string">'='</span> + <span class="hljs-built_in">encodeURIComponent</span>(value));
			};
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> object) {
			can.buildParam(name, object[name], add);
		}
		<span class="hljs-keyword">return</span> pairs.join(<span class="hljs-string">'&amp;'</span>)
			.replace(<span class="hljs-regexp">/%20/g</span>, <span class="hljs-string">'+'</span>);
	};
	can.buildParam = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prefix, obj, add</span>) </span>{
		<span class="hljs-keyword">if</span> (can.isArray(obj)) {
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = obj.length; i &lt; l; ++i) {
				add(prefix + <span class="hljs-string">'[]'</span>, obj[i]);
			}
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dojo.isObject(obj)) {
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> obj) {
				can.buildParam(prefix + <span class="hljs-string">'['</span> + name + <span class="hljs-string">']'</span>, obj[name], add);
			}
		} <span class="hljs-keyword">else</span> {
			add(prefix, obj);
		}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Map function helpers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.proxy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">func, context</span>) </span>{
		<span class="hljs-keyword">return</span> dojo.hitch(context, func);
	};
	can.isFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
		<span class="hljs-keyword">return</span> dojo.isFunction(f);
	};
	<span class="hljs-comment">/**
	 * EVENTS
	 *
	 * Dojo does not use the callback handler when unbinding.  Instead
	 * when binding (dojo.connect or dojo.on) an object with a remove
	 * method is returned.
	 *
	 * Because of this, we have to map each callback to the "remove"
	 * object to it can be passed to dojo.disconnect.
	 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>The id of the <code>function</code> to be bound, used as an expando on the <code>function</code>
so we can lookup it’s <code>remove</code> object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> dojoId = <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Checks if a Node is a form node that can contain other elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		isFormNode = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
			<span class="hljs-keyword">return</span> node.nodeName === <span class="hljs-string">'SELECT'</span> || node.nodeName === <span class="hljs-string">'FORM'</span>;
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Takes a node list, goes through each node
and adds events data that has a map of events to
callbackId to <code>remove</code> object.  It looks like
<code>{click: {5: {remove: fn}}}</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		dojoAddBinding = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nodelist, ev, cb</span>) </span>{
			nodelist.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Converting a raw select node to a node list
returns a node list of its options due to a
bug in Dojo 1.7.1, this is sovled by wrapping
it in an array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				node = <span class="hljs-keyword">new</span> dojo.NodeList(isFormNode(node) ? [node] : node);
				<span class="hljs-keyword">var</span> events = can.data(node, <span class="hljs-string">'events'</span>);
				<span class="hljs-keyword">if</span> (!events) {
					can.data(node, <span class="hljs-string">'events'</span>, events = {});
				}
				<span class="hljs-keyword">if</span> (!events[ev]) {
					events[ev] = {};
				}
				<span class="hljs-keyword">if</span> (cb.__bindingsIds === <span class="hljs-literal">undefined</span>) {
					cb.__bindingsIds = dojoId++;
				}
				events[ev][cb.__bindingsIds] = node.on(ev, cb)[<span class="hljs-number">0</span>];
			});
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Removes a binding on a <code>nodelist</code> by finding
the remove object within the object’s data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		dojoRemoveBinding = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nodelist, ev, cb</span>) </span>{
			nodelist.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
				<span class="hljs-keyword">var</span> currentNode = <span class="hljs-keyword">new</span> dojo.NodeList(node),
					events = can.data(currentNode, <span class="hljs-string">'events'</span>);
				<span class="hljs-keyword">if</span> (!events) {
					<span class="hljs-keyword">return</span>;
				}
				<span class="hljs-keyword">var</span> handlers = events[ev];
				<span class="hljs-keyword">if</span> (!handlers) {
					<span class="hljs-keyword">return</span>;
				}
				<span class="hljs-keyword">var</span> handler = handlers[cb.__bindingsIds];
				dojo.disconnect(handler);
				<span class="hljs-keyword">delete</span> handlers[cb.__bindingsIds];
				<span class="hljs-keyword">if</span> (can.isEmptyObject(handlers)) {
					<span class="hljs-keyword">delete</span> events[ev];
				}
			});
		};
	can.bind = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev, cb</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>If we can bind to it…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.bind &amp;&amp; <span class="hljs-keyword">this</span>.bind !== can.bind) {
			<span class="hljs-keyword">this</span>.bind(ev, cb); <span class="hljs-comment">// Otherwise it's an element or `nodeList`.</span>
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.on || <span class="hljs-keyword">this</span>.nodeType) {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Converting a raw select node to a node list
returns a node list of its options due to a
bug in Dojo 1.7.1, this is sovled by wrapping
it in an array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			dojoAddBinding(<span class="hljs-keyword">new</span> dojo.NodeList(isFormNode(<span class="hljs-keyword">this</span>) ? [<span class="hljs-keyword">this</span>] : <span class="hljs-keyword">this</span>), ev, cb);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.addEvent) {
			<span class="hljs-keyword">this</span>.addEvent(ev, cb);
		} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Make it bind-able…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			can.addEvent.call(<span class="hljs-keyword">this</span>, ev, cb);
		}
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	};
	can.unbind = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev, cb</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If we can bind to it…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.unbind &amp;&amp; <span class="hljs-keyword">this</span>.unbind !== can.unbind) {
			<span class="hljs-keyword">this</span>.unbind(ev, cb);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.on || <span class="hljs-keyword">this</span>.nodeType) {
			dojoRemoveBinding(<span class="hljs-keyword">new</span> dojo.NodeList(<span class="hljs-keyword">this</span>), ev, cb);
		} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Make it bind-able…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			can.removeEvent.call(<span class="hljs-keyword">this</span>, ev, cb);
		}
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Alias on/off to bind/unbind respectively</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.on = can.bind;
	can.off = can.unbind;
	can.trigger = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, event, args, bubble</span>) </span>{
		<span class="hljs-keyword">if</span> (!(item <span class="hljs-keyword">instanceof</span> dojo.NodeList) &amp;&amp; (item.nodeName || item === <span class="hljs-built_in">window</span>)) {
			item = can.$(item);
		}
		<span class="hljs-keyword">if</span> (item.trigger) {
			<span class="hljs-keyword">if</span> (bubble === <span class="hljs-literal">false</span>) {
				<span class="hljs-keyword">if</span> (!item[<span class="hljs-number">0</span>] || item[<span class="hljs-number">0</span>].nodeType === <span class="hljs-number">3</span>) {
					<span class="hljs-keyword">return</span>;
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Force stop propagation by
listening to <code>on</code> and then immediately disconnecting.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> connect = item.on(event, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ev</span>) </span>{
					<span class="hljs-keyword">if</span> (ev.stopPropagation) {
						ev.stopPropagation();
					}
					ev.cancelBubble = <span class="hljs-literal">true</span>;
					<span class="hljs-keyword">if</span> (ev._stopper) {
						ev._stopper();
					}
					dojo.disconnect(connect);
				});
				item.trigger(event, args);
			} <span class="hljs-keyword">else</span> {
				item.trigger(event, args);
			}
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> event === <span class="hljs-string">'string'</span>) {
				event = {
					<span class="hljs-attr">type</span>: event
				};
			}
			event.target = event.target || item;
			can.dispatch.call(item, event, can.makeArray(args));
		}
	};
	can.delegate = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">selector, ev, cb</span>) </span>{
		<span class="hljs-keyword">if</span> (!selector) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Dojo fails with no selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			can.bind.call(<span class="hljs-keyword">this</span>, ev, cb);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.on || <span class="hljs-keyword">this</span>.nodeType) {
			dojoAddBinding(<span class="hljs-keyword">new</span> dojo.NodeList(<span class="hljs-keyword">this</span>), selector + <span class="hljs-string">':'</span> + ev, cb);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.delegate) {
			<span class="hljs-keyword">this</span>.delegate(selector, ev, cb);
		} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>make it bind-able …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			can.bind.call(<span class="hljs-keyword">this</span>, ev, cb);
		}
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	};
	can.undelegate = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">selector, ev, cb</span>) </span>{
		<span class="hljs-keyword">if</span> (!selector) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Dojo fails with no selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			can.unbind.call(<span class="hljs-keyword">this</span>, ev, cb);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.on || <span class="hljs-keyword">this</span>.nodeType) {
			dojoRemoveBinding(<span class="hljs-keyword">new</span> dojo.NodeList(<span class="hljs-keyword">this</span>), selector + <span class="hljs-string">':'</span> + ev, cb);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.undelegate) {
			<span class="hljs-keyword">this</span>.undelegate(selector, ev, cb);
		} <span class="hljs-keyword">else</span> {
			can.unbind.call(<span class="hljs-keyword">this</span>, ev, cb);
		}
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	};
	<span class="hljs-comment">/**
	 * Ajax
	 */</span>
	<span class="hljs-keyword">var</span> updateDeferred = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">xhr, d</span>) </span>{
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> xhr) {
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> d[prop] === <span class="hljs-string">'function'</span>) {
				d[prop] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
					xhr[prop].apply(xhr, <span class="hljs-built_in">arguments</span>);
				};
			} <span class="hljs-keyword">else</span> {
				d[prop] = prop[xhr];
			}
		}
	};
	can.ajax = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) </span>{
		<span class="hljs-keyword">var</span> type = can.capitalize((options.type || <span class="hljs-string">'get'</span>)
				.toLowerCase()),
			method = dojo[<span class="hljs-string">'xhr'</span> + type];
		<span class="hljs-keyword">var</span> success = options.success,
			error = options.error,
			d = <span class="hljs-keyword">new</span> can.Deferred();
		<span class="hljs-keyword">var</span> def = method({
			<span class="hljs-attr">url</span>: options.url,
			<span class="hljs-attr">handleAs</span>: options.dataType,
			<span class="hljs-attr">sync</span>: !options.async,
			<span class="hljs-attr">headers</span>: options.headers,
			<span class="hljs-attr">content</span>: options.data
		});
		def.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, ioargs</span>) </span>{
			updateDeferred(xhr, d);
			d.resolve(data, <span class="hljs-string">'success'</span>, xhr);
			<span class="hljs-keyword">if</span> (success) {
				success(data, <span class="hljs-string">'success'</span>, xhr);
			}
		}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, ioargs</span>) </span>{
			updateDeferred(xhr, d);
			d.reject(xhr, <span class="hljs-string">'error'</span>);
			error(xhr, <span class="hljs-string">'error'</span>);
		});
		<span class="hljs-keyword">var</span> xhr = def.ioArgs.xhr;
		updateDeferred(xhr, d);
		<span class="hljs-keyword">return</span> d;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Element - get the wrapped helper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.$ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">selector</span>) </span>{
		<span class="hljs-keyword">if</span> (selector === <span class="hljs-built_in">window</span>) {
			<span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>;
		}
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> selector === <span class="hljs-string">'string'</span>) {
			<span class="hljs-keyword">return</span> dojo.query(selector);
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> dojo.NodeList(selector &amp;&amp; selector.nodeName ? [selector] : selector);
		}
	};
	can.append = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">wrapped, html</span>) </span>{
		<span class="hljs-keyword">return</span> wrapped.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
			dojo.place(html, node);
		});
	};
	<span class="hljs-comment">/**
	 * can.data
	 *
	 * can.data is used to store arbitrary data on an element.
	 * Dojo does not support this, so we implement it itself.
	 *
	 * The important part is to call cleanData on any elements
	 * that are removed from the DOM.  For this to happen, we
	 * overwrite
	 *
	 *   -dojo.empty
	 *   -dojo.destroy
	 *   -dojo.place when "replace" is used TODO!!!!
	 *
	 * For can.Control, we also need to trigger a non bubbling event
	 * when an element is removed.  We do this also in cleanData.
	 */</span>
	<span class="hljs-keyword">var</span> data = {}, uuid = can.uuid = +<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
		exp = can.expando = <span class="hljs-string">'can'</span> + uuid;

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getData</span>(<span class="hljs-params">node, name</span>) </span>{
		<span class="hljs-keyword">var</span> id = node[exp],
			store = id &amp;&amp; data[id];
		<span class="hljs-keyword">return</span> name === <span class="hljs-literal">undefined</span> ? store || setData(node) : store &amp;&amp; store[name];
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setData</span>(<span class="hljs-params">node, name, value</span>) </span>{
		<span class="hljs-keyword">var</span> id = node[exp] || (node[exp] = ++uuid),
			store = data[id] || (data[id] = {});
		<span class="hljs-keyword">if</span> (name !== <span class="hljs-literal">undefined</span>) {
			store[name] = value;
		}
		<span class="hljs-keyword">return</span> store;
	}

	<span class="hljs-keyword">var</span> cleanData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">elems</span>) </span>{
		<span class="hljs-keyword">var</span> nodes = [];

		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = elems.length; i &lt; len; i++) {
			<span class="hljs-keyword">if</span> (elems[i].nodeType === <span class="hljs-number">1</span>) {
				nodes.push(elems[i]);
			}
		}
		can.trigger(<span class="hljs-keyword">new</span> dojo.NodeList(nodes), <span class="hljs-string">'removed'</span>, [], <span class="hljs-literal">false</span>);
		i = <span class="hljs-number">0</span>;
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> elem;
				 (elem = elems[i]) !== <span class="hljs-literal">undefined</span>; i++) {
			<span class="hljs-keyword">var</span> id = elem[exp];
			<span class="hljs-keyword">delete</span> data[id];
		}
	};
	can.data = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">wrapped, name, value</span>) </span>{
		<span class="hljs-keyword">return</span> value === <span class="hljs-literal">undefined</span> ? wrapped.length === <span class="hljs-number">0</span> ? <span class="hljs-literal">undefined</span> : getData(wrapped[<span class="hljs-number">0</span>], name) : wrapped.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
			setData(node, name, value);
		});
	};
	can.cleanData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">elem, prop</span>) </span>{
		<span class="hljs-keyword">var</span> id = elem[exp];
		<span class="hljs-keyword">delete</span> data[id][prop];
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Overwrite <code>dojo.destroy</code>, <code>dojo.empty</code> and <code>dojo.place</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	dojo.empty = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c; c = node.lastChild;) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Intentional assignment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			dojo.destroy(c);
		}
	};
	<span class="hljs-keyword">var</span> destroy = dojo.destroy;
	dojo.destroy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
		node = dojo.byId(node);</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>we must call clean data at one time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> nodes = [node];
		<span class="hljs-keyword">if</span> (node.getElementsByTagName) {
			nodes.concat(can.makeArray(node.getElementsByTagName(<span class="hljs-string">'*'</span>)));
		}
		cleanData(nodes);
		<span class="hljs-keyword">return</span> destroy.apply(dojo, <span class="hljs-built_in">arguments</span>);
	};
	<span class="hljs-keyword">var</span> place = dojo.place;
	dojo.place = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node, refNode, position</span>) </span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> node === <span class="hljs-string">'string'</span> &amp;&amp; <span class="hljs-regexp">/^\s*&lt;/</span>.test(node)) {
			node = can.buildFragment(node);
		}
		<span class="hljs-keyword">var</span> elems;
		<span class="hljs-keyword">if</span> (node.nodeType === <span class="hljs-number">11</span>) {
			elems = can.makeArray(node.childNodes);
		} <span class="hljs-keyword">else</span> {
			elems = [node];
		}
		<span class="hljs-keyword">var</span> ret = place.call(<span class="hljs-keyword">this</span>, node, refNode, position);
		can.inserted(elems);
		<span class="hljs-keyword">return</span> ret;
	};
	can.addClass = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">wrapped, className</span>) </span>{
		<span class="hljs-keyword">return</span> wrapped.addClass(className);
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>removes a NodeList … but it doesn’t seem like dojo’s NodeList has a destroy method?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.remove = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">wrapped</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>We need to remove text nodes ourselves.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> nodes = [];
		wrapped.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
			nodes.push(node);
			<span class="hljs-keyword">if</span> (node.getElementsByTagName) {
				nodes.push.apply(nodes, can.makeArray(node.getElementsByTagName(<span class="hljs-string">'*'</span>)));
			}
		});
		cleanData(nodes);
		wrapped.forEach(destroy);
		<span class="hljs-keyword">return</span> wrapped;
	};
	can.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">wrapped, index</span>) </span>{
		<span class="hljs-keyword">return</span> wrapped[index];
	};
	can.has = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">wrapped, element</span>) </span>{
		<span class="hljs-keyword">if</span> (dojo.isDescendant(element, wrapped[<span class="hljs-number">0</span>])) {
			<span class="hljs-keyword">return</span> wrapped;
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">return</span> [];
		}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Add pipe to <code>dojo.Deferred</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	can.extend(dojo.Deferred.prototype, {
		<span class="hljs-attr">pipe</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done, fail</span>) </span>{
			<span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> dojo.Deferred();
			<span class="hljs-keyword">this</span>.addCallback(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				d.resolve(done.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>));
			});
			<span class="hljs-keyword">this</span>.addErrback(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">if</span> (fail) {
					d.reject(fail.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>));
				} <span class="hljs-keyword">else</span> {
					d.reject.apply(d, <span class="hljs-built_in">arguments</span>);
				}
			});
			<span class="hljs-keyword">return</span> d;
		}
	});
	can.attr = attr;
	<span class="hljs-keyword">delete</span> attr.MutationObserver;

	<span class="hljs-keyword">var</span> oldOn = dojo.NodeList.prototype.on;

	dojo.NodeList.prototype.on = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{

		<span class="hljs-keyword">if</span> (event === <span class="hljs-string">"attributes"</span>) {
			<span class="hljs-keyword">this</span>.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
				<span class="hljs-keyword">var</span> el = can.$(node);
				can.data(el, <span class="hljs-string">"canHasAttributesBindings"</span>, (can.data(el, <span class="hljs-string">"canHasAttributesBindings"</span>) || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);
			});
		}
		<span class="hljs-keyword">var</span> handles = oldOn.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

		<span class="hljs-keyword">if</span> (event === <span class="hljs-string">"attributes"</span>) {
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

			can.each(handles, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">handle, i</span>) </span>{
				<span class="hljs-keyword">var</span> oldRemove = handle.remove;
				handle.remove = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> el = can.$(self[i]),
						cur = can.data(el, <span class="hljs-string">"canHasAttributesBindings"</span>) || <span class="hljs-number">0</span>;
					<span class="hljs-keyword">if</span> (cur &lt;= <span class="hljs-number">0</span>) {
						can.cleanData(self[i], <span class="hljs-string">"canHasAttributesBindings"</span>);
					} <span class="hljs-keyword">else</span> {
						can.data(el, <span class="hljs-string">"canHasAttributesBindings"</span>, cur - <span class="hljs-number">1</span>);
					}
					<span class="hljs-keyword">return</span> oldRemove.call(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
				};
			});
		}
		<span class="hljs-keyword">return</span> handles;

	};

	<span class="hljs-keyword">var</span> oldSetAttr = dojo.setAttr;
	dojo.setAttr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node, name, value</span>) </span>{
		<span class="hljs-keyword">var</span> oldValue = dojo.getAttr(node, name);

		<span class="hljs-keyword">var</span> res = oldSetAttr.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

		<span class="hljs-keyword">var</span> newValue = dojo.getAttr(node, name);

		<span class="hljs-keyword">if</span> (newValue !== oldValue) {
			can.attr.trigger(node, name, oldValue);
		}
		<span class="hljs-keyword">return</span> res;
	};

	<span class="hljs-keyword">var</span> oldRemoveAttr = dojo.removeAttr;

	dojo.removeAttr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node, name</span>) </span>{
		<span class="hljs-keyword">var</span> oldValue = dojo.getAttr(node, name),
			res = oldRemoveAttr.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

		<span class="hljs-keyword">if</span> (oldValue != <span class="hljs-literal">null</span>) {
			can.attr.trigger(node, name, oldValue);
		}
		<span class="hljs-keyword">return</span> res;
	};

	<span class="hljs-keyword">return</span> can;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
