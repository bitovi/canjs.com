<!DOCTYPE html>

<html>
<head>
  <title>can/map/map.js (aka can.Map)</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="bubble.html">
                bubble.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="map_benchmark.html">
                map_benchmark.js
              </a>
            
              
              <a class="source" href="map_helpers.html">
                map_helpers.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="can-map-map-js-aka-can-map-">can/map/map.js (aka can.Map)</h1>
<p><code>can.Map</code> provides the observable pattern for JavaScript objects. It
provides an <code>attr</code> and <code>removeAttr</code> method that can be used to get/set and
remove properties and nested properties by calling a “pipeline” of protected
methods:</p>
<ul>
<li><code>_get</code>, <code>_set</code>, <code>_remove</code> - handle nested properties.</li>
<li><code>__get</code>, <code>__set</code>, <code>__remove</code> - handle triggering events.</li>
<li><code>___get</code>, <code>___set</code>, <code>___remove</code> - read / write / remove raw values.</li>
</ul>
<p>When <code>attr</code> gets or sets multiple properties it calls <code>_getAttrs</code> or <code>_setAttrs</code>.</p>
<p><a href="bubble.html">bubble.js</a> - Handles bubbling of child events to parent events.
<a href="map_helpers.html">map_helpers.js</a> - Assorted helpers for handling cycles during serialization or
instantition of objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>steal(<span class="hljs-string">'can/util'</span>, <span class="hljs-string">'can/util/bind'</span>,<span class="hljs-string">'./bubble.js'</span>, <span class="hljs-string">'./map_helpers.js'</span>,<span class="hljs-string">'can/construct'</span>, <span class="hljs-string">'can/util/batch'</span>, <span class="hljs-string">'can/compute/get_value_and_bind.js'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">can, bind, bubble, mapHelpers</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>properties that can’t be observed on … no matter what</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> unobservable = {
		<span class="hljs-string">"constructor"</span>: <span class="hljs-literal">true</span>
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Extend <a href="../construct/construct.html">can.Construct</a> to make inheriting a <code>can.Map</code> easier.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> <span class="hljs-built_in">Map</span> = can.Map = can.Construct.extend(
		<span class="hljs-comment">/**
		 * @static
		 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="static-properties-and-methods">Static Properties and Methods</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>		{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3 id="setup">setup</h3>
<p>Called when a Map constructor is defined/extended to
perform any initialization behavior for the new constructor
function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			setup: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">baseMap</span>) </span>{

				can.Construct.setup.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>A cached list of computed properties on the prototype.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">this</span>._computedPropertyNames = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Do not run if we are defining can.Map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (can.Map) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Provide warnings if can.Map is used incorrectly.
!steal-remove-start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.prototype.define &amp;&amp; !mapHelpers.define) {
						can.dev.warn(<span class="hljs-string">"can/map/define is not included, yet there is a define property "</span>+
						<span class="hljs-string">"used. You may want to add this plugin."</span>);
					}
					<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.define &amp;&amp; !mapHelpers.define) {
						can.dev.warn(<span class="hljs-string">"The define property should be on the map's prototype properties, "</span>+
						<span class="hljs-string">"not the static properties. Also, can/map/define is not included."</span>);
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>!steal-remove-end</p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Create a placeholder for default values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.defaults) {
						<span class="hljs-keyword">this</span>.defaults = {};
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Go through everything on the prototype.  If it’s a primitive,
treat it as a default value.  If it’s a compute, identify it so
it can be setup as a computed property.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.prototype) {
						<span class="hljs-keyword">if</span> (
							prop !== <span class="hljs-string">"define"</span> &amp;&amp;
							prop !== <span class="hljs-string">"constructor"</span> &amp;&amp;
							(
							<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.prototype[prop] !== <span class="hljs-string">"function"</span> ||
							<span class="hljs-keyword">this</span>.prototype[prop].prototype <span class="hljs-keyword">instanceof</span> can.Construct
							)
						) {
							<span class="hljs-keyword">this</span>.defaults[prop] = <span class="hljs-keyword">this</span>.prototype[prop];
						} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.prototype[prop].isComputed) {
							<span class="hljs-keyword">this</span>._computedPropertyNames.push(prop);
						}
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>If define is a function, call it with this can.Map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span>(mapHelpers.define) {
						mapHelpers.define(<span class="hljs-keyword">this</span>, baseMap.prototype.define);
					}
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If we inherit from can.Map, but not can.List, create a can.List that
creates instances of this Map type.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (can.List &amp;&amp; !(<span class="hljs-keyword">this</span>.prototype <span class="hljs-keyword">instanceof</span> can.List)) {
					<span class="hljs-keyword">this</span>.List = <span class="hljs-built_in">Map</span>.List.extend({
						<span class="hljs-attr">Map</span>: <span class="hljs-keyword">this</span>
					}, {});
				}

			},</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3 id="shortname">shortName</h3>
<p>Tells <code>can.Construct</code> to show instance as <code>Map</code> in the debugger.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			shortName: <span class="hljs-string">"Map"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3 id="_bubblerule">_bubbleRule</h3>
<p>Returns which events to setup bubbling on for a given bound event.
By default, only bubbles “change” events if someone listens to a
“change” event or a nested event like “foo.bar”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_bubbleRule: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">eventName</span>) </span>{
				<span class="hljs-keyword">return</span> (eventName === <span class="hljs-string">"change"</span> || eventName.indexOf(<span class="hljs-string">"."</span>) &gt;= <span class="hljs-number">0</span> ) ?
					[<span class="hljs-string">"change"</span>] :
					[];
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h3 id="bind-unbind">bind,  unbind</h3>
<p>Listen to events on the Map constructor.  These
are here mostly for can.Model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			bind: can.bindAndSetup,
			<span class="hljs-attr">unbind</span>: can.unbindAndTeardown,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h3 id="id">id</h3>
<p>Name of the id field. Used in can.Model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			id: <span class="hljs-string">"id"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h3 id="keys">keys</h3>
<p>An observable way to get the keys from a map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			keys: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">map</span>) </span>{
				<span class="hljs-keyword">var</span> keys = [];
				can.__observe(map, <span class="hljs-string">'__keys'</span>);
				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> keyName <span class="hljs-keyword">in</span> map._data) {
					keys.push(keyName);
				}
				<span class="hljs-keyword">return</span> keys;
			}
		},
		<span class="hljs-comment">/**
		 * @prototype
		 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h2 id="prototype-properties-and-methods">Prototype Properties and Methods</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>		{</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h3 id="setup">setup</h3>
<p>Initializes the map instance’s behavior.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			setup: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{

				<span class="hljs-keyword">if</span>(obj <span class="hljs-keyword">instanceof</span> can.Map){
					obj = obj.serialize();
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Where we keep the values of the compute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">this</span>._data = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>The namespace this <code>object</code> uses to listen to events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				can.cid(<span class="hljs-keyword">this</span>, <span class="hljs-string">".map"</span>);

				<span class="hljs-keyword">this</span>._setupComputedProperties();

				<span class="hljs-keyword">var</span> teardownMapping = obj &amp;&amp; mapHelpers.addToMap(obj, <span class="hljs-keyword">this</span>);

				<span class="hljs-keyword">var</span> defaultValues = <span class="hljs-keyword">this</span>._setupDefaults(obj);
				<span class="hljs-keyword">var</span> data = can.extend(can.extend(<span class="hljs-literal">true</span>, {}, defaultValues), obj);

				<span class="hljs-keyword">this</span>.attr(data);

				<span class="hljs-keyword">if</span> (teardownMapping) {
					teardownMapping();
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h3 id="_setupcomputes">_setupComputes</h3>
<p>Sets up computed properties on a Map.
Stores information for each computed property on
 <code>this._computedAttrs</code> that looks like:</p>
<pre><code>{
  <span class="hljs-comment">// the number of bindings on this property</span>
  count: <span class="hljs-number">1</span>,
  <span class="hljs-comment">// a handler that forwards events on the compute</span>
  <span class="hljs-comment">// to the map instance</span>
  handler: handler,
  <span class="hljs-attr">compute</span>: compute  <span class="hljs-comment">// the compute</span>
}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>			_setupComputedProperties: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">this</span>._computedAttrs = {};

				<span class="hljs-keyword">var</span> computes = <span class="hljs-keyword">this</span>.constructor._computedPropertyNames;

				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = computes.length; i &lt; len; i++) {
					<span class="hljs-keyword">var</span> attrName = computes[i];
					mapHelpers.addComputedAttr(<span class="hljs-keyword">this</span>, attrName, <span class="hljs-keyword">this</span>[attrName].clone(<span class="hljs-keyword">this</span>));
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h3 id="_setupdefaults">_setupDefaults</h3>
<p>Returns the default values for the instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_setupDefaults: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.constructor.defaults || {};
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h3 id="attr">attr</h3>
<p>The primary get/set interface for can.Map.
Calls <code>_get</code>, <code>_set</code> or <code>_attrs</code> depending on
how it is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			attr: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr, val</span>) </span>{
				<span class="hljs-keyword">var</span> type = <span class="hljs-keyword">typeof</span> attr;
				<span class="hljs-keyword">if</span>(attr === <span class="hljs-literal">undefined</span>) {
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._getAttrs();
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">"string"</span> &amp;&amp; type !== <span class="hljs-string">"number"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Get or set multiple attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._setAttrs(attr, val);
				}
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Get a single attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._get(attr+<span class="hljs-string">""</span>);
				} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Set an attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">this</span>._set(attr+<span class="hljs-string">""</span>, val);
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h3 id="_get">_get</h3>
<p>Handles reading nested properties like “foo.bar” by
getting the value of “foo” and recursively
calling <code>_get</code> for the value of “bar”.
To read the actual values, <code>_get</code> calls
<code>___get</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr</span>) </span>{
				<span class="hljs-keyword">var</span> dotIndex = attr.indexOf(<span class="hljs-string">'.'</span>);

				<span class="hljs-keyword">if</span>( dotIndex &gt;= <span class="hljs-number">0</span> ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Attempt to get the value anyway in case
somone wrote <code>new can.Map({&quot;foo.bar&quot;: 1})</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>.___get(attr);
					<span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
						can.__observe(<span class="hljs-keyword">this</span>, attr);
						<span class="hljs-keyword">return</span> value;
					}

					<span class="hljs-keyword">var</span> first = attr.substr(<span class="hljs-number">0</span>, dotIndex),
						second = attr.substr(dotIndex+<span class="hljs-number">1</span>);

					<span class="hljs-keyword">var</span> current = <span class="hljs-keyword">this</span>.__get( first );

					<span class="hljs-keyword">return</span> current &amp;&amp; current._get ?  current._get(second) : <span class="hljs-literal">undefined</span>;
				} <span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__get( attr );
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h3 id="__get">__get</h3>
<p>Signals <code>can.compute</code> that an observable
property is being read.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			__get: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attr</span>)</span>{
				<span class="hljs-keyword">if</span>(!unobservable[attr] &amp;&amp; !<span class="hljs-keyword">this</span>._computedAttrs[attr]) {
					can.__observe(<span class="hljs-keyword">this</span>, attr);
				}
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.___get( attr );
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h3 id="___get">___get</h3>
<p>When called with an argument, returns the value of this property. If that
property is represented by a computed attribute, return the value of that compute.
If no argument is provided, return the raw data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			___get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr</span>) </span>{
				<span class="hljs-keyword">if</span> (attr !== <span class="hljs-literal">undefined</span>) {
					<span class="hljs-keyword">var</span> computedAttr = <span class="hljs-keyword">this</span>._computedAttrs[attr];
					<span class="hljs-keyword">if</span> (computedAttr &amp;&amp; computedAttr.compute) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>return computedAttr.compute();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">return</span> computedAttr.compute();
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._data.hasOwnProperty(attr) ? <span class="hljs-keyword">this</span>._data[attr] : <span class="hljs-literal">undefined</span>;
					}
				} <span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._data;
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h3 id="_set">_set</h3>
<p>Handles setting nested properties by finding the
nested observable and recursively calling <code>_set</code> on it. Eventually,
it calls <code>__set</code> with the <code>__type</code> converted value to set
and the current value.  The current value is passed for two reasons:</p>
<ul>
<li>so <code>__set</code> can trigger an event if the value has changed.</li>
<li>for advanced setting behavior that define.set can do.</li>
</ul>
<p>If the map is initializing, the current value does not need to be
read because no change events are dispatched anyway.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_set: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr, value, keepKey</span>) </span>{

				<span class="hljs-keyword">var</span> dotIndex = attr.indexOf(<span class="hljs-string">'.'</span>),
					current;

				<span class="hljs-keyword">if</span>(dotIndex &gt;= <span class="hljs-number">0</span> &amp;&amp; !keepKey){
					<span class="hljs-keyword">var</span> first = attr.substr(<span class="hljs-number">0</span>, dotIndex),
						second = attr.substr(dotIndex+<span class="hljs-number">1</span>);

					current =  <span class="hljs-keyword">this</span>.__inSetup ? <span class="hljs-literal">undefined</span> : <span class="hljs-keyword">this</span>.___get( first );

					<span class="hljs-keyword">if</span>( can.isMapLike(current) ) {
						current._set(second, value);
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"can.Map: Object does not exist"</span>);
					}

				} <span class="hljs-keyword">else</span> {
					current = <span class="hljs-keyword">this</span>.__inSetup ? <span class="hljs-literal">undefined</span> : <span class="hljs-keyword">this</span>.___get( attr );</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>//Convert if there is a converter.  Remove in 3.0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.__convert) {
						value = <span class="hljs-keyword">this</span>.__convert(attr, value);
					}

					<span class="hljs-keyword">this</span>.__set(attr, <span class="hljs-keyword">this</span>.__type(value, attr), current);
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h2 id="__type">__type</h2>
<p>Converts set values to another type.  By default,
this converts Objects to can.Maps and Arrays to
can.Lists.
This also makes it so if a plain JavaScript object
has already been converted to a list or map, that same
list or map instance is used.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			__type: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, prop</span>)</span>{

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"object"</span> &amp;&amp; !( value <span class="hljs-keyword">instanceof</span> can.Map) &amp;&amp; mapHelpers.canMakeObserve(value)  ) {

					<span class="hljs-keyword">var</span> cached = mapHelpers.getMapFromObject(value);
					<span class="hljs-keyword">if</span>(cached) {
						<span class="hljs-keyword">return</span> cached;
					}
					<span class="hljs-keyword">if</span>( can.isArray(value) ) {
						<span class="hljs-keyword">var</span> List = can.List;
						<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> List(value);
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-keyword">var</span> <span class="hljs-built_in">Map</span> = <span class="hljs-keyword">this</span>.constructor.Map || can.Map;
						<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>(value);
					}
				}
				<span class="hljs-keyword">return</span> value;
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="__set">__set</h2>
<p>Handles firing events if the value has changed and
works with the <code>bubble</code> helpers to setup bubbling.
Calls <code>___set</code> to do the actual setting.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			__set: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prop, value, current</span>) </span>{

				<span class="hljs-keyword">if</span> (value !== current) {
					<span class="hljs-keyword">var</span> computedAttr = <span class="hljs-keyword">this</span>._computedAttrs[prop];</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Dispatch an “add” event if adding a new property.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> changeType = computedAttr || current !== <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">this</span>.___get()
						.hasOwnProperty(prop) ? <span class="hljs-string">"set"</span> : <span class="hljs-string">"add"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Set the value on <code>_data</code> and set up bubbling.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">this</span>.___set(prop, <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"object"</span> ? bubble.set(<span class="hljs-keyword">this</span>, prop, value, current) : value );</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Computed properties change events are already forwarded except if
no one is listening to them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span>(!computedAttr || !computedAttr.count) {
						<span class="hljs-keyword">this</span>._triggerChange(prop, changeType, value, current);
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Stop bubbling old nested maps.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> current === <span class="hljs-string">"object"</span>) {
						bubble.teardownFromParent(<span class="hljs-keyword">this</span>, current);
					}
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h3 id="___set">___set</h3>
<p>Directly saves the set value as a property on <code>_data</code>
or sets the computed attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			___set: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prop, val</span>) </span>{
				<span class="hljs-keyword">var</span> computedAttr = <span class="hljs-keyword">this</span>._computedAttrs[prop];
				<span class="hljs-keyword">if</span> ( computedAttr &amp;&amp; computedAttr.compute ) {
					computedAttr.compute(val);
				} <span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">this</span>._data[prop] = val;
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Adds the property directly to the map instance. But first,
checks that it’s not overwriting a method. This should be removed
in 3.0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.constructor.prototype[prop] !== <span class="hljs-string">'function'</span> &amp;&amp; !computedAttr ) {
					<span class="hljs-keyword">this</span>[prop] = val;
				}
			},

			<span class="hljs-attr">removeAttr</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr</span>) </span>{
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._remove(attr);
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h3 id="_remove">_remove</h3>
<p>Handles removing nested observes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_remove: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attr</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>If this is List.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> parts = mapHelpers.attrParts(attr),</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>The actual property to remove.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					prop = parts.shift(),</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>The current value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					current = <span class="hljs-keyword">this</span>.___get(prop);</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>If we have more parts, call <code>removeAttr</code> on that part.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (parts.length &amp;&amp; current) {
					<span class="hljs-keyword">return</span> current.removeAttr(parts);
				} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>If attr does not have a <code>.</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> attr === <span class="hljs-string">'string'</span> &amp;&amp; !!~attr.indexOf(<span class="hljs-string">'.'</span>)) {
						prop = attr;
					}

					<span class="hljs-keyword">this</span>.__remove(prop, current);
					<span class="hljs-keyword">return</span> current;
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h3 id="__remove">__remove</h3>
<p>Handles triggering an event if a property could be removed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			__remove: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">prop, current</span>)</span>{
				<span class="hljs-keyword">if</span> (prop <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>._data) {
					<span class="hljs-keyword">this</span>.___remove(prop);</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Let others now this property has been removed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">this</span>._triggerChange(prop, <span class="hljs-string">"remove"</span>, <span class="hljs-literal">undefined</span>, current);
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h3 id="___remove">___remove</h3>
<p>Deletes a property from <code>_data</code> and the map instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			___remove: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">prop</span>)</span>{
				<span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._data[prop];
				<span class="hljs-keyword">if</span> (!(prop <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.constructor.prototype)) {
					<span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>[prop];
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <h3 id="___serialize">___serialize</h3>
<p>Serializes a property.  Uses map helpers to
recursively serialize nested observables.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			___serialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, val</span>)</span>{
				<span class="hljs-keyword">return</span> mapHelpers.getValue(<span class="hljs-keyword">this</span>, name, val, <span class="hljs-string">"serialize"</span>);
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h3 id="_getattrs">_getAttrs</h3>
<p>Returns the values of all attributes as a plain JavaScript object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_getAttrs: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
				<span class="hljs-keyword">return</span> mapHelpers.serialize(<span class="hljs-keyword">this</span>, <span class="hljs-string">'attr'</span>, {});
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h3 id="_setattrs">_setAttrs</h3>
<p>Sets multiple properties on this object at once.
First, goes through all current properties and either merges
or removes old properties.
Then it goes through the remaining ones to be added and sets those properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_setAttrs: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">props, remove</span>) </span>{
				props = can.simpleExtend({}, props);
				<span class="hljs-keyword">var</span> prop,
					self = <span class="hljs-keyword">this</span>,
					newVal;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Batch all of the change events until we are done.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				can.batch.start();</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Merge current properties with the new ones.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">this</span>._each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">curVal, prop</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>You can not have a _cid property; abort.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (prop === <span class="hljs-string">"_cid"</span>) {
						<span class="hljs-keyword">return</span>;
					}
					newVal = props[prop];</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>If we are merging, remove the property if it has no value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (newVal === <span class="hljs-literal">undefined</span>) {
						<span class="hljs-keyword">if</span> (remove) {
							self.removeAttr(prop);
						}
						<span class="hljs-keyword">return</span>;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Run converter if there is one. Remove in 3.0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (self.__convert) {
						newVal = self.__convert( prop, newVal );
					}

					<span class="hljs-keyword">if</span> ( can.isMapLike(curVal) &amp;&amp; mapHelpers.canMakeObserve(newVal) ) {
						curVal.attr(newVal, remove);</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Otherwise just set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (curVal !== newVal) {
						self.__set(prop, self.__type(newVal, prop), curVal);
					}

					<span class="hljs-keyword">delete</span> props[prop];
				});</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Add remaining props.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> props) {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Ignore _cid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (prop !== <span class="hljs-string">"_cid"</span>) {
						newVal = props[prop];
						<span class="hljs-keyword">this</span>._set(prop, newVal, <span class="hljs-literal">true</span>);
					}

				}
				can.batch.stop();
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
			},

			<span class="hljs-attr">serialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">return</span> mapHelpers.serialize(<span class="hljs-keyword">this</span>, <span class="hljs-string">'serialize'</span>, {});
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <h3 id="_triggerchange">_triggerChange</h3>
<p>A helper function used to trigger events on this map.
If the map is bubbling, this will fire a change event.
Otherwise, it only fires a “named” event. Triggers a
“__keys” event if a property has been added or removed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_triggerChange: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">attr, how, newVal, oldVal, batchNum</span>) </span>{

				<span class="hljs-keyword">if</span>(bubble.isBubbling(<span class="hljs-keyword">this</span>, <span class="hljs-string">"change"</span>)) {
					can.batch.trigger(<span class="hljs-keyword">this</span>, {
						<span class="hljs-attr">type</span>: <span class="hljs-string">"change"</span>,
						<span class="hljs-attr">target</span>: <span class="hljs-keyword">this</span>,
						<span class="hljs-attr">batchNum</span>: batchNum
					}, [attr, how, newVal, oldVal]);

				}

				can.batch.trigger(<span class="hljs-keyword">this</span>, {
					<span class="hljs-attr">type</span>: attr,
					<span class="hljs-attr">target</span>: <span class="hljs-keyword">this</span>,
					<span class="hljs-attr">batchNum</span>: batchNum
				}, [newVal, oldVal]);

				<span class="hljs-keyword">if</span>(how === <span class="hljs-string">"remove"</span> || how === <span class="hljs-string">"add"</span>) {
					can.batch.trigger(<span class="hljs-keyword">this</span>, {
						<span class="hljs-attr">type</span>: <span class="hljs-string">"__keys"</span>,
						<span class="hljs-attr">target</span>: <span class="hljs-keyword">this</span>,
						<span class="hljs-attr">batchNum</span>: batchNum
					});
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <h3 id="_bindsetup-and-_bindteardown">_bindsetup and _bindteardown</h3>
<p>Placeholders for bind setup and teardown.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_bindsetup: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{},
			<span class="hljs-attr">_bindteardown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{},</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h3 id="one">one</h3>
<p>Listens once to an event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			one: can.one,</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <h3 id="bind">bind</h3>
<p>Listens to an event on a map.
If the event is a  computed property,
listen to the compute and forward its events
to this map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			bind: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">eventName, handler</span>) </span>{

				<span class="hljs-keyword">var</span> computedBinding = <span class="hljs-keyword">this</span>._computedAttrs &amp;&amp; <span class="hljs-keyword">this</span>._computedAttrs[eventName];
				<span class="hljs-keyword">if</span> (computedBinding &amp;&amp; computedBinding.compute) {
					<span class="hljs-keyword">if</span> (!computedBinding.count) {
						computedBinding.count = <span class="hljs-number">1</span>;
						computedBinding.compute.bind(<span class="hljs-string">"change"</span>, computedBinding.handler);
					} <span class="hljs-keyword">else</span> {
						computedBinding.count++;
					}

				}</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Sets up bubbling if needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				bubble.bind(<span class="hljs-keyword">this</span>, eventName);

				<span class="hljs-keyword">return</span> can.bindAndSetup.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h3 id="unbind">unbind</h3>
<p>Stops listening to an event.
If this is the last listener of a computed property,
stop forwarding events of the computed property to this map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			unbind: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">eventName, handler</span>) </span>{
				<span class="hljs-keyword">var</span> computedBinding = <span class="hljs-keyword">this</span>._computedAttrs &amp;&amp; <span class="hljs-keyword">this</span>._computedAttrs[eventName];
				<span class="hljs-keyword">if</span> (computedBinding) {
					<span class="hljs-keyword">if</span> (computedBinding.count === <span class="hljs-number">1</span>) {
						computedBinding.count = <span class="hljs-number">0</span>;
						computedBinding.compute.unbind(<span class="hljs-string">"change"</span>, computedBinding.handler);
					} <span class="hljs-keyword">else</span> {
						computedBinding.count--;
					}

				}</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Teardown bubbling if needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				bubble.unbind(<span class="hljs-keyword">this</span>, eventName);
				<span class="hljs-keyword">return</span> can.unbindAndTeardown.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

			},</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <h3 id="compute">compute</h3>
<p>Creates a compute that represents a value on this map. If the property is a function
on the prototype, a “function” compute wil be created.
Otherwise, a compute will be created that reads the observable attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			compute: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prop</span>) </span>{

				<span class="hljs-keyword">if</span> (can.isFunction(<span class="hljs-keyword">this</span>.constructor.prototype[prop])) {

					<span class="hljs-keyword">return</span> can.compute(<span class="hljs-keyword">this</span>[prop], <span class="hljs-keyword">this</span>);
				} <span class="hljs-keyword">else</span> {

					<span class="hljs-keyword">var</span> reads = can.compute.read.reads(prop),
						last = reads.length - <span class="hljs-number">1</span>;

					<span class="hljs-keyword">return</span> can.compute(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">newVal</span>) </span>{
						<span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length) {
							can.compute.read(<span class="hljs-keyword">this</span>, reads.slice(<span class="hljs-number">0</span>, last))
								.value.attr(reads[last].key, newVal);
						} <span class="hljs-keyword">else</span> {
							<span class="hljs-keyword">return</span> can.compute.read(<span class="hljs-keyword">this</span>, reads, {
								<span class="hljs-attr">args</span>: []
							}).value;
						}
					}, <span class="hljs-keyword">this</span>);
				}

			},</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <h3 id="each">each</h3>
<p>loops through all the key-value pairs on this map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			each: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">return</span> can.each.apply(<span class="hljs-literal">undefined</span>, [<span class="hljs-keyword">this</span>].concat(can.makeArray(<span class="hljs-built_in">arguments</span>)));
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <h3 id="_each">_each</h3>
<p>Iterator that does not trigger live binding.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_each: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">callback</span>) </span>{
				<span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.___get();
				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> data) {
					<span class="hljs-keyword">if</span> (data.hasOwnProperty(prop)) {
						callback(data[prop], prop);
					}
				}
			},

			<span class="hljs-attr">dispatch</span>: can.dispatch
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <h3 id="etc">etc</h3>
<p>Setup on/off aliases</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-built_in">Map</span>.prototype.on = <span class="hljs-built_in">Map</span>.prototype.bind;
	<span class="hljs-built_in">Map</span>.prototype.off = <span class="hljs-built_in">Map</span>.prototype.unbind;
	<span class="hljs-built_in">Map</span>.on = <span class="hljs-built_in">Map</span>.bind;
	<span class="hljs-built_in">Map</span>.off = <span class="hljs-built_in">Map</span>.unbind;

	<span class="hljs-keyword">return</span> <span class="hljs-built_in">Map</span>;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
