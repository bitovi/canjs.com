<!DOCTYPE html>

<html>
<head>
  <title>sort.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>sort.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>steal(<span class="hljs-string">'can/util'</span>, <span class="hljs-string">'can/list'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Change bubble rule to bubble on change if their is a comparator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> oldBubbleRule = can.List._bubbleRule;
	can.List._bubbleRule = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, list)</span> </span>{
		<span class="hljs-keyword">var</span> oldBubble = oldBubbleRule.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

		<span class="hljs-keyword">if</span> (list.comparator &amp;&amp; can.inArray(<span class="hljs-string">'change'</span>, oldBubble) === -<span class="hljs-number">1</span>) {
			oldBubble.push(<span class="hljs-string">'change'</span>);
		}

		<span class="hljs-keyword">return</span> oldBubble;
	};

	<span class="hljs-keyword">var</span> proto = can.List.prototype,
		_changes = proto._changes,
		setup = proto.setup;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Add <code>move</code> as an event that lazy-bubbles</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>extend the list for sorting support</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
	can.extend(proto, {
		comparator: <span class="hljs-literal">undefined</span>,

		_comparator: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> </span>{
			<span class="hljs-keyword">var</span> comparator = <span class="hljs-keyword">this</span>.comparator;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>If the user has defined a comparator, use it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (comparator &amp;&amp; <span class="hljs-keyword">typeof</span> comparator === <span class="hljs-string">'function'</span>) {
				<span class="hljs-keyword">return</span> comparator(a, b);
			}

			<span class="hljs-keyword">return</span> a === b ? <span class="hljs-number">0</span> : a &lt; b ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>;
		},

		<span class="hljs-comment">/**
		 * @hide
		 */</span>
		_getInsertIndex: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item, currentIndex)</span> </span>{
			<span class="hljs-keyword">var</span> a = <span class="hljs-keyword">this</span>._getComparatorValue(item),
				b,
				offset = <span class="hljs-number">0</span>;

			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.length; i++) {
				b = <span class="hljs-keyword">this</span>._getComparatorValue(<span class="hljs-keyword">this</span>[i]);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>If we’ve reached the index that the item currently
resides in and still haven’t found an ideal insert index,
offset the returned index by -1 to account for the fact
that this item would be moved if placed at the
suggested index.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> currentIndex !== <span class="hljs-string">'undefined'</span> &amp;&amp; i === currentIndex) {
					offset = -<span class="hljs-number">1</span>;
					<span class="hljs-keyword">continue</span>;
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If we’ve found an item ranked greater than or the same as this
item, consider this a good “insert” index.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._comparator(a, b) &lt; <span class="hljs-number">0</span>) {
					<span class="hljs-keyword">return</span> i + offset;
				}
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>The index of the last item in the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">return</span> i + offset;
		},

		_getComparatorValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item, overwrittenComparator)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Use the value passed to .sort() as the comparator value
if it is a string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> comparator = <span class="hljs-keyword">typeof</span> overwrittenComparator === <span class="hljs-string">'string'</span> ?
				overwrittenComparator :
				<span class="hljs-keyword">this</span>.comparator;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>If the comparator is a string use that value to get
property on the item. If the comparator is a method,
it’ll be used elsewhere.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (item &amp;&amp; comparator &amp;&amp; <span class="hljs-keyword">typeof</span> comparator === <span class="hljs-string">'string'</span>) {
				item = <span class="hljs-keyword">typeof</span> item[comparator] === <span class="hljs-string">'function'</span> ?
					item[comparator]() :
					item.attr(comparator);
			}

			<span class="hljs-keyword">return</span> item;
		},

		_getComparatorValues: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
			<span class="hljs-keyword">var</span> a = [];
			<span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item, index)</span> </span>{
				a.push(self._getComparatorValue(item));
			});
			<span class="hljs-keyword">return</span> a;
		},

		<span class="hljs-comment">/**
		 * @hide
		 */</span>
		sort: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(comparator, silent)</span> </span>{
			<span class="hljs-keyword">var</span> a, b, c, isSorted;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Use the value passed to .sort() as the comparator function
if it is a function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> comparatorFn = can.isFunction(comparator) ?
				comparator :
				<span class="hljs-keyword">this</span>._comparator;

			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i, iMin, j = <span class="hljs-number">0</span>, n = <span class="hljs-keyword">this</span>.length; j &lt; n-<span class="hljs-number">1</span>; j++) {
				iMin = j;

				isSorted = <span class="hljs-literal">true</span>;
				c = <span class="hljs-literal">undefined</span>;

				<span class="hljs-keyword">for</span> (i = j+<span class="hljs-number">1</span>; i &lt; n; i++) {

					a = <span class="hljs-keyword">this</span>._getComparatorValue(<span class="hljs-keyword">this</span>.attr(i), comparator);
					b = <span class="hljs-keyword">this</span>._getComparatorValue(<span class="hljs-keyword">this</span>.attr(iMin), comparator);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>[1, 2, 3, 4(b), 9, 6, 3(a)]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (comparatorFn.call(<span class="hljs-keyword">this</span>, a, b) === -<span class="hljs-number">1</span>) {
						isSorted = <span class="hljs-literal">false</span>;
						iMin = i;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>[1, 2, 3, 4, 8(b), 12, 49, 9(c), 6(a), 3]
While iterating over the unprocessed items in search
of a “min”, attempt to find two neighboring values
that are improperly sorted.
Note: This is not part of the original selection
sort agortithm</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (c &amp;&amp; comparatorFn.call(<span class="hljs-keyword">this</span>, a, c) === -<span class="hljs-number">1</span>) {
						isSorted = <span class="hljs-literal">false</span>;
					}

					c = a;
				}

				<span class="hljs-keyword">if</span> (isSorted) {
					<span class="hljs-keyword">break</span>;
				}

				<span class="hljs-keyword">if</span> (iMin !== j) {
					<span class="hljs-keyword">this</span>._swapItems(iMin, j, silent);
				}
			}


			<span class="hljs-keyword">if</span> (! silent) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Trigger length change so that {{#block}} helper can re-render</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				can.trigger(<span class="hljs-keyword">this</span>, <span class="hljs-string">'length'</span>, [<span class="hljs-keyword">this</span>.length]);
			}

			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
		},

		<span class="hljs-comment">/**
		 * @hide
		 */</span>
		_swapItems: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(oldIndex, newIndex, silent)</span> </span>{

			<span class="hljs-keyword">var</span> temporaryItemReference = <span class="hljs-keyword">this</span>[oldIndex];</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Remove the item from the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			[].splice.call(<span class="hljs-keyword">this</span>, oldIndex, <span class="hljs-number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Place the item at the correct index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			[].splice.call(<span class="hljs-keyword">this</span>, newIndex, <span class="hljs-number">0</span>, temporaryItemReference);

			<span class="hljs-keyword">if</span> (! silent) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Update the DOM via can.view.live.list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				can.trigger(<span class="hljs-keyword">this</span>, <span class="hljs-string">'move'</span>, [
					temporaryItemReference,
					newIndex,
					oldIndex
				]);
			}
		}

	});</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>create push, unshift
converts to an array of arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> getArgs = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(args)</span> </span>{
		<span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>] &amp;&amp; can.isArray(args[<span class="hljs-number">0</span>]) ? args[<span class="hljs-number">0</span>] : can.makeArray(args);
	};
	can.each({
			<span class="hljs-comment">/**
			 * @function push
			 * Add items to the end of the list.
			 *
			 *     var l = new can.List([]);
			 *
			 *     l.bind('change', function(
			 *         ev,        // the change event
			 *         attr,      // the attr that was changed, for multiple items, "*" is used
			 *         how,       // "add"
			 *         newVals,   // an array of new values pushed
			 *         oldVals,   // undefined
			 *         where      // the location where these items where added
			 *         ) {
			 *
			 *     })
			 *
			 *     l.push('0','1','2');
			 *
			 * @param {...*} [...items] items to add to the end of the list.
			 * @return {Number} the number of items in the array
			 */</span>
			push: <span class="hljs-string">"length"</span>,
			<span class="hljs-comment">/**
			 * @function unshift
			 * Add items to the start of the list.  This is very similar to
			 * [can.List::push].  Example:
			 *
			 *     var l = new can.List(["a","b"]);
			 *     l.unshift(1,2,3) //-&gt; 5
			 *     l.attr() //-&gt; [1,2,3,"a","b"]
			 *
			 * @param {...*} [...items] items to add to the start of the list.
			 * @return {Number} the length of the array.
			 */</span>
			unshift: <span class="hljs-number">0</span>
		},
		<span class="hljs-comment">/**
		 * adds a method where
		 * @param where items in the array should be added
		 * @param name method name
		 */</span>
		<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(where, name)</span> </span>{
			<span class="hljs-keyword">var</span> proto = can.List.prototype,
				old = proto[name];
			proto[name] = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.comparator &amp;&amp; <span class="hljs-built_in">arguments</span>.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>get the items being added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> args = getArgs(<span class="hljs-built_in">arguments</span>);
					<span class="hljs-keyword">var</span> i = args.length;

					<span class="hljs-keyword">while</span> (i--) {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Go through and convert anything to an <code>map</code> that needs
to be converted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> val = can.bubble.set(<span class="hljs-keyword">this</span>, i, <span class="hljs-keyword">this</span>.__type(args[i], i) );</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Insert this item at the correct index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> newIndex = <span class="hljs-keyword">this</span>._getInsertIndex(val);
						<span class="hljs-built_in">Array</span>.prototype.splice.apply(<span class="hljs-keyword">this</span>, [newIndex, <span class="hljs-number">0</span>, val]);

						<span class="hljs-keyword">this</span>._triggerChange(<span class="hljs-string">''</span> + newIndex, <span class="hljs-string">'add'</span>, [val], <span class="hljs-literal">undefined</span>);
					}

					can.batch.trigger(<span class="hljs-keyword">this</span>, <span class="hljs-string">'reset'</span>, [args]);

					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
				} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>call the original method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">return</span> old.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
				}



			};
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Overwrite .splice so that items added to the list (no matter what the
defined index) are inserted at the correct index, while preserving the
ability to remove items from a list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">var</span> proto = can.List.prototype;
		<span class="hljs-keyword">var</span> oldSplice = proto.splice;

		proto.splice = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index, howMany)</span> </span>{

			<span class="hljs-keyword">var</span> args = can.makeArray(<span class="hljs-built_in">arguments</span>),
				newElements =[],
				i, len;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Don’t use this “sort” oriented splice unless this list has a
comparator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (! <span class="hljs-keyword">this</span>.comparator) {
				<span class="hljs-keyword">return</span> oldSplice.apply(<span class="hljs-keyword">this</span>, args);
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Get the list of new items intended to be added to the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">for</span> (i = <span class="hljs-number">2</span>, len = args.length; i &lt; len; i++) {
				args[i] = <span class="hljs-keyword">this</span>.__type(args[i], i);
				newElements.push(args[i]);
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Remove items using the original splice method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			oldSplice.call(<span class="hljs-keyword">this</span>, index, howMany);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Add items by way of push so that they’re sorted into
the correct position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			proto.push.apply(<span class="hljs-keyword">this</span>, newElements);
		};
	})();</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <ul>
<li>override changes for sorting</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>	proto._changes = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, attr, how, newVal, oldVal)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If a comparator is defined and the change was to a
list item, consider moving the item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.comparator &amp;&amp; <span class="hljs-regexp">/^\d+/</span>.test(attr)) {

			<span class="hljs-keyword">if</span> (ev.batchNum &amp;&amp; ev.batchNum !== <span class="hljs-keyword">this</span>._lastBatchNum) {
				<span class="hljs-keyword">this</span>.sort();
				<span class="hljs-keyword">this</span>._lastBatchNum = ev.batchNum;
				<span class="hljs-keyword">return</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>get the index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> currentIndex = +<span class="hljs-regexp">/^\d+/</span>.exec(attr)[<span class="hljs-number">0</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>and item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				item = <span class="hljs-keyword">this</span>[currentIndex];

			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> item !== <span class="hljs-string">'undefined'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Determine where this item should reside as a result
of the change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> newIndex = <span class="hljs-keyword">this</span>._getInsertIndex(item, currentIndex);

				<span class="hljs-keyword">if</span> (newIndex !== currentIndex) {
					<span class="hljs-keyword">this</span>._swapItems(currentIndex, newIndex);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Trigger length change so that {{#block}} helper can re-render</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					can.trigger(<span class="hljs-keyword">this</span>, <span class="hljs-string">'length'</span>, [
						<span class="hljs-keyword">this</span>.length
					]);
				}

			}
		}
		_changes.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <ul>
<li>override setup for sorting</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>	proto.setup = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(instances, options)</span> </span>{
		setup.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.comparator) {
			<span class="hljs-keyword">this</span>.sort();
		}
	};
	<span class="hljs-keyword">return</span> can.Map;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
